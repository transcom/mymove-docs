<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-backend/guides/service-objects/implementation">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Implementation | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/backend/guides/service-objects/implementation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Implementation | MilMove Developer Portal"><meta data-rh="true" name="description" content="Now we can start implementing our service objects. We&#x27;ll start with the creator service object and then work on the"><meta data-rh="true" property="og:description" content="Now we can start implementing our service objects. We&#x27;ll start with the creator service object and then work on the"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-objects/implementation"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-objects/implementation" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-objects/implementation" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.cb78340e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.70764974.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/backend">MilMove Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/testing/acceptance-testing-syncada-edi-invoicing">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/backend/guides/service-objects/overview">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/overview">Service Objects</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/structure">Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/set-up-service-subpackage-and-interface">Set Up Service Subpackage and Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/validation">Validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/implementation">Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/usage">Usage</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/backend-structure">Backend Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng_items-update-data">Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/database">Database Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/feature-flags-in-the-app">Feature flags in the app</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing">Global Household Goods Contract</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/how-to/add-an-event-trigger">How-to guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection">Troubleshoot GEX Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng-yearly-import">Importing tariff400ng data for the year</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures">Precommit Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/route-planner">Route Planner Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/session-management">Session management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/roles-and-permissions">Roles and Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/switching-over-to-nix">Switching over to Nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-time">Time in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-loops">Loop Iteration in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tspp-data-creation">Turning TDL scores and TSP discounts into transportation service provider performances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-optimistic-locking">What Is Optimistic Locking?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings">Zip code to Rate area mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/wip-server-side-validation">WIP server-side validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/debugging-sql-tests">Debugging SQL Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-history-and-audit-logging">History and Audit Logging Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/open-telemetry">Open Telemetry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/environment_variables/">Environment Variables</a><button aria-label="Toggle the collapsible sidebar category &#x27;Environment Variables&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-guide">Golang Programming Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/understanding-milmove-routing">Understanding MilMove Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-stateless-services-with-app-context">AppContext: how and when to use it</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/setup/configure-postico-or-tableplus-to-connect-to-mymove-db">Setup</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Service Objects</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Implementation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Implementation</h1><p>Now we can start implementing our service objects. We&#x27;ll start with the creator service object and then work on the
updater service object.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pet-creator"><code>Pet</code> Creator<a href="#pet-creator" class="hash-link" aria-label="Direct link to pet-creator" title="Direct link to pet-creator">​</a></h2><p>In the <code>services/pet</code> subpackage, we&#x27;ll add two new files, <code>pet_creator.go</code> and its corresponding tests file,<br>
<code>pet_creator_test.go</code>:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mymove/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">├── pkg/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   ├── services/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── ...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── pet/</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── pet_creator.go</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── pet_creator_test.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── ...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-struct">Creating the Struct<a href="#creating-the-struct" class="hash-link" aria-label="Direct link to Creating the Struct" title="Direct link to Creating the Struct">​</a></h3><p>In the <code>pet_creator.go</code> file, we&#x27;ll start by defining our base <code>struct</code> type for the service object. All of a
service objects&#x27; actions will be receiver functions for the <code>struct</code>. This <code>struct</code> should be private to the subpackage.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This struct should contain all the required fields for your new service. Commonly this includes the validator
functions for the service and possibly other service objects if they are needed. You should think of these fields as
<em>dependencies</em> for your new service object. The more you have, the more work the caller will have to do to set up
this service, which can get inconvenient very quickly. Typically, these dependencies will be interfaces, which makes
it easier to mock them in tests at least.</p><p>Note that the service objects that you need to define here are the ones that your service object will use directly,
they aren&#x27;t the ones your validation functions will need. We&#x27;ll see later how we pass the validators their dependencies. </p><p>For the creator, we won&#x27;t need any services to be part of the <code>struct</code>. So for now, we&#x27;ll just add a field for our
validators:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-action-function">Creating the Action Function<a href="#creating-the-action-function" class="hash-link" aria-label="Direct link to Creating the Action Function" title="Direct link to Creating the Action Function">​</a></h3><p>Now that we&#x27;ve defined our <code>struct</code>, we can define the receiver function for it. Remember that we intend for this
<code>struct</code> to be the implementation of the interface we defined in <code>services/pet.go</code>, so we actually already defined
the signature for it when <a href="/mymove-docs/docs/backend/guides/service-objects/set-up-service-subpackage-and-interface#service-interface">we defined the interface</a>.
So, that gives us this:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain">  </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ll come back and implement the logic in a later step.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-an-instance-of-our-service-object">Creating An Instance of Our Service Object<a href="#creating-an-instance-of-our-service-object" class="hash-link" aria-label="Direct link to Creating An Instance of Our Service Object" title="Direct link to Creating An Instance of Our Service Object">​</a></h3><p>We have a service object, and we have validators, but now we need a way to initialize our service objects and define
how we set up its validators, ensuring the correct ones are used as needed.</p><p>We&#x27;ll use functions to initialize our service object with the correct validators for the use cases we have. When we
<a href="/mymove-docs/docs/backend/guides/service-objects/validation#grouping-rules-functions">grouped our validation functions</a>, we defined what our use cases were, one
for the customer, and one for the office. We can create the corresponding initializing functions now:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewCustomerPetCreator creates a new petCreator struct with the checks it needs for a customer and the service</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// dependencies the checks need.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">StringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customerChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewOfficePetCreator creates a new petCreator struct with the checks it needs for an office user</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">officeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here you can see in the <code>NewCustomerPetCreator</code> how we pass along the <code>services.StringChecker</code> that the checks need.</p><p>You&#x27;ll notice we don&#x27;t allow the caller to choose the checks that will be run for a given service. Instead, the
caller will need to pick the correct initializing function to use. This makes it so that we have uniform checks for
a given use case.</p><p>Using this strategy, we can add however many <code>New&lt;UseCase&gt;&lt;ServiceObject&gt;</code> functions as we need to. They will all
return the same service interface with different validators. This way we don&#x27;t have to muddle with our interface
definition, which is great because every modification to an interface has to be reproduced with every <code>struct</code> that
implements that interface. Creating new initializer functions is the least invasive way to change up our validation.</p><p>These functions also let us keep our <code>struct</code> and dependencies private to this subpackage and helps us standardize
the way folks use our service. By abstracting implementation and returning an interface, we are creating boundaries
between functionality and implementation that allow our codebase to be more flexible.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-the-creator">Implementing the Creator<a href="#implementing-the-creator" class="hash-link" aria-label="Direct link to Implementing the Creator" title="Direct link to Implementing the Creator">​</a></h3><p>Now that everything is set up and wired up, we can focus on the implementation details. <strong>This is going to be highly
context-dependent.</strong> Keep in mind that the following guidance may not apply to your use case.</p><p>For creating a new model record, we generally need to:</p><ol><li>Find any related objects in the database.<ol><li>Immediately we have a step that isn&#x27;t applicable to the example model we&#x27;re working with. Our <code>Pet</code> is
related to <code>Cat</code>, but won&#x27;t be creating it or affecting it in any way. But, if you were working with say,
creating a shipment, you&#x27;d need to find the move. We&#x27;ll see an example of finding data we need when we work
on the <code>Pet</code> updater though.</li></ol></li><li>Validate the input data against our business rules.</li><li>Start a transaction and make the change to the database.</li><li>Return the successfully created object.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tests-for-the-creator">Tests for the Creator<a href="#tests-for-the-creator" class="hash-link" aria-label="Direct link to Tests for the Creator" title="Direct link to Tests for the Creator">​</a></h4><p>Knowing the general actions we&#x27;ll take, we can write some tests for our creator, so we know we&#x27;ve set it up correctly.</p><p>Test cases we&#x27;ll want:</p><ul><li>Validation error with the input data</li><li>Error with creating the <code>Pet</code></li><li>Successfully creating a <code>Pet</code></li></ul><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Tests for `CreatePet`</summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator_test.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/gofrs/uuid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite PetSuite</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">TestCreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Only going to use one of our creators since the only difference between them is the rules they use for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// validation. Since the rules have their own tests and aren&#x27;t the focus of these tests, no point in testing them.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns an InvalidInputError if there&#x27;s an issue with the input data&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        badPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ID</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Must</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewV4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        creator </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> creator</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> badPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">IsType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">InvalidInputError</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Invalid input found while validating the pet.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns a transaction error if one is raised&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Easiest way to trigger this is by trying to store a pet with the same ID. We&#x27;ll also need to skip the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// validation for the first one so we&#x27;ll create it directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        pet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeCat</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Fluffy&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        appCtx </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndCreate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NoVerrs</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">verrs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        creator </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> createErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> creator</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">createErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">IsType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">QueryError</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> createErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Can successfully create a pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        pet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeCat</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Fluffy&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        creator </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> creator</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p>If we run those tests, they should all fail, but soon we&#x27;ll get them passing!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validating-creator-input">Validating Creator Input<a href="#validating-creator-input" class="hash-link" aria-label="Direct link to Validating Creator Input" title="Direct link to Validating Creator Input">​</a></h4><p>We can finally use the <code>validatePet</code> function we wrote in the
<a href="/mymove-docs/docs/backend/guides/service-objects/validation#create-the-validatemodel-function">validation section</a>:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewCustomerPetCreator creates a new petCreator struct with the checks it needs for a customer and the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// dependencies the checks need.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">StringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customerChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewOfficePetCreator creates a new petCreator struct with the checks it needs for an office user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">officeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain">  </span><span class="token comment" style="color:#999999">// TODO: Finish implementing logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can see that we pass the <code>appCtx</code> and <code>pet</code> along to <code>validatePet</code> for the first two args. We then pass <code>nil</code>
for the third arg since we&#x27;re creating a <code>Pet</code> so there is no pre-existing <code>Pet</code>. </p><p>The final bit is to pass the checks that we want to use. Notice how we use <code>c.checks...</code> to pass the checks. This is
because the <code>checks</code> will contain the correct checks based on how the <code>petCreator</code> was initialized (
<code>NewCustomerPetCreator</code> vs <code>NewOfficePetCreator</code>), and the <code>...</code> part is because it&#x27;s a variadic function (more info in
<a href="/mymove-docs/docs/backend/guides/service-objects/validation#resources">validation resources</a>).</p><p>The final bit for this part is to check for errors and return early if we have any.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-pet">Creating the Pet<a href="#creating-the-pet" class="hash-link" aria-label="Direct link to Creating the Pet" title="Direct link to Creating the Pet">​</a></h4><p>Next we&#x27;ll start a transaction so that we can roll back the operation if there are issues. Within the transaction,
we&#x27;ll use <a href="https://gobuffalo.io/en/docs/db/mutations/" target="_blank" rel="noopener noreferrer">Pop</a> to create the <code>Pet</code>.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    txnErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// TODO: Implement creation logic</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txnErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txnErr</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain">  </span><span class="token comment" style="color:#999999">// TODO: Finish implementing logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we can see we start a transaction which can return an error, so we need to catch that, check it, and if not
<code>nil</code>, return it.</p><p>Within the transaction, it&#x27;s important to use the <code>txnCtx</code> version of <code>appcontext.AppContext</code>. This ensures that if
we are within a larger transaction (e.g. an orchestrator service object is calling several service objects that
create/update data), we can see the other changes that have been made as part of the transaction and vice versa.</p><p>Now we fill in the creation logic:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/gofrs/uuid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    txnErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// This will make the changes directly (if successful) using the pointer so we can just use `pet` later on.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> txnCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndCreate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Check validation errors.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Invalid input found while creating the Pet.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// If the error is something else (this is unexpected), we create a QueryError</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txnErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txnErr</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain">  </span><span class="token comment" style="color:#999999">// TODO: Finish implementing logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We use <code>txnCtx.DB().ValidateAndCreate</code> to actually create the <code>Pet</code>, and check the validation errors and regular
error that we can get back. We have a pattern of converting unexpected (non-validation) errors into a
<code>apperror.QueryError</code> type, but we don&#x27;t want to override the error msg, hence the third arg being an empty string.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-pet_creatorgo">Final <code>pet_creator.go</code><a href="#final-pet_creatorgo" class="hash-link" aria-label="Direct link to final-pet_creatorgo" title="Direct link to final-pet_creatorgo">​</a></h4><p>The last thing to do is return a pointer to the newly created <code>Pet</code>, which gives us this final version:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Final `pet_creator.go`</summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/gofrs/uuid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petCreator is the concrete struct implementing the services.PetCreator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewCustomerPetCreator creates a new petCreator struct with the checks it needs for a customer and the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// dependencies the checks need.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">StringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customerChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewOfficePetCreator creates a new petCreator struct with the checks it needs for an office user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">officeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// CreatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">c </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    txnErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// This will make the changes directly (if successful) using the pointer so we can just use `pet` later on.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> txnCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndCreate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Check validation errors.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Invalid input found while creating the Pet.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// If the error is something else (this is unexpected), we create a QueryError</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txnErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txnErr</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-the-updater">Implementing the Updater<a href="#implementing-the-updater" class="hash-link" aria-label="Direct link to Implementing the Updater" title="Direct link to Implementing the Updater">​</a></h3><p>Next we can work on implementing the updater. <strong>This one is going to be highly context-dependent.</strong> Keep in mind
that the following guidance may not apply to your use case.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-struct-function-and-initializers">Setting Up the Struct, Function, and Initializers<a href="#setting-up-the-struct-function-and-initializers" class="hash-link" aria-label="Direct link to Setting Up the Struct, Function, and Initializers" title="Direct link to Setting Up the Struct, Function, and Initializers">​</a></h4><p>The steps here will be similar to the <code>Create</code> version, so this section won&#x27;t have as much explanation as the first
time.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petUpdater is the concrete struct implementing the services.PetUpdater interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petUpdater </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks  </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewCustomerPetUpdater creates a new petUpdater struct with the checks it needs for a customer and the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// dependencies the checks need.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">StringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetUpdater </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customerChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewOfficePetUpdater creates a new petUpdater struct with the checks it needs for an office user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetUpdater </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">officeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet updates an existing pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>One thing to note is that we&#x27;re re-using our grouped rule functions. This is why we wrote the functions to be able
to handle both the case of creating and updating. Now we can easily re-use them for both our creator and updater
service objects.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-process">Update Process<a href="#update-process" class="hash-link" aria-label="Direct link to Update Process" title="Direct link to Update Process">​</a></h4><p>For updating model record, we generally need to:</p><ol><li>Find any related objects in the database.<ol><li>This means finding the current version of the record we&#x27;re updating, as well as any related models.</li></ol></li><li>Check the input <code>eTag</code> against the current model to ensure the user was looking at the latest version before
making changes.</li><li>Create a version of the model that has the requested changes layered on top of the original data.<ol><li>Remember that in <a href="/mymove-docs/docs/backend/guides/service-objects/validation#variations-of-validate-signature">Variations of <code>Validate</code> Signature</a> we
mentioned that there&#x27;s different ways of approaching validation. Since we chose option 1 then, we need to
create the merged new version <strong>before</strong> validating the data. If we&#x27;d chosen option 2, this step would be
after the next one.</li></ol></li><li>Validate the input data against our business rules.</li><li>Start a transaction and make the change to the database.</li><li>Return the successfully updated object.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tests-for-the-updater">Tests for the Updater<a href="#tests-for-the-updater" class="hash-link" aria-label="Direct link to Tests for the Updater" title="Direct link to Tests for the Updater">​</a></h4><p>Knowing the general actions we&#x27;ll take, we can write some tests for our updater, so we know we&#x27;ve set it up correctly.</p><p>Test cases we would want:</p><ul><li>Error if original <code>Pet</code> can&#x27;t be found</li><li>Error if <code>eTag</code> is stale/invalid</li><li>Validation error with the input data</li><li>Error with updating the <code>Pet</code><ul><li>Because of the way our <code>Pet</code> model is set up, there isn&#x27;t really an easy way to test this case, so we&#x27;ll skip
this one.</li></ul></li><li>Successfully updating a <code>Pet</code></li><li>Returns associated models.<ul><li>This will depend a lot on what you&#x27;re trying to do. You may not have related data, or you may not need to pass
it back out.</li></ul></li></ul><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Tests for `UpdatePet`</summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater_test.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;errors&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;fmt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/gofrs/uuid&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/stretchr/testify/mock&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services/mocks&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/testdatagen&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite PetSuite</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">TestUpdateCat</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    setUpForTest </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> overrides </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeDog</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            Name</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Fluffy&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> overrides </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            testdatagen</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">MergeModels</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> overrides</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndCreate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NoVerrs</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">verrs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns an error if the original &quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Since we haven&#x27;t created any Pets, we&#x27;ll just use a randomly generated ID that we&#x27;ll try searching for.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        badPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            ID</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Must</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewV4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updater </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updatedPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> updater</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> badPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">IsType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">NotFoundError</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                fmt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Sprintf</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;ID: %s not found while looking for Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> badPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">String</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                err</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns a PreconditionFailedError if the input eTag is stale/incorrect&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        appCtx </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">setUpForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updater </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updatedPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> updater</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">IsType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PreconditionFailedError</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                fmt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Sprintf</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Precondition failed on update to object with ID: &#x27;%s&#x27;. The If-Match header value did not match the eTag for this record.&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">String</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                updateErr</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns an InvalidInputError if there&#x27;s an issue with the input data&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        appCtx </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">setUpForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        badPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        badPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&lt;Hacked&gt;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        stringCheckError </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> errors</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">New</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;invalid characters found in string&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        stringChecker </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> mocks</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewStringChecker</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">T</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        stringChecker</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">On</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Validate&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            mock</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AnythingOfType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;*appcontext.appContext&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            mock</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AnythingOfType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;string&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Return</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringCheckError</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updater </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updatedPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> updater</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> badPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">IsType</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">InvalidInputError</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Invalid input found while validating the pet.&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Can successfully update a pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        appCtx </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">setUpForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        desiredPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        desiredPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Cheddar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updater </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updatedPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> updater</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> desiredPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">desiredPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updatedPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Run</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Returns associated child models&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        appCtx </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">setUpForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain">Type</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeCat</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        desiredPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        desiredPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Cheddar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        eTag </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updater </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        updatedPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updateErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> updater</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">AppContextForTest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> desiredPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Nil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updateErr</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Equal</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">desiredPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> updatedPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            suite</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NotNil</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">updatedPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Cat</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p>If we run those tests, they should all fail, but soon we&#x27;ll get them passing!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fetching-the-current-record">Fetching the Current Record<a href="#fetching-the-current-record" class="hash-link" aria-label="Direct link to Fetching the Current Record" title="Direct link to Fetching the Current Record">​</a></h4><p>The first thing we&#x27;ll want to do is search for the current version of this model. The exact query will vary based on
what info you need, but for this one, it will look like this:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Eager</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> err </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> sql</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ErrNoRows</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that we want to load the associated models too so that when we return the final version, it has all the
necessary related data. If you don&#x27;t need the extra data, you can skip that part. There are also performance
considerations for using <code>Eager</code> vs <code>EagerPreload</code>, but we can&#x27;t use the latter here due to a bug. You can see more
info in <a href="/mymove-docs/docs/backend/setup/using-eagerpreload-in-pop">Using EagerPreload in Pop</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checking-for-a-staleinvalid-etag">Checking For a Stale/Invalid ETag<a href="#checking-for-a-staleinvalid-etag" class="hash-link" aria-label="Direct link to Checking For a Stale/Invalid ETag" title="Direct link to Checking For a Stale/Invalid ETag">​</a></h4><p>Now we want to make sure that the <code>eTag</code> associated with the version of the data that the user wants to update is
still the latest version. Otherwise, the updates this user requested might accidentally overwrite another user&#x27;s
updates.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> err </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> sql</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ErrNoRows</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeCat </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Load</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Cat&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> eTag </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewPreconditionFailedError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="merging-the-current-model-with-desired-changes">Merging the Current Model with Desired Changes<a href="#merging-the-current-model-with-desired-changes" class="hash-link" aria-label="Direct link to Merging the Current Model with Desired Changes" title="Direct link to Merging the Current Model with Desired Changes">​</a></h4><p>Next we&#x27;ll merge the current model and the desired changes to get the final state that we can then validate:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> err </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> sql</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ErrNoRows</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetTypeCat </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Load</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Cat&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> eTag </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewPreconditionFailedError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// First we&#x27;ll create a copy of the originalPet and make the changes to the new version.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    newPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> originalPet</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalStringField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalPoundField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You&#x27;ll see that we have some shared helper functions to deal with the logic for setting some types of optional
fields. We also have some for required fields, but not for <code>Type</code> and <code>Name</code> so we had to do those manually. As you
work on services, if you find that you&#x27;re doing some type of logic repeatedly, feel free to add more helpers!</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="validating-updater-input">Validating Updater Input<a href="#validating-updater-input" class="hash-link" aria-label="Direct link to Validating Updater Input" title="Direct link to Validating Updater Input">​</a></h4><p>Now we&#x27;re ready to validate!</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Omitting the rest of the logic to focus better</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// First we&#x27;ll create a copy of the originalPet and make the changes to the new version.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalStringField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalPoundField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// TODO: implement logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can see that unlike with the creator, we do pass in a third arg to <code>validatePet</code> since we&#x27;re doing updates this
time and do have an <code>originalPet</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="updating-the-pet">Updating the Pet<a href="#updating-the-pet" class="hash-link" aria-label="Direct link to Updating the Pet" title="Direct link to Updating the Pet">​</a></h4><p>Next we&#x27;ll start a transaction so that we can roll back the operation if there are issues. Within the transaction,
we&#x27;ll use <a href="https://gobuffalo.io/en/docs/db/mutations/" target="_blank" rel="noopener noreferrer">Pop</a> to update the <code>Pet</code>.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Omitting the other parts for ease of reading</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Omitting the rest of the logic to focus better</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    txnErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// This will make the changes directly (if successful) using the pointer so we can just use `newPet` later on.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> txnCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndUpdate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Check validation errors.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;invalid input found while updating the Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// If the error is something else (this is unexpected), we create a QueryError</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txnErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txnErr</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You&#x27;ll notice the logic for the DB transaction is pretty similar to the logic for the creator. The main difference
is the use of <code>txnCtx.DB().ValidateAndUpdate</code> instead of <code>txnCtx.DB().ValidateAndCreate</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-pet_updatergo">Final <code>pet_updater.go</code><a href="#final-pet_updatergo" class="hash-link" aria-label="Direct link to final-pet_updatergo" title="Direct link to final-pet_updatergo">​</a></h4><p>And with that, we&#x27;re done! Here&#x27;s the final version of the updater:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Final `pet_updater.go`</summary><div><div class="collapsibleContent_i85q"><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">pkg/services/pet/pet_updater.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> pet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;database/sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/apperror&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/etag&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/services&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// petUpdater is the concrete struct implementing the services.PetUpdater interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> petUpdater </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">petValidator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewCustomerPetUpdater creates a new petUpdater struct with the checks it needs for a customer and the service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// dependencies the checks need.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewCustomerPetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">StringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetUpdater </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">customerChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">stringChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// NewOfficePetUpdater creates a new petUpdater struct with the checks it needs for an office user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewOfficePetUpdater</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PetUpdater </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        checks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">officeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// UpdatePet creates a pet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">u </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">petUpdater</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">UpdatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> eTag </span><span class="token builtin" style="color:#D8DEE9">string</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    originalPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Pet</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Eager</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> err </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> sql</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ErrNoRows</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> etag</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">GenerateEtag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UpdatedAt</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> eTag </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewPreconditionFailedError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// First we&#x27;ll create a copy of the originalPet and make the changes to the new version.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> originalPet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Type</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Birthday</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalDateTimeField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">GotchaDay</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalStringField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Bio</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    newPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">SetOptionalPoundField</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">pet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Weight</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatePet</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> u</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    txnErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// This will make the changes directly (if successful) using the pointer so we can just use `newPet` later on.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> txnCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndUpdate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Check validation errors.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">originalPet</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;invalid input found while updating the Pet&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// If the error is something else (this is unexpected), we create a QueryError</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> apperror</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Pet&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txnErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txnErr</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">newPet</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Now that the function is filled out, you&#x27;ll want to refactor it by extracting each logical step into a separate,
smaller, and well-named private function. We should strive to keep all functions as small as possible for
readability. The creator was much smaller, so it&#x27;s not as vital to do that there, but as you can see, the updater is
quite large by the end.</p><p><a href="https://github.com/transcom/mymove/blob/main/pkg/services/mto_service_item/mto_service_item_updater.go#L44-L123" target="_blank" rel="noopener noreferrer">ApproveOrRejectServiceItem</a>
is a good example of a function that performs a lot of actions, and each one is encapsulated in a separate function.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/service-objects/implementation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/backend/guides/service-objects/validation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Validation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/backend/guides/service-objects/usage"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Usage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#pet-creator" class="table-of-contents__link toc-highlight"><code>Pet</code> Creator</a><ul><li><a href="#creating-the-struct" class="table-of-contents__link toc-highlight">Creating the Struct</a></li><li><a href="#creating-the-action-function" class="table-of-contents__link toc-highlight">Creating the Action Function</a></li><li><a href="#creating-an-instance-of-our-service-object" class="table-of-contents__link toc-highlight">Creating An Instance of Our Service Object</a></li><li><a href="#implementing-the-creator" class="table-of-contents__link toc-highlight">Implementing the Creator</a></li><li><a href="#implementing-the-updater" class="table-of-contents__link toc-highlight">Implementing the Updater</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.cb78340e.js"></script>
<script src="/mymove-docs/assets/js/main.70764974.js"></script>
</body>
</html>