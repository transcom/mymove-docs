<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-backend/guides/tariff400ng-yearly-import">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Importing tariff400ng data for the year | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/backend/guides/tariff400ng-yearly-import"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Importing tariff400ng data for the year | MilMove Developer Portal"><meta data-rh="true" name="description" content="Related PRs"><meta data-rh="true" property="og:description" content="Related PRs"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/backend/guides/tariff400ng-yearly-import"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/tariff400ng-yearly-import" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/tariff400ng-yearly-import" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.cb78340e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.70764974.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/backend">MilMove Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/testing/acceptance-testing-syncada-edi-invoicing">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/backend/guides/service-objects/overview">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects/overview">Service Objects</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/backend-structure">Backend Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng_items-update-data">Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/database">Database Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/feature-flags-in-the-app">Feature flags in the app</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing">Global Household Goods Contract</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/how-to/add-an-event-trigger">How-to guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection">Troubleshoot GEX Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng-yearly-import">Importing tariff400ng data for the year</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures">Precommit Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/route-planner">Route Planner Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/session-management">Session management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/roles-and-permissions">Roles and Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/switching-over-to-nix">Switching over to Nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-time">Time in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-loops">Loop Iteration in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tspp-data-creation">Turning TDL scores and TSP discounts into transportation service provider performances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-optimistic-locking">What Is Optimistic Locking?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings">Zip code to Rate area mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/wip-server-side-validation">WIP server-side validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/debugging-sql-tests">Debugging SQL Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-history-and-audit-logging">History and Audit Logging Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/open-telemetry">Open Telemetry</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/environment_variables/">Environment Variables</a><button aria-label="Toggle the collapsible sidebar category &#x27;Environment Variables&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-guide">Golang Programming Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/understanding-milmove-routing">Understanding MilMove Routing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-stateless-services-with-app-context">AppContext: how and when to use it</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/setup/configure-postico-or-tableplus-to-connect-to-mymove-db">Setup</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Importing tariff400ng data for the year</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Importing tariff400ng data for the year</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="related-prs">Related PRs<a href="#related-prs" class="hash-link" aria-label="Direct link to Related PRs" title="Direct link to Related PRs">​</a></h2><p>For reference, here are the PRs from previous year&#x27;s imports:</p><ul><li>2018 data load (multiple PRs): <a href="https://github.com/transcom/mymove/pull/338" target="_blank" rel="noopener noreferrer">338</a>, <a href="https://github.com/transcom/mymove/pull/382" target="_blank" rel="noopener noreferrer">382</a>,
<a href="https://github.com/transcom/mymove/pull/1286" target="_blank" rel="noopener noreferrer">1286</a>, <a href="https://github.com/transcom/mymove/pull/1313" target="_blank" rel="noopener noreferrer">1313</a></li><li>2019 data load (multiple PRs): <a href="https://github.com/transcom/mymove/pull/2036" target="_blank" rel="noopener noreferrer">2036</a>, <a href="https://github.com/transcom/mymove/pull/2060" target="_blank" rel="noopener noreferrer">2060</a></li><li><a href="https://github.com/transcom/mymove/pull/3845" target="_blank" rel="noopener noreferrer">2020 data load</a>: Note that this one is different than the others because
it doesn&#x27;t use <code>uuid_generate_v4</code> (to keep UUIDs the same across all environments)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tables-that-need-to-be-updated-with-the-new-data">Tables that need to be updated with the new data<a href="#tables-that-need-to-be-updated-with-the-new-data" class="hash-link" aria-label="Direct link to Tables that need to be updated with the new data" title="Direct link to Tables that need to be updated with the new data">​</a></h2><ol><li><code>tariff400ng_full_pack_rates</code></li><li><code>tariff400ng_full_unpack_rates</code></li><li><code>tariff400ng_linehaul_rates</code></li><li><code>tariff400ng_service_areas</code></li><li><code>tariff400ng_shorthaul_rates</code></li><li><code>tariff400ng_item_rates</code></li><li><code>tariff400ng_zip3s</code>: This table is not scoped by date like the others above, but you should try to sync
it up with the spreadsheet in case any zips or service areas have changed.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-yearly-rates-xlsx-file-from-ustranscom">Obtain yearly rates <code>xlsx</code> file from USTRANSCOM<a href="#obtain-yearly-rates-xlsx-file-from-ustranscom" class="hash-link" aria-label="Direct link to obtain-yearly-rates-xlsx-file-from-ustranscom" title="Direct link to obtain-yearly-rates-xlsx-file-from-ustranscom">​</a></h2><ol><li>Visit: <a href="https://www.ustranscom.mil/dp3/hhg.cfm" target="_blank" rel="noopener noreferrer">https://www.ustranscom.mil/dp3/hhg.cfm</a> (for some reason, I had to load hit this url twice... the first visit redirected to another page).</li><li>Look under “Special Requirements and Rates Team” -&gt; “Domestic” -&gt; “400NG Baseline Rates” and download yearly rate file.</li><li>Copy the file to USTC MilMove Google drive: USTC MilMove -&gt; Data -&gt; Rate Engine pre GHC</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="importing-full_packs-full_unpacks-linehauls-service_areas-and-shorthauls">Importing <code>full_packs</code>, <code>full_unpacks</code>, <code>linehauls</code>, <code>service_areas</code>, and <code>shorthauls</code><a href="#importing-full_packs-full_unpacks-linehauls-service_areas-and-shorthauls" class="hash-link" aria-label="Direct link to importing-full_packs-full_unpacks-linehauls-service_areas-and-shorthauls" title="Direct link to importing-full_packs-full_unpacks-linehauls-service_areas-and-shorthauls">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extract-data-from-xlsx-file-via-ruby-scripts">Extract data from <code>xlsx</code> file via <code>Ruby</code> scripts<a href="#extract-data-from-xlsx-file-via-ruby-scripts" class="hash-link" aria-label="Direct link to extract-data-from-xlsx-file-via-ruby-scripts" title="Direct link to extract-data-from-xlsx-file-via-ruby-scripts">​</a></h3><ol><li><p>Clone the Truss fork of the <a href="https://github.com/trussworks/move.mil" target="_blank" rel="noopener noreferrer">move.mil repository</a></p></li><li><p>Run <code>bin/setup</code> on the command line and make sure there were no errors in populating the seed data.</p></li><li><p>Add the new <code>xlsx</code> file to the <code>lib/data</code> directory in the following format: <code>{YEAR} 400NG Baseline Rate.xlsx</code>.</p></li><li><p>Open <code>db/seeds.rb</code></p></li><li><p>Near the bottom of the file, you&#x27;ll see some commented code that imports baseline rates for previous years. Add the following and change the date range as needed:</p><div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">puts &#x27;-- Seeding 2020 400NG baseline rates...&#x27;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">Seeds::BaselineRates.new(</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  date_range: Range.new(Date.parse(&#x27;2020-05-15&#x27;), Date.parse(&#x27;2021-05-14&#x27;)),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  file_path: Rails.root.join(&#x27;lib&#x27;, &#x27;data&#x27;, &#x27;2020 400NG Baseline Rates.xlsx&#x27;)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">).seed!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Run <code>rails db:reset</code> to drop the database, re-run migrations, and re-run the seeds import.  You may want to run
Postgres on a different port than the default (5432) if you want to have your milmove DB up at the same time.</p></li><li><p>Dump the tables: <code>pg_dump --inserts -t full_packs -t full_unpacks -t linehauls -t service_areas -t shorthauls --no-owner --no-tablespaces move_mil_development &gt; 400ng_temp_tables.sql</code> .
Add in <code>-p &lt;port&gt;</code> if you used a different port for Postgres.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="load-dumped-tables-into-local-database">Load dumped tables into local database<a href="#load-dumped-tables-into-local-database" class="hash-link" aria-label="Direct link to Load dumped tables into local database" title="Direct link to Load dumped tables into local database">​</a></h3><p>Given that we want to predetermine the UUIDs for all inserted rows, we will use our local <code>dev_db</code> as a staging
area for the import, then use <code>pg_dump</code> to create the migration after we&#x27;re done with all transformations.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="setup-local-database">Setup local database<a href="#setup-local-database" class="hash-link" aria-label="Direct link to Setup local database" title="Direct link to Setup local database">​</a></h4><ol><li>Go to your local <code>milmove</code> clone.</li><li>Reset your local database: <code>make db_dev_reset db_dev_migrate</code>.</li><li>Drop the contents of the tariff tables we&#x27;re going to be importing (so we can later <code>pg_dump</code> their entire contents):<ol><li>Run <code>psql-dev</code></li><li>In psql, run: <code>truncate tariff400ng_full_pack_rates, tariff400ng_full_unpack_rates, tariff400ng_item_rates, tariff400ng_linehaul_rates, tariff400ng_service_areas, tariff400ng_shorthaul_rates;</code></li></ol></li><li>Import the data you dumped from the Ruby-generated database by doing: <code>\i path/to/400ng_temp_tables.sql</code><ol><li>If the above command fails with an &quot;unrecognized configuration parameter&quot;, try commenting out the corresponding <code>SET</code> line near the top of the SQL file. You may have a mismatch between the Postgres version used for the export and the one used for the import.</li></ol></li><li>You should now have both the MilMove <code>tariff400ng_*</code> tables (empty) as well as the new temp tables generated above.</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="transform-to-our-schema">Transform to our schema<a href="#transform-to-our-schema" class="hash-link" aria-label="Direct link to Transform to our schema" title="Direct link to Transform to our schema">​</a></h4><p>The next phase is to transform the temporary tables into the format expected by our <code>tariff400ng_*</code> tables.
To do so, you can run the script below.  Save it as <code>tariff400ng_cleanup.sql</code> and run it in psql: <code>\i tariff400ng_cleanup.sql</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">-- Pack rates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> tariff400ng_full_pack_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    uuid_generate_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    schedule</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">weight_lbs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> weight_lbs_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">weight_lbs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> weight_lbs_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rate </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> rate_cents</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    created_at</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    updated_at</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> full_packs</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Unpack rates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> tariff400ng_full_unpack_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    uuid_generate_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    schedule</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rate </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100000</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> rate_millicents</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    created_at</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    updated_at</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> full_unpacks</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Linehaul</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> tariff400ng_linehaul_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    uuid_generate_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">dist_mi</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> distance_miles_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">dist_mi</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> distance_miles_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">weight_lbs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> weight_lbs_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">weight_lbs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> weight_lbs_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rate </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> rate_cents</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">TEXT</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    created_at</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    updated_at</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> linehauls</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Service areas</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> tariff400ng_service_areas</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    uuid_generate_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    service_area</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    name</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    services_schedule</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">linehaul_factor </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> linehaul_factor</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">orig_dest_service_charge </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> service_charge_cents</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    created_at</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    updated_at</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> service_areas</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- Shorthauls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTO</span><span class="token plain"> tariff400ng_shorthaul_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    uuid_generate_v4</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">cwt_mi</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> cwt_miles_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">cwt_mi</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> cwt_miles_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CAST</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">rate </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">INTEGER</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> rate_cents</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    LOWER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_lower</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UPPER</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">effective</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> effective_date_upper</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    created_at</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    updated_at</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> shorthauls</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point, stop to spot check that all <code>tariff400ng_*</code> tables have the number of records that
you would expect based on the contents of the Ruby-generated tables as well as the source spreadsheet.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-additional-sit-data-to-tariff400ng_service_areas-table">Add additional <code>sit</code> data to <code>tariff400ng_service_areas</code> table<a href="#add-additional-sit-data-to-tariff400ng_service_areas-table" class="hash-link" aria-label="Direct link to add-additional-sit-data-to-tariff400ng_service_areas-table" title="Direct link to add-additional-sit-data-to-tariff400ng_service_areas-table">​</a></h2><p>The extracted data from the Ruby scripts doesn&#x27;t contain all the data we need.
We also need <code>185A SIT First Day &amp; Whouse</code>, <code>185B SIT Addl Days</code>, and <code>SIT PD Schedule</code>
found on the <code>Geographical Schedule</code> sheet.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-data">Adding data<a href="#adding-data" class="hash-link" aria-label="Direct link to Adding data" title="Direct link to Adding data">​</a></h3><p>From the <code>Geographical Schedule</code> sheet, copy the service area number, 185A, 185B, and SIT PD Schedule columns and
transform it into the <code>SELECT</code> statements in the template below.  Save this completed template to a
<code>tariff400ng_fix_service_areas.sql</code> file.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">FUNCTION</span><span class="token plain"> update_sit_rates</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    service_area_number </span><span class="token keyword" style="color:#c5a5c5">text</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    sit_185a_rate_cents </span><span class="token keyword" style="color:#c5a5c5">integer</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    sit_185b_rate_cents </span><span class="token keyword" style="color:#c5a5c5">integer</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    sit_pd_schedule </span><span class="token keyword" style="color:#c5a5c5">integer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">RETURNS</span><span class="token plain"> void </span><span class="token keyword" style="color:#c5a5c5">language</span><span class="token plain"> plpgsql </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> $$</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">UPDATE</span><span class="token plain"> tariff400ng_service_areas</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SET</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        sit_185A_rate_cents </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> $</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        sit_185B_rate_cents </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> $</span><span class="token number" style="color:#5a9bcf">3</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        sit_pd_schedule </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> $</span><span class="token number" style="color:#5a9bcf">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"> tariff400ng_service_areas</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">service_area </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> $</span><span class="token number" style="color:#5a9bcf">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">      </span><span class="token operator" style="color:#d7deea">AND</span><span class="token plain"> tariff400ng_service_areas</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">effective_date_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;2020-05-15&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">END</span><span class="token plain"> $$</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"> update_sit_rates</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;4&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2004</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">070</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"> update_sit_rates</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;8&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1538</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">048</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- More rows here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">DROP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">FUNCTION</span><span class="token plain"> update_sit_rates</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A few notes:</p><ul><li>There are many ways to do this transformation depending on your preferred tools.  One way is to download a CSV from
the <code>Geographical Schedule</code> sheet, load that into Numbers locally, then just copy the four columns of interest to GoLand.
Then, you can use GoLand to search and replace using a regex to transform it to the needed format.  Example regex search and replace:
<code>^([0-9]+)\t+\$([0-9]+)\.([0-9]+)\t+\$([0-9]+)\.([0-9]+)\t+([0-9])</code> to <code>SELECT update_sit_rates(&#x27;$1&#x27;, $2$3, $4$5, $6);</code></li><li>Note that the rates in the document are in dollars, but we store the rates in cents in our <code>tariff400ng_service_areas</code> table,
so make sure you adjust accordingly.</li><li>Run this sql file with psql by either doing <code>psql-dev &lt; tariff400ng_fix_service_areas.sql</code> or (if already in psql)
<code>\i tariff400ng_fix_service_areas.sql</code> .</li></ul><p>Spot check the <code>tariff400ng_service_areas</code> table to make sure the data is as expected.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="importing-item_rates">Importing <code>item_rates</code><a href="#importing-item_rates" class="hash-link" aria-label="Direct link to importing-item_rates" title="Direct link to importing-item_rates">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transform-data-from-xlsx-file">Transform data from <code>xlsx</code> file<a href="#transform-data-from-xlsx-file" class="hash-link" aria-label="Direct link to transform-data-from-xlsx-file" title="Direct link to transform-data-from-xlsx-file">​</a></h3><p>We&#x27;re going to make use of the work that Patrick Stanger delivered in <a href="https://github.com/transcom/mymove/pull/1286" target="_blank" rel="noopener noreferrer">this PR</a>.</p><ol><li>Open <a href="https://docs.google.com/spreadsheets/d/1Zp--NWMr6VYrRlCn8Bi4_Ab4wXFKjxYl/edit#gid=1235758365" target="_blank" rel="noopener noreferrer">this google sheet</a> alongside the 400ng data you have received for the upcoming year.</li><li>Visit the <code>Accessorials</code> tab in both spreadsheets.</li><li>In the new data sheet, within the main section and the Alaska waterhaul section, copy all the values to the left of where it says &quot;weight&quot;. Start with the cells marked in the screenshot below:
<img loading="lazy" alt="accessorials sheet" src="/mymove-docs/assets/images/accessorials_spreadsheet-4ed6b9d28908049301f081ca7bbdf74d.png" width="3242" height="1634" class="img_ev3q"></li><li>Paste those values into the corresponding <code>Accessorials</code> tab in the other sheet.</li><li>Repeat this same process for the <code>Additional Rates</code> tab. Starting at the cell marked in the screenshot below:
<img loading="lazy" alt="additional rates sheet" src="/mymove-docs/assets/images/additional_rates_spreadsheet-70f3b09ff87592e9cae1a7a6892ee59d.png" width="2776" height="1732" class="img_ev3q"></li><li>Head over to the <code>migration work</code> tab. Here, you&#x27;ll find that queries have been generated for you to insert records into the <code>milmove</code> database.</li><li>Change the <code>effective_date_lower</code> and <code>effective_date_upper</code> in row 2 to be the correct dates.</li><li>Copy all of the values in the <code>query</code> column for both the <code>Additional Rates</code> table at the top of the sheet and the <code>Accessorials</code> table below it to
a file called <code>tariff400ng_item_rates.sql</code>.  A few rows may have &quot;#REF!&quot; errors due to 125B/125D no longer being included on the <code>Accessorials</code> tab unlike
previous years; you should skip those.</li><li>Run <code>tariff400ng_item_rates.sql</code> against your local database as you&#x27;ve done with other SQL files.</li></ol><p>Spot check the <code>tariff400ng_item_rates</code> table to make sure the data is as expected.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fix-certain-item-rates-update-weight_lbs_lower-and-update-rate_cents-for-specific-codes">Fix certain item rates. Update <code>weight_lbs_lower</code> and update <code>rate_cents</code> for specific codes<a href="#fix-certain-item-rates-update-weight_lbs_lower-and-update-rate_cents-for-specific-codes" class="hash-link" aria-label="Direct link to fix-certain-item-rates-update-weight_lbs_lower-and-update-rate_cents-for-specific-codes" title="Direct link to fix-certain-item-rates-update-weight_lbs_lower-and-update-rate_cents-for-specific-codes">​</a></h3><p>There are a few item rates whose values are not correctly interpreted correctly by the spreadsheet.  These can be
fixed by running this SQL script against your local database (alternatively, you could address this in the spreadsheet
prior to inserting it into the database):</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">-- These charges are subject to a min of 1,000lbs, so that rate should apply to weights &lt; 1,000 also</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">UPDATE</span><span class="token plain"> tariff400ng_item_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SET</span><span class="token plain"> weight_lbs_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"> weight_lbs_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token operator" style="color:#d7deea">AND</span><span class="token plain"> code </span><span class="token operator" style="color:#d7deea">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;125A&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;125C&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;210A&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;210D&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;225A&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;225B&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token operator" style="color:#d7deea">AND</span><span class="token plain"> effective_date_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;2020-05-15&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- These rates were assumed to be listed in cents but they were in dollars, though they were already scaled by 10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- because they contained decimal values</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">UPDATE</span><span class="token plain"> tariff400ng_item_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SET</span><span class="token plain"> rate_cents </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> rate_cents </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"> code </span><span class="token operator" style="color:#d7deea">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;125C&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;210D&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;225B&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token operator" style="color:#d7deea">AND</span><span class="token plain"> effective_date_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;2020-05-15&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">-- These rates were assumed to be listed in cents but they were in dollars</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">UPDATE</span><span class="token plain"> tariff400ng_item_rates</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">SET</span><span class="token plain"> rate_cents </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> rate_cents </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"> code </span><span class="token operator" style="color:#d7deea">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;125A&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;210A&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;225A&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token operator" style="color:#d7deea">AND</span><span class="token plain"> effective_date_lower </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;2020-05-15&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Spot check the <code>tariff400ng_item_rates</code> table to make sure the data is as expected after these fixes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-the-migration">Prepare the migration<a href="#prepare-the-migration" class="hash-link" aria-label="Direct link to Prepare the migration" title="Direct link to Prepare the migration">​</a></h2><p>Now we should have all the data imported, transformed, and cleaned.  We can now dump the appropriate tables that
will ultimately become our migration:</p><p><code>pg_dump -t tariff400ng_full_pack_rates -t tariff400ng_full_unpack_rates -t tariff400ng_item_rates -t tariff400ng_linehaul_rates -t tariff400ng_service_areas -t tariff400ng_shorthaul_rates --no-owner --no-tablespaces -h localhost -U postgres -W --data-only dev_db &gt; new_2020_400ng_data.sql</code></p><p><a href="/mymove-docs/docs/backend/setup/database-migrations#creating-a-migration">Create a new migration</a> using the usual process and copy this data into it.</p><p>Note that we use the <code>COPY</code> mechanism here to insert rows into the database -- this is much faster than <code>INSERT</code> on
large data sets.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sync-zip3s-and-service-areas">Sync zip3s and service areas<a href="#sync-zip3s-and-service-areas" class="hash-link" aria-label="Direct link to Sync zip3s and service areas" title="Direct link to Sync zip3s and service areas">​</a></h2><p>The <code>Base Point City</code> tab of the 400NG spreadsheet contains zip3s, service areas, and base point cities/states.
Using your preferred tools, compare this data against the current state of the <code>tariff400ng_zip3s</code> table to see if
any corrections/additions/deletions need to be made.</p><p>This query may be helpful in getting the current table into a format that&#x27;s similar to the spreadsheet to make
diffs easier:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">select</span><span class="token plain"> basepoint_city</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> service_area</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> string_agg</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">zip3</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;,&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">order</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">by</span><span class="token plain"> zip3</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> tariff400ng_zip3s</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">group</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">by</span><span class="token plain"> basepoint_city</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> service_area</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">order</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">by</span><span class="token plain"> basepoint_city</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If there are any changes to be made, make a separate migration to address and include in your PR.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="run-your-new-migrations">Run your new migration(s)<a href="#run-your-new-migrations" class="hash-link" aria-label="Direct link to Run your new migration(s)" title="Direct link to Run your new migration(s)">​</a></h2><p>Now we can test out our migration(s) by resetting and migrating our local database.
If you want to be able to get back to the current state of your database,
consider using our <code>db-backup</code> script to make a backup before you begin (<code>db-restore</code> can restore it later).</p><p>Once you&#x27;re ready, run <code>make db_dev_reset db_dev_migrate</code> and make sure it completes successfully.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="spot-check-for-correct-data">Spot check for correct data<a href="#spot-check-for-correct-data" class="hash-link" aria-label="Direct link to Spot check for correct data" title="Direct link to Spot check for correct data">​</a></h2><p>Ensure the data loaded looks correct by checking a count of row numbers grouped by date.</p><ol><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_full_pack_rates group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_full_unpack_rates group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_item_rates group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_linehaul_rates group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_service_areas group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li><li><p><code>select effective_date_lower, effective_date_upper, count(*) from tariff400ng_shorthaul_rates group by effective_date_lower, effective_date_upper order by effective_date_lower DESC;</code></p></li></ol><p>Also, look at the data in the context of previous year&#x27;s data to see if the format/trends look reasonable:</p><ol><li><p><code>select * from tariff400ng_full_pack_rates order by weight_lbs_lower, schedule, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_full_unpack_rates order by schedule, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_item_rates where schedule is null order by code, schedule, weight_lbs_lower, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_item_rates where schedule is not null order by code, schedule, weight_lbs_lower, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_linehaul_rates order by distance_miles_lower, weight_lbs_lower, type, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_service_areas order by service_area, effective_date_lower;</code></p></li><li><p><code>select * from tariff400ng_shorthaul_rates order by cwt_miles_lower, effective_date_lower;</code></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="test">Test<a href="#test" class="hash-link" aria-label="Direct link to Test" title="Direct link to Test">​</a></h2><ol><li>Deploy branch in <code>experimental</code>.</li><li>Create a move for a date that is between the <code>effective_date_lower</code> and <code>effective_date_upper</code>.</li><li>Watch the console and ensure the app doesn&#x27;t throw any errors.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/tariff400ng-yearly-import.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshoot GEX Connection</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Precommit Hooks</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#related-prs" class="table-of-contents__link toc-highlight">Related PRs</a></li><li><a href="#tables-that-need-to-be-updated-with-the-new-data" class="table-of-contents__link toc-highlight">Tables that need to be updated with the new data</a></li><li><a href="#obtain-yearly-rates-xlsx-file-from-ustranscom" class="table-of-contents__link toc-highlight">Obtain yearly rates <code>xlsx</code> file from USTRANSCOM</a></li><li><a href="#importing-full_packs-full_unpacks-linehauls-service_areas-and-shorthauls" class="table-of-contents__link toc-highlight">Importing <code>full_packs</code>, <code>full_unpacks</code>, <code>linehauls</code>, <code>service_areas</code>, and <code>shorthauls</code></a><ul><li><a href="#extract-data-from-xlsx-file-via-ruby-scripts" class="table-of-contents__link toc-highlight">Extract data from <code>xlsx</code> file via <code>Ruby</code> scripts</a></li><li><a href="#load-dumped-tables-into-local-database" class="table-of-contents__link toc-highlight">Load dumped tables into local database</a></li></ul></li><li><a href="#add-additional-sit-data-to-tariff400ng_service_areas-table" class="table-of-contents__link toc-highlight">Add additional <code>sit</code> data to <code>tariff400ng_service_areas</code> table</a><ul><li><a href="#adding-data" class="table-of-contents__link toc-highlight">Adding data</a></li></ul></li><li><a href="#importing-item_rates" class="table-of-contents__link toc-highlight">Importing <code>item_rates</code></a><ul><li><a href="#transform-data-from-xlsx-file" class="table-of-contents__link toc-highlight">Transform data from <code>xlsx</code> file</a></li><li><a href="#fix-certain-item-rates-update-weight_lbs_lower-and-update-rate_cents-for-specific-codes" class="table-of-contents__link toc-highlight">Fix certain item rates. Update <code>weight_lbs_lower</code> and update <code>rate_cents</code> for specific codes</a></li></ul></li><li><a href="#prepare-the-migration" class="table-of-contents__link toc-highlight">Prepare the migration</a></li><li><a href="#sync-zip3s-and-service-areas" class="table-of-contents__link toc-highlight">Sync zip3s and service areas</a></li><li><a href="#run-your-new-migrations" class="table-of-contents__link toc-highlight">Run your new migration(s)</a></li><li><a href="#spot-check-for-correct-data" class="table-of-contents__link toc-highlight">Spot check for correct data</a></li><li><a href="#test" class="table-of-contents__link toc-highlight">Test</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.cb78340e.js"></script>
<script src="/mymove-docs/assets/js/main.70764974.js"></script>
</body>
</html>