<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-adrs/partial-update-patches">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">0076 Partial Update Patches | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/adrs/partial-update-patches"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="0076 Partial Update Patches | MilMove Developer Portal"><meta data-rh="true" name="description" content="üîí User Story: MB-14102"><meta data-rh="true" property="og:description" content="üîí User Story: MB-14102"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/adrs/partial-update-patches"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/adrs/partial-update-patches" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/adrs/partial-update-patches" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.2d8cf14e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.72cd5155.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/guides/adrs/">‚úçÔ∏è  Welcome to writing ADRs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/guides/adrs/template">üìÑ ADR Template</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/mymove-docs/docs/adrs">üì¶ Architecture Decision Records</a><button aria-label="Toggle the collapsible sidebar category &#x27;üì¶ Architecture Decision Records&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/server-framework">0000 Server Framework</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-orm">0001 Go ORM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-package-management">0002 Go package management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-path-and-project-layout">0003 Go path and project layout</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/path-imports">0004 Use Both Absolute and Relative Paths for Imports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/create-react-app">0005 Use Create React App</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/redux">0006 Use Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/swagger-client">0007 Use swagger-client to make calls to API from client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-swagger">0008 Use go-swagger To Route, Parse, And Validate API Endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/form-creation-from-swagger">0009 Generate forms from swagger definitions of payload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/isolate-test-access-to-database">0010 Isolate Test Access to Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/test-suites">0011 Test Suites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/tsp-data-models">0012 The TSP Data Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/rest-api-updates">0013 REST API Updates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-dependency-management">0014 Go Dependency Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/session-storage">0015 Session storage/handling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/Browser-Support">0016 Browser Support for Prototype</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/react-router-redux-authentication">0017 Client side route restriction based on authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/optional-field-interop">0018 Optional Field Interop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/client-rangeslider">0019 Range Slider React Component</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/swagger-auth">0020 Using Swagger to manage server route authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/ssn-use">0021 Temporary use and plan for expunging Social Security Numbers in the prototype</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/xlsx-lib">0022 Chose Excelize package to parse XLSX files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/representing-dollar-values">0023 Representing Dollar Values in Go and the Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/model-authorization-and-handler-design">0024 Model Authorization and Handler Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/client-side-feature-flags">0025 Client Side Feature Flags using Custom JavaScript</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-snyk-vulnerability-scanning">0026 Use Snyk Vulnerability Scanning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/pdf-generation">0027 PDF Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/config-management">0028 Config Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/honeycomb-integration">0029 Honeycomb Integration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/rds-iam">0030 IAM Authentication for Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/css-tooling">0031 CSS Tooling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/csrf-protection">0032 CSRF Protection for the Application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/service-object-layer">0033 Service Object Layer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/working-with-mocks-generation-and-assertion">0034 Working With Mocks: Generation and Assertion
</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-query-builder">0035 Use Query Builder for Admin Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-integration">0036 Use Separate Integration Package for Go Integration Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/go-path-and-project-layout-revisited">0037 Put mymove outside of standard GOPATH</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/soft-delete">0038 Use Soft Delete Instead of Hard Delete</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/react-lazy-and-code-splitting">0039 Use React Lazy for code splitting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/role-base-authorization">0040 Add Role-Based Authorization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/front-end-form-library">0041 Front End Form Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/optimistic-locking">0042 Use If-Match / E-tags for optimistic locking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/prime-time">0043 Handling time in the Prime API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/params-styling">0044 Use camelCase for API params</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/nesting-swagger-paths">0045 Nesting Swagger paths in the Prime API with multiple IDs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-nodenv">0046 Use nodenv to manage Node versions in development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/build-only-pull-requests-in-circleci">0047 Use CircleCI to build only Pull Requests and master</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/frontend-file-org">0048 Use a consistent file structure for front-end code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/etag-for-child-updates">0049 Do not update child records using parent&#x27;s E-tag</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/doc-viewer-fork">0050 Fork &amp; maintain react-file-viewer under @trussworks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/swagger-date-formats">0051 Use only Swagger supported formats for dates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-data-testid">0052 Use data-testid as an attribute for finding components in tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-react-query-office-app">0053 Use React Query for Office App API interactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-CSS-to-highlight-unfinished-features">0054 Use CSS to highlight unfinished features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/consolidate-moves-and-mtos">0055 Consolidate moves and move task orders into one database table</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-asdf-to-manage-golang-versions-in-development">0056 Use ASDF To Manage Golang Versions In Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/lodash">0057 Deprecate use of lodash over time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/replace-loki-with-happo">0058 Use Happo for visual regression testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-snapshot-to-cleanup-loadtesting">0059 Use snapshot to cleanup load testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/move-state-for-service-counseling">0060 Move statuses to support service counseling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-opentelemetry-for-distributed-tracing">0061 Use OpenTelemetry to instrument code for distributed tracing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/run-tests-in-transactions">0062 Run tests within transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-openapi-to-compile-api-specs">0063 Using openapi CLI to compile API specs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-stateless-services-with-context">0064 Use stateless services with context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-office-app-for-prime-ui">0065 Use Office application for Prime UI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-custom-nullable-types-for-patch-requests">0066 Use custom nullable types for patch requests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/ppm-db-design">0067 Add a child table to mto_shipments for PPMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-fake-data-factories-with-fake-data-generators-to-create-test-data">0068 Use fake data factories with fake data generators to create test data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-orchestrator-service-objects">0069 Use orchestrator service objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/cypress-tests-file-layout">0070 Use a consistent file structure for cypress tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/move-history-events">0071 Introduce Move History Events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/using-react-app-rewired">0072 Using React-App-Rewired</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/using-templates-for-sql-queries">0073 Use Templates for SQL Queries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/move-history-details-refactor">0074 Refactor Move Event&#x27;s Details Rendering </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/cli-spinner">0075 Remove CLI Spinner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/adrs/partial-update-patches">0076 Partial Update Patches</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/use-playwright">0076 Convert integration tests to Playwright</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/permanently-store-origin-duty-gbloc">0077 Permanently store Origin Duty Location GBLOC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/api-versioning">0078 API Versioning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/adrs/develop-strategy-for-ensuring-code-test-coverage">0079 Update strategy for maintaining code test coverage</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/mymove-docs/docs/adrs"><span itemprop="name">üì¶ Architecture Decision Records</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">0076 Partial Update Patches</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1><em>0076 Partial Update Patches</em></h1><p><strong>üîí User Story:</strong> <em><a href="https://dp3.atlassian.net/browse/MB-14102" target="_blank" rel="noopener noreferrer">MB-14102</a></em></p><p>At present, the MilMove back-end does not have developed support for partial updates or deleting fields in its models through patches. <a href="/mymove-docs/docs/adrs/use-custom-nullable-types-for-patch-requests">ADR 0066</a> introduced custom nullable types for patch requests which addresses this issue at the swagger/handler layer, but services may not be prepared to fully support the rest of this sort of workflow.
Some handlers follow a narrow updates pattern, in which one or more models can be updated in a very specific way. A good example of this is the ghc api <a href="https://github.com/transcom/mymove/blob/main/pkg/handlers/ghcapi/move_task_order.go" target="_blank" rel="noopener noreferrer">move_task_order.go handler</a> -- it has separate functions for different kinds of specific updates, like UpdateMoveTaskOrderStatusHandlerFunc and UpdateMTOStatusServiceCounselingCompletedHandlerFunc, which update the move model and other models in predictable ways.
For generic updates in which models can be updated in more spontaneous ways, dealing with scenarios in which a given field may be set to null becomes a lot trickier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="goal">Goal<a href="#goal" class="hash-link" aria-label="Direct link to Goal" title="Direct link to Goal">‚Äã</a></h2><p>The intent of this ADR is to select a pattern that can be used in MilMove to enable handlers and services to delete fields in database models and perform other generic updates more easily.
One example of a real bug related to this involves the MTOShipment model and Move History. When a services counselor tries to update a shipment for the first time and doesn&#x27;t change the <code>counselor_remarks</code> field, the field is always automatically set to an empty string from its initial value, <code>nil</code>, since the service that updates this model has no way of knowing whether this value was intended to be updated by the payload. This can result in empty entries in the Move history table. Furthermore, the handlers concerned with the MTOShipment model have no way to properly delete fields in the MTOShipment with simple patches, which limits what users can do to update shipments.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="useful-definition">Useful definition<a href="#useful-definition" class="hash-link" aria-label="Direct link to Useful definition" title="Direct link to Useful definition">‚Äã</a></h3><blockquote><p><strong>Nullable field:</strong> A field that contains information about whether it was included in the payload. A field with <code>Present=true</code> was included in the payload, with a <code>Value</code> that may or may not be null. A field with <code>Present=false</code> was not included in the payload, and therefore should not be updated in its corresponding model.</p></blockquote><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">type NullableString struct {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Present bool // Present is true if key is present in json</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Value   *string</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>MTOShipments are an example of a case in which the back-end is not prepared to handle partial updates or intentionally setting fields to null. At the handler (e.g. the ghcapi <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/handlers/ghcapi/mto_shipment.go#L284" target="_blank" rel="noopener noreferrer">UpdateMTOShipmentHandler</a>), the payload (which may contain nullable types) is converted to an <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/handlers/ghcapi/internal/payloads/payload_to_model.go#L309" target="_blank" rel="noopener noreferrer">MTOShipment model</a>, and during this conversion any information that distinguishes between missing fields and null fields is lost.</p><p>Furthermore, the <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/services/mto_shipment/mto_shipment_updater.go" target="_blank" rel="noopener noreferrer">MTOShipmentUpdater service</a> that is called from the handler further obfuscates things. It fetches the existing MTOShipment from the database and <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/services/mto_shipment/mto_shipment_updater.go#L103" target="_blank" rel="noopener noreferrer">sets fields in that struct</a> based on which fields in the payload model are null. Since at this point both omitted fields and intentionally-null fields from the payload are all represented as null, these fields simply are all not updated.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposal-1-intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent">Proposal 1: <strong>Intermediate Structs</strong> -- introduce a new struct that serves between the handler and service layers and broadcasts intent.<a href="#proposal-1-intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" class="hash-link" aria-label="Direct link to proposal-1-intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" title="Direct link to proposal-1-intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent">‚Äã</a></h2><blockquote><p><strong>proof-of-concept PR:</strong> <a href="https://github.com/transcom/mymove/pull/9503" target="_blank" rel="noopener noreferrer">MB-14102-Shipment_update_poc</a></p></blockquote><p>In this proposal, a new service struct, <code>MTOShipmentUpdate</code>, would serve communication between the handlers and the <code>UpdateShipment</code> service.
The MTOShipmentUpdate struct would represent an update to an MTOShipment. It would resemble the MTOShipment struct, but its fields could be Nullable, which means that they would contain information about whether a field should be updated by the update service.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">type Nullable[T any] struct {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Present bool</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Value   T</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">type MTOShipmentUpdate struct {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ID                               uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    MoveTaskOrder                    Move</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    MoveTaskOrderID                  uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ScheduledPickupDate              *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    RequestedPickupDate              *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    RequestedDeliveryDate            *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ApprovedDate                     *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    FirstAvailableDeliveryDate       *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ActualPickupDate                 *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    RequiredDeliveryDate             *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ScheduledDeliveryDate            *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ActualDeliveryDate               *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CustomerRemarks                  *string</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CounselorRemarks                 Nullable[*string]</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PickupAddress                    *Address</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PickupAddressID                  *uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    DestinationAddress               *Address</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    DestinationAddressID             *uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    DestinationType                  *DestinationType</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    MTOAgents                        MTOAgents</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    MTOServiceItems                  MTOServiceItems</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SecondaryPickupAddress           *Address</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SecondaryPickupAddressID         *uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SecondaryDeliveryAddress         *Address</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SecondaryDeliveryAddressID       *uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SITDaysAllowance                 *int</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SITExtensions                    SITExtensions</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PrimeEstimatedWeight             *unit.Pound</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PrimeEstimatedWeightRecordedDate *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PrimeActualWeight                *unit.Pound</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    BillableWeightCap                *unit.Pound</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    BillableWeightJustification      *string</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    NTSRecordedWeight                *unit.Pound</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ShipmentType                     MTOShipmentType</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Status                           MTOShipmentStatus</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Diversion                        bool</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    RejectionReason                  *string</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Distance                         *unit.Miles</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    Reweigh                          *Reweigh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UsesExternalVendor               bool</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    StorageFacility                  *StorageFacility</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    StorageFacilityID                *uuid.UUID</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    ServiceOrderNumber               *string</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    TACType                          *LOAType</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    SACType                          *LOAType</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    PPMShipment                      *PPMShipment</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    CreatedAt                        time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    UpdatedAt                        time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    DeletedAt                        *time.Time</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Handlers would be in charge of converting payloads into the MTOShipmentUpdate struct and passing it to the UpdateShipment service. The UpdateShipment service would be responsible for fetching the database model (MTOShipment) and updating it appropriately based on the <code>Present</code> fields in the MTOShipmentUpdate.</p><p>Such a design would have many advantages in addition to solving the problem of partial model updates and setting fields to null. The UpdateMTOShipment struct provides clarity by broadcasting intent: it clearly exists to update a shipment and it tells the service exactly what it wants. It also helps to further disentangle the handler layer from the database and services; since the handler now uses the MTOShipmentUpdate struct, it no longer needs to know about the database structure. This design will also allow for a thorough cleanup of a lot of the handler and service logic through removal of repeated null checking and shifting business logic responsibilities cleanly to the services.</p><p>The intention of implementing this proposal is to introduce an option for our endpoints in cases where it would be beneficial. While it likely isn&#x27;t necessary or worth it to refactor all endpoints to use intermediate structs, the door would be opened to using them where it would be beneficial for existing or future models that may need partial updates, or models that simply need to be able to set fields to null. The <a href="https://github.com/transcom/mymove/pull/9503" target="_blank" rel="noopener noreferrer">proof-of-concept PR</a> created to accompany this ADR that introduces this pattern for the MTOShipment model only updates one field to be &quot;nullable&quot;, the <code>counselor_remarks</code> field. This proof-of-concept PR not only introduces this pattern to MilMove, but serves as an incremental step towards making partial updates fully possible for just the MTOShipment model.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirements-and-naming">Requirements and Naming<a href="#requirements-and-naming" class="hash-link" aria-label="Direct link to Requirements and Naming" title="Direct link to Requirements and Naming">‚Äã</a></h3><p>Not every database model requires an &quot;update&quot; struct unless it meets the following criteria:</p><ol><li>It must be updated in unspecific ways (partial updates)</li><li>It requires possible field deletion
If a model simply meets the first criterion, it wouldn&#x27;t necessitate creating a corresponding update struct, but the pattern would be available and it would potentially be a good practice in case the second criterion is ever met in the future.
In the case that an update struct is to be created, it can simply be named after its model with &quot;Update&quot; appended to the end of its name (e.g. MTOShipment -&gt; MTOShipmentUpdate).</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation">Implementation<a href="#implementation" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">‚Äã</a></h3><p>Due to the scope of work required, implementating this pattern would need to be done slowly.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="refactor-stages">Refactor stages<a href="#refactor-stages" class="hash-link" aria-label="Direct link to Refactor stages" title="Direct link to Refactor stages">‚Äã</a></h4><ul><li>Identify and refactor any patch endpoints that require nullable fields for deleting values.</li><li>Fully refactor related validator methods to cleanly handle update structs</li><li>Refactor all update structs to remove dependencies on the <code>models</code> package</li><li>Relocate fully refactored update structs into a separate package for better separation of code</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="proposal-2-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler">Proposal 2: <strong>Handler Transformation</strong> -- move any logic for converting the payload to a model from the service to the handler.<a href="#proposal-2-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" class="hash-link" aria-label="Direct link to proposal-2-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" title="Direct link to proposal-2-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler">‚Äã</a></h2><blockquote><p><strong>proof-of-concept PR:</strong> <a href="https://github.com/transcom/mymove/pull/9858" target="_blank" rel="noopener noreferrer">MB-1402-Shipment_update_poc_handler_logic</a></p></blockquote><p>In this proposal, all logic related to converting the payload to a model will be moved to the handler. Since nullable fields can be imlpemented in the swagger definitions, the handler will have information about which fields were present in the payload, and therefore it will know which fields to &quot;update&quot; in the existing model.
This pattern would solve the issue of not being able to delete fields since the model structs are updated with payload presence information in the handler. However, this would further tie the handlers to the database models and ensure that handlers are still responsible for service-adjacent tasks, like fetching database models (which, to some extent, they do already).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="implementation-1">Implementation<a href="#implementation-1" class="hash-link" aria-label="Direct link to Implementation" title="Direct link to Implementation">‚Äã</a></h3><p>The implementation of this pattern might vary from handler to handler, but the handlers and service that update the MTOShipment model may serve as a good example.</p><p>The flow updating a shipment via the ghc-api is sort of confusing. The <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/handlers/ghcapi/mto_shipment.go#L284" target="_blank" rel="noopener noreferrer">UpdateMTOShipmentHandler</a> fetches the existing model from the database, creates a new model from the payload, updates <em>some</em> of the fields in the payload model with fields from the existing model, and passes the payload model to the service. Subsequently, the <a href="https://github.com/transcom/mymove/blob/de9148371427ba348e94439b4acb766f05013797/pkg/services/mto_shipment/mto_shipment_updater.go" target="_blank" rel="noopener noreferrer">MTOShipmentUpdater service</a> fetches the database model again, updates fields in that model based on fields that are not nil in the payload model, and saves the database model (and does other service things, e.g. validation). In this case, both the handler and the service are in some ways responsible for updating a model with information from the payload and the database model.
With the implementation of this proposal, the handler still fetches the existing model from the database, and it has the option to <a href="https://github.com/transcom/mymove/blob/762eae697d87f16a7fecd734dc3ec8a832d73e8b/pkg/handlers/ghcapi/internal/payloads/payload_to_model.go#L346" target="_blank" rel="noopener noreferrer">update only the fields in that model that are present in the payload</a>. It can then pass this updated model to the service, which will <a href="https://github.com/transcom/mymove/pull/9858/files#diff-61462ff1f1c3c378fa84dac247390a2b0b2cd35d5de3c2ea7a54d3a858f50572" target="_blank" rel="noopener noreferrer">no longer fetch the existing database model and check to update each of its fields</a>; instead the service will simply save the model, in addition to its other service responsibilities.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="considered-options">Considered Options<a href="#considered-options" class="hash-link" aria-label="Direct link to Considered Options" title="Direct link to Considered Options">‚Äã</a></h2><ul><li><strong>Intermediate Structs</strong> -- introduce a new struct that serves between the handler and service layers and broadcasts intent</li><li><strong>Handler Transformation</strong> -- move any logic for converting the payload to a model from the service to the handler</li><li><em>Update model to store information about &quot;presence&quot;</em></li><li><em>Pass payload to service</em></li><li><em>Do nothing</em></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="decision-outcome">Decision Outcome<a href="#decision-outcome" class="hash-link" aria-label="Direct link to Decision Outcome" title="Direct link to Decision Outcome">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chosen-option-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler">Chosen Option: <strong>Handler Transformation</strong> -- move any logic for converting the payload to a model from the service to the handler<a href="#chosen-option-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" class="hash-link" aria-label="Direct link to chosen-option-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" title="Direct link to chosen-option-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler">‚Äã</a></h3><ul><li><code>+</code> <em>Addresses issue of not being able to delete fields with patches</em></li><li><code>+</code> <em>Relatively simple to implement in existing handlers</em></li><li><code>+</code> <em>Doesn&#x27;t overcomplicate service validators</em></li><li><code>-</code> <em>Handlers responsible for a lot of logic, including fetching db model and updating that fetched struct with payload intelligently</em></li><li><code>-</code> <em>Handlers and endpoints still coupled to database models</em></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pros-and-cons-of-the-alternatives">Pros and Cons of the Alternatives<a href="#pros-and-cons-of-the-alternatives" class="hash-link" aria-label="Direct link to Pros and Cons of the Alternatives" title="Direct link to Pros and Cons of the Alternatives">‚Äã</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent"><strong>Intermediate Structs</strong> -- introduce a new struct that serves between the handler and service layers and broadcasts intent.<a href="#intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" class="hash-link" aria-label="Direct link to intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" title="Direct link to intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent">‚Äã</a></h3><ul><li><code>+</code> <em>Addresses issue of not being able to delete fields with patches</em></li><li><code>+</code> <em>Clearly broadcasts intent to handlers and services.</em></li><li><code>+</code> <em>Takes a step towards decoupling handlers and api endpoints from the database and its models.</em></li><li><code>-</code> <em>Composite struct models have dependencies on current <code>models</code> package which means they cannot be separated into a new package without introducing circular dependencies</em></li><li><code>-</code> <em>Complicates service validators, which must now handle new intermediate struct</em></li><li><code>-</code> <em>Lots of work to implement</em></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-model-to-store-information-about-presence"><em>Update model to store information about &quot;presence&quot;</em><a href="#update-model-to-store-information-about-presence" class="hash-link" aria-label="Direct link to update-model-to-store-information-about-presence" title="Direct link to update-model-to-store-information-about-presence">‚Äã</a></h3><ul><li><code>+</code> <em>Addresses issue of not being able to delete fields with patches</em></li><li><code>+</code> <em>Little added effort when updating model with additional fields</em></li><li><code>-</code> <em>Violates expectations of pop database models</em></li><li><code>-</code> <em>Large amount of work involved in refactoring current models and all services that use them</em></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pass-payload-to-service"><em>Pass payload to service</em><a href="#pass-payload-to-service" class="hash-link" aria-label="Direct link to pass-payload-to-service" title="Direct link to pass-payload-to-service">‚Äã</a></h3><p>The handlers would no longer transform payloads to service models and instead pass the payload to the service</p><ul><li><code>+</code> <em>Addresses issue of not being able to delete fields with patches</em></li><li><code>+</code> <em>Cleans up handler and service logic (removes a lot of repeated null checks and shifts more responsibilities to service)</em></li><li><code>-</code> <em>Further entangles handler and service (service now works with payload model)</em></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="do-nothing"><em>Do nothing</em><a href="#do-nothing" class="hash-link" aria-label="Direct link to do-nothing" title="Direct link to do-nothing">‚Äã</a></h3><ul><li><code>+</code> <em>No additional work</em></li><li><code>-</code> <em>Does not address issue of not being able to delete fields with patches</em></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0076-partial-update-patches.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/adrs/cli-spinner"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">0075 Remove CLI Spinner</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/adrs/use-playwright"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">0076 Convert integration tests to Playwright</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#goal" class="table-of-contents__link toc-highlight">Goal</a><ul><li><a href="#useful-definition" class="table-of-contents__link toc-highlight">Useful definition</a></li></ul></li><li><a href="#proposal-1-intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" class="table-of-contents__link toc-highlight">Proposal 1: <strong>Intermediate Structs</strong> -- introduce a new struct that serves between the handler and service layers and broadcasts intent.</a><ul><li><a href="#requirements-and-naming" class="table-of-contents__link toc-highlight">Requirements and Naming</a></li><li><a href="#implementation" class="table-of-contents__link toc-highlight">Implementation</a></li></ul></li><li><a href="#proposal-2-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" class="table-of-contents__link toc-highlight">Proposal 2: <strong>Handler Transformation</strong> -- move any logic for converting the payload to a model from the service to the handler.</a><ul><li><a href="#implementation-1" class="table-of-contents__link toc-highlight">Implementation</a></li></ul></li><li><a href="#considered-options" class="table-of-contents__link toc-highlight">Considered Options</a></li><li><a href="#decision-outcome" class="table-of-contents__link toc-highlight">Decision Outcome</a><ul><li><a href="#chosen-option-handler-transformation----move-any-logic-for-converting-the-payload-to-a-model-from-the-service-to-the-handler" class="table-of-contents__link toc-highlight">Chosen Option: <strong>Handler Transformation</strong> -- move any logic for converting the payload to a model from the service to the handler</a></li></ul></li><li><a href="#pros-and-cons-of-the-alternatives" class="table-of-contents__link toc-highlight">Pros and Cons of the Alternatives</a><ul><li><a href="#intermediate-structs----introduce-a-new-struct-that-serves-between-the-handler-and-service-layers-and-broadcasts-intent" class="table-of-contents__link toc-highlight"><strong>Intermediate Structs</strong> -- introduce a new struct that serves between the handler and service layers and broadcasts intent.</a></li><li><a href="#update-model-to-store-information-about-presence" class="table-of-contents__link toc-highlight"><em>Update model to store information about &quot;presence&quot;</em></a></li><li><a href="#pass-payload-to-service" class="table-of-contents__link toc-highlight"><em>Pass payload to service</em></a></li><li><a href="#do-nothing" class="table-of-contents__link toc-highlight"><em>Do nothing</em></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.2d8cf14e.js"></script>
<script src="/mymove-docs/assets/js/main.72cd5155.js"></script>
</body>
</html>