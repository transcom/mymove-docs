<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-api/docs/push-notifications-to-prime">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Push Notifications to Prime | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/api/docs/push-notifications-to-prime"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Push Notifications to Prime | MilMove Developer Portal"><meta data-rh="true" name="description" content="The push mechanism is a way to notify the Prime of changes as they happen."><meta data-rh="true" property="og:description" content="The push mechanism is a way to notify the Prime of changes as they happen."><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/api/docs/push-notifications-to-prime"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/api/docs/push-notifications-to-prime" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/api/docs/push-notifications-to-prime" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.2d8cf14e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.72cd5155.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/api">MilMove API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/api/admin">Swagger Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a href="https://github.com/transcom/prime_api_deliverable" target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true">Docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://github.com/transcom/prime_api_deliverable" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Prime API Deliverable<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/api/docs/push-notifications-to-prime">Push Notifications to Prime</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/api/guides/api-programming-guide">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/api/testing/acceptance-testing-prime-api-endpoints">Testing</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Docs</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Push Notifications to Prime</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Push Notifications to Prime</h1><p>The push mechanism is a way to notify the Prime of changes as they happen.</p><p>We will be using Web Hooks to implement the push mechanism.</p><blockquote><p>Webhooks are a useful and a resource-light way to implement event reactions. Web hooks provide a mechanism where by a server-side application can notify a client-side application when a new event (that the client-side application might be interested in) has occurred on the server.</p><p>Source: <a href="https://codeburst.io/what-are-webhooks-b04ec2bf9ca2" target="_blank" rel="noopener noreferrer">https://codeburst.io/what-are-webhooks-b04ec2bf9ca2</a></p></blockquote><p>For a quick primer on REST hooks and overview of webhooks - this is a great start → <a href="https://resthooks.org/docs/" target="_blank" rel="noopener noreferrer">https://resthooks.org/docs/</a></p><p>For this to work, all updates to objects that are of interest to the Prime should trigger an event. The notifications code will check the event to see if there is an active subscription to this event and store a notification record and payload to be sent to the Prime.</p><p>It&#x27;s important to note that since Milmove is a Dod property, the connection to the subscriber will be an mTLS connection.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="design">Design<a href="#design" class="hash-link" aria-label="Direct link to Design" title="Direct link to Design">​</a></h2><p>There are three components of the solution</p><ul><li><strong>Subscribe to Notifications</strong> - The prime will subscribe to notifications using a URL that Milmove can send a POST request to.</li><li><strong>Generate Notifications</strong> - Updates to the MTO in Milmove will trigger events which will store notifications.</li><li><strong>Send Notifications</strong> - A client will read the notifications and send them to Prime.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="subscribe-to-notifications">Subscribe to Notifications<a href="#subscribe-to-notifications" class="hash-link" aria-label="Direct link to Subscribe to Notifications" title="Direct link to Subscribe to Notifications">​</a></h2><p><img loading="lazy" src="/mymove-docs/assets/images/subscribe-notifications-e37e1b278871a04e55bc00fb1aa152d7.png" width="753" height="209" class="img_ev3q"></p><p>We create a table to hold the subscriptions so we can add, delete and modify their subscriptions.</p><p>We need a certificate to send them the notifications, so subscription records should have an id that can be used to find the certificate.</p><p>A subscription consists of <code>Object+verb event code</code>, <code>subscriberID</code>, <code>url</code> to
contact and <code>subscription</code> status.</p><blockquote><p>Subscription endpoints are not MVP. This means that we will not create
endpoints for subscribe/delete etc.. With only one subscriber, endpoints for
self-service have limited value compared to a typical rest hooks
implementation.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generate-notifications">Generate Notifications<a href="#generate-notifications" class="hash-link" aria-label="Direct link to Generate Notifications" title="Direct link to Generate Notifications">​</a></h2><p><img loading="lazy" src="/mymove-docs/assets/images/generate-notifications-217da5dba46615abe111b071d3f17d0c.png" width="943" height="283" class="img_ev3q"></p><p>Next, we generate events when they occur in our system, by calling an event package. The event function will collect information that will allow the audit pkg and notifications pkg to assemble the record that they need to store.</p><p>Relevant code is in <strong><a href="https://github.com/transcom/mymove/blob/main/pkg/services/event/event.go" target="_blank" rel="noopener noreferrer">pkg/services/event/event.go</a></strong></p><p>Event struct will contain the following parameters</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">type Event struct {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   EventKey        KeyType                 // Pick from a select list of predefined events (PaymentRequest.Create)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   Request         *http.Request           // We expect to get this from the handler</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   MtoID           uuid.UUID               // This is the ID of the MTO that the object is associated with</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   UpdatedObjectID uuid.UUID               // This is the ID of the object itself (PaymentRequest.ID)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   EndpointKey     EndpointKeyType         // Pick from a select list of endpoints</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   DBConnection    *pop.Connection         // The pop connection DB</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   HandlerConfig   handlers.HandlerConfig  // The handler config</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   logger          handlers.Logger         // The logger</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Dev would call event trigger code such as</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">_, err := TriggerEvent(Event{</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   EndpointKey:     SupportUpdatePaymentRequestStatusEndpointKey,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   EventKey:        PaymentRequestCreateEventKey,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   UpdatedObjectID: paymentRequestID,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   MtoID:           mtoID,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   Request:         &amp;dummyRequest,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   HandlerConfig:   handler,</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   DBConnection:    h.DB(),</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For more information on triggering events, read <a href="/mymove-docs/docs/backend/guides/how-to/add-an-event-trigger">How to Add an Event Trigger</a></p><p>Note: The event package is generic and services all events for all internal and external needs. It will not sanitize or assemble the data for the Prime notifications. It should initially support the expected needs of the notifications and audit records.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="event-types">Event Types<a href="#event-types" class="hash-link" aria-label="Direct link to Event Types" title="Direct link to Event Types">​</a></h2><p>For notifications, we need to break down our MTO into smaller logical objects to be able to send over smaller updates than the full MTO.</p><p>For an effective solution, we had to pick a level of granularity for the events and notification bodies.</p><p>We do not want to send the whole MTO on each event, not do we want to send a single address record. Instead we have picked a set of logical objects that match updates that the Prime would like to see.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logical-objects">Logical Objects<a href="#logical-objects" class="hash-link" aria-label="Direct link to Logical Objects" title="Direct link to Logical Objects">​</a></h3><p>Logical Objects that the Prime is interested in are:</p><ul><li>Move - Consists of <code>Move</code> and <code>Contractors</code></li><li>Orders - Consists of <code>Orders</code>, <code>Customer</code>, <code>Entitlement</code>, <code>DutyStation</code>, and <code>Address</code>.</li><li>MTOShipment - Consists of <code>MTOShipment</code>, <code>Agent</code> and <code>Address</code>.</li><li>MTOServiceItem - Consists of <code>MTOServiceItem</code>, <code>MTOServiceItemDimensions</code>, <code>MTOServiceItemCustomerContacts</code></li><li>PaymentRequest - Consists of <code>PaymentRequest</code>, <code>PaymentServiceItems</code>, <code>PaymentServiceItemParams</code> and <code>Uploads</code></li></ul><p>What this means is an update to an address on an MTOShipment should result in an &quot;MTOShipment.Update&quot; event.</p><p><img loading="lazy" src="/mymove-docs/assets/images/push-objects-fed3803c5ca838daa527f160ae2719b6.png" width="704" height="682" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="notifications">Notifications<a href="#notifications" class="hash-link" aria-label="Direct link to Notifications" title="Direct link to Notifications">​</a></h2><p>The notifications code will register a handler with the event package. When an event happens, the event pkg will call each registered handler.</p><div class="language-golang codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-golang codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">   for i := 0; i &lt; len(registeredEventHandlers); i++ {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       err := registeredEventHandlers[i](&amp;event)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       if err != nil {</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">           errorList = append(errorList, err)</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">       }</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">   }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The handler will then assemble the data it needs to store in its record. It can also contain its own logic about whether a notification needs to be sent.</p><p><code>NotificationEventHandler</code> function will get the <code>EventKey</code>, <code>MtoID</code>, <code>Request</code> params, and <code>ObjectID</code>.</p><p>It will check that the originator of the action was not the same as the prime, that the MTO is available to prime and if so, create a payload from the logical object.</p><p>It will store a record with all relevant information including the payload in the notifications table.</p><p>Relevant code is in <strong><a href="https://github.com/transcom/mymove/blob/main/pkg/services/event/notification.go" target="_blank" rel="noopener noreferrer">pkg/services/event/notification.go</a></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="send-notifications">Send Notifications<a href="#send-notifications" class="hash-link" aria-label="Direct link to Send Notifications" title="Direct link to Send Notifications">​</a></h2><p><img loading="lazy" src="/mymove-docs/assets/images/send-notifications-775bdb40f2725554cc5ed8534e0c0593.png" width="1999" height="752" class="img_ev3q"></p><p>To send the payload, we use an app called the webhook-client that will
periodically check the webhook_notifications table and send to the Prime.</p><p>The app will be asynchronous to the rest of the handling of the event. This is intentional to avoid increasing the time to execute the handler.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/api/docs/push-notifications-to-prime.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MilMove API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/api/guides/api-programming-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">API Programming Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#design" class="table-of-contents__link toc-highlight">Design</a></li><li><a href="#subscribe-to-notifications" class="table-of-contents__link toc-highlight">Subscribe to Notifications</a></li><li><a href="#generate-notifications" class="table-of-contents__link toc-highlight">Generate Notifications</a></li><li><a href="#event-types" class="table-of-contents__link toc-highlight">Event Types</a><ul><li><a href="#logical-objects" class="table-of-contents__link toc-highlight">Logical Objects</a></li></ul></li><li><a href="#notifications" class="table-of-contents__link toc-highlight">Notifications</a></li><li><a href="#send-notifications" class="table-of-contents__link toc-highlight">Send Notifications</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.2d8cf14e.js"></script>
<script src="/mymove-docs/assets/js/main.72cd5155.js"></script>
</body>
</html>