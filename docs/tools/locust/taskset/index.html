<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tools/locust/taskset">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">TaskSet | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/tools/locust/taskset"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TaskSet | MilMove Developer Portal"><meta data-rh="true" name="description" content="Tasks are distinct functions, or callables, that tell Locust what to do during load testing. A task"><meta data-rh="true" property="og:description" content="Tasks are distinct functions, or callables, that tell Locust what to do during load testing. A task"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/tools/locust/taskset"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/tools/locust/taskset" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/tools/locust/taskset" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.cb78340e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.70764974.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/tools">MilMove Tools</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/cicd">CI/CD</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/dockerfile/dockerfile-use,-purpose,-and-documentation">Dockerfile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/docusaurus/">Docusaurus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/tools/locust/">Locust</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/">Locust</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/running-load-tests">Running Load Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/running-locust-locally">Running Locust Locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/local-load-test-setup">Local Load Test Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/running-locust-from-aws">Running Locust from AWS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/working-with-load-tests">Working With Load Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/locustfile">Locustfile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/tools/locust/taskset">TaskSet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/adding-or-editing-load-tests">Adding or Editing Load Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/fake-data-generation">Fake Data Generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/tools/locust/api-parsers">API Parsers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/mockery/generate-mocks-with-mockery">Mockery</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/postman/setting-up-postman">Postman</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/schemaspy/">SchemaSpy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/tools/telemetry/running-telemetry-locally">Telemetry</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Locust</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TaskSet</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>TaskSet</h1><p>Tasks are distinct functions, or callables, that tell Locust what to do during load testing. A task
is, in essence, a load test. <code>TaskSet</code> classes are a way to link tasks together and keep the code
organized. Task sets and functions should all be defined in python files in the <code>tasks/</code> directory.</p><p>It is possible for a user class to have more than one task set, but it&#x27;s important to keep in mind
is that if a user has more than one task set, they will only ever switch between the task sets if
you remember to have the task set stop at some point. Otherwise, the user will just stay stuck on
their first task set until the load tests end. It is also important to note that if a user has more than
one <code>TaskSet</code>, the one they pick is random. The <code>TaskSets</code> will have weights that affect how likely each
one is to be picked, which can be set as needed to modify the probability of each one being picked.
An example of a user with multiple <code>TaskSets</code> will be included below.</p><p>An example <code>TaskSet</code> for this project might be:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">Example of a TaskSet file...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> http </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> HTTPStatus</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> locust </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> tag</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> task</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">request </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> log_response_failure</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> log_response_info</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">rest </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> RestResponseContextManager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">task </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> RestTaskSet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># tags are useful to add at a TaskSet and task level to enable running only specific load tests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#8dc891">@tag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;mainTasks&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PrimeTasks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">RestTaskSet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    Description of the flow for these tasks here.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">stop</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        This ensures that at some point, the user will stop running the tasks in this task set.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">interrupt</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@tag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;doSomething&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">do_something</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        Do a task! Tasks generally have three steps: Set-up, make a request, validate/log results</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># Prep the path and request kwargs. Using &quot;1&quot; for the moveID for the sake of simplicity here,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># but in a regular load test, you would need to have some way of getting this.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        moves_path</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> request_kwargs </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">request_preparer</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">prep_prime_request</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">          endpoint</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;/move-task-orders/1&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> endpoint_name</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;/move-task-orders/{moveID}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># Now make the request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">with</span><span class="token plain"> self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">rest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">method</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;GET&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> url</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">moves_path</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">**</span><span class="token plain">request_kwargs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999"># This will let our editors know that we expect `resp` to be an instance of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999"># `RestResponseContextManager`, which then lets it know what type hints to suggest below.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            resp</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> RestResponseContextManager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999"># This function helps us log the response status code uniformly across requests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            log_response_info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">resp</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> HTTPStatus</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">OK</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string-interpolation string" style="color:#8dc891">f&quot;\nℹ️ </span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">{</span><span class="token string-interpolation interpolation">resp</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">.</span><span class="token string-interpolation interpolation">js</span><span class="token string-interpolation interpolation operator" style="color:#d7deea">=</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">}</span><span class="token string-interpolation string" style="color:#8dc891">\n&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># This function helps us log info about the response and request when there are errors.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                log_response_failure</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">resp</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># if you wanted to, you could mark this load test as a failure by doing this:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                resp</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">failure</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Move not found!&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that we are using the <code>RestTaskSet</code> as our parent class. It enables easier testing and more
control over whether a load test should be considered a success or failure. Among the things it
provides are the <code>self.request_preparer</code> object and <code>self.rest</code> context manager.</p><p>The <code>request_preparer</code> is an instance of the helper class mentioned earlier called
<code>MilMoveRequestPreparer</code> and has several helper functions for preparing to make a request to the
<code>mymove</code> server:</p><ul><li><code>prep_ghc_request</code></li><li><code>prep_internal_request</code></li><li><code>prep_prime_request</code></li><li><code>prep_support_request</code></li></ul><p>Each of these takes an endpoint, e.g. <code>/move-task-orders/1</code> (like in the example above). They can
also optionally take an <code>endpoint_name</code> argument that is useful for the purposes of locust request
grouping. So in the example above, we use <code>endpoint_name=&quot;/move-task-orders/{moveID}&quot;</code>. That way
instead of <code>locust</code> having each request to an endpoint like <code>/move-task-orders/{moveID}</code> be its own
group, e.g. <code>/move-task-orders/1</code> , <code>/move-task-orders/2</code>, etc., <code>locust</code> will group them all under
the same name.</p><p>Each of these functions will return a tuple containing the URL to use (stored in <code>moves_path</code>
above), and the keyword arguments (or kwargs, called <code>request_kwargs</code> above) to pass to <code>self.rest</code>.</p><p>The <code>rest</code> context manager makes it easier to work with responses by:</p><ul><li>providing a variable you can use (called <code>resp</code> above) to mark the load test as a success (by
calling <code>resp.success()</code>) or a failure (<code>resp.failure(&quot;message&quot;)</code> like at the end of the example).</li><li>automatically parsing the response content into <code>json</code> and failing the load test if it can&#x27;t be
parsed. The parsed <code>json</code> response content can be accessed in <code>resp.js</code>.<ul><li>In an example earlier, you can see <code>parse_response_json</code> being used. The context manager uses
that internally to populate <code>resp.js</code>.</li><li>This isn&#x27;t called <code>resp.json</code> because that&#x27;s already a method on the <code>resp</code> object.</li></ul></li><li>automatically catching of any exceptions that may be raised in your <code>with</code> block, which will then
mark the load test as a failure and format an error message to display in the results.</li></ul><p>Also note that we included a <code>stop</code> task that means at some point, that task will be selected and
the task set will end, passing control back to the parent. In our case this means the user class,
but locust does allow nested task sets, in which case it would give control back to the parent task
set.</p><p>One last thing to point out is that we used the <code>@task</code> decorator for the <code>TaskSet</code>&#x27;s
methods/functions. This is the key part that turns the methods into load tests. Any methods that
don&#x27;t have the <code>@task</code> decorator will be regular methods that the <code>TaskSet</code> has access to.</p><p>For more details on <code>TaskSet</code>s, see the
<a href="https://docs.locust.io/en/stable/tasksets.html" target="_blank" rel="noopener noreferrer">locust TaskSet class docs</a>.</p><p>You can link a <code>User</code> class with a task set by passing the task set to the <code>User</code>&#x27;s <code>tasks</code>
attribute like this:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">Example of a TaskSet file...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> locust </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> HttpUser</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> between</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> tasks</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">prime </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> PrimeTasks</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> SupportTasks</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MyUser</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">HttpUser</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    A user that can test things...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    tasks </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain">PrimeTasks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> SupportTasks</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">1</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># The time (in seconds) Locust waits in between tasks. Can use decimals.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    wait_time </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> between</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">0.25</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">9</span><span class="token punctuation" style="color:#8dc891">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The number next to the task set indicates its relative <em>weight</em> - so in this example, tasks
from <code>PrimeTasks</code> would be 5 times more likely than tasks from <code>SupportTasks</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging-in-as-a-customer-or-office-user">Logging In As A Customer or Office User<a href="#logging-in-as-a-customer-or-office-user" class="hash-link" aria-label="Direct link to Logging In As A Customer or Office User" title="Direct link to Logging In As A Customer or Office User">​</a></h2><p>If you need to be logged in for the load tests, we have a helper function to create users in
<code>utils/auth.py</code> called <code>create_user</code>. You can use it during the <code>on_start</code> method of a <code>TaskSet</code>
like this:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">Example of a task set using the LoginTaskSet functionality.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> locust </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> task</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">auth </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> UserType</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> create_user</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">task </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> RestTaskSet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">MyLoggedInTasks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">RestTaskSet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    Tasks to run that require logging in to the office/ghc or customer/internal APIs.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">on_start</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        Creates a login right at the start of the TaskSet and stops task execution if the login</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        fails.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        success </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> create_user</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">request_preparer</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">request_preparer</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> session</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">client</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                              user_type</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">UserType</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MILMOVE</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">not</span><span class="token plain"> success</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            logger</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">error</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Failed to create a user&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">interrupt</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">stop</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        This ensures that at some point, the user will stop running the tasks in this task set.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">interrupt</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>request_preparer</code> and <code>session</code> are available already on <code>RestTaskSet</code> instances, so the main
thing you need to provide is the <code>user_type</code> you want to create.</p><p>There are multiple other ways to organize and link tasks together, but using our <code>RestTaskSet</code> class
is the main recommendation in this repo.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="expected-failures">Expected Failures<a href="#expected-failures" class="hash-link" aria-label="Direct link to Expected Failures" title="Direct link to Expected Failures">​</a></h2><p>There may be times that you want to create a load test that you expect to fail. E.g. if you want a
load test to cover an endpoint that will reject the request because of some error (eTag, bad data,
etc.). If you want to do that, you can do something like this:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999"># -*- coding: utf-8 -*-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">Example of a TaskSet file...</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> http </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> HTTPStatus</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> locust </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> tag</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> task</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">constants </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> MTO_SHIPMENT</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">parsers </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> APIKey</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> get_api_fake_data_generator</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">request </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> log_response_failure</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> log_response_info</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">rest </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> RestResponseContextManager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">from</span><span class="token plain"> utils</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">task </span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> RestTaskSet</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">logger </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">fake_data_generator </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> get_api_fake_data_generator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999"># tags are useful to add at a TaskSet and task level to enable running only specific load tests.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#8dc891">@tag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;mainTasks&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">class</span><span class="token plain"> </span><span class="token class-name" style="color:#FAC863">PrimeTasks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">RestTaskSet</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    Description of the flow for these tasks here.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">stop</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        This ensures that at some point, the user will stop running the tasks in this task set.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">interrupt</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999"># You can add the expectedFailure tag so that they can all be run if needed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@tag</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">MTO_SHIPMENT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;updateMTOShipmentStatus&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;expectedFailure&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#8dc891">@task</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">def</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">update_mto_shipment_with_invalid_status</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">-</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">None</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#8dc891">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        Tries updating an MTO shipment to an invalid status.</span><br></span><span class="token-line" style="color:#ffffff"><span class="token triple-quoted-string string" style="color:#8dc891">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># For the sake of brevity, this example won&#x27;t include the full setup. You can look at the real</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># PrimeTasks.update_mto_shipment_with_invalid_status method to see the full version.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># This is not how a real mto_shipment would look, but just doing this for the sake of this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># example.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        mto_shipment </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&#x27;id&#x27;</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;TEST123&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;eTag&#x27;</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">12354519</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># This is an invalid status for a shipment to change to through this endpoint.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        overrides </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token string" style="color:#8dc891">&quot;status&quot;</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;DRAFT&quot;</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># Generate fake payload based on the endpoint&#x27;s required fields</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        payload </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> fake_data_generator</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">generate_fake_request_data</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            api_key</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">APIKey</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">PRIME</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            path</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;/mto-shipments/{mtoShipmentID}/status&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            method</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;patch&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            overrides</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">overrides</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># Note that we have an em dash plus &quot;expected failure&quot; to put these in a separate locust group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999"># than the regular shipment status updates.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> request_kwargs </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">request_preparer</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">prep_prime_request</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            endpoint</span><span class="token operator" style="color:#d7deea">=</span><span class="token string-interpolation string" style="color:#8dc891">f&quot;/mto-shipments/</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">{</span><span class="token string-interpolation interpolation">mto_shipment</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">[</span><span class="token string-interpolation interpolation string" style="color:#8dc891">&#x27;id&#x27;</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">]</span><span class="token string-interpolation interpolation punctuation" style="color:#8dc891">}</span><span class="token string-interpolation string" style="color:#8dc891">/status&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            endpoint_name</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;/mto-shipments/{mtoShipmentID}/status — expected failure&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        request_kwargs</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;headers&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;If-Match&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> mto_shipment</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&quot;eTag&quot;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">with</span><span class="token plain"> self</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">rest</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">method</span><span class="token operator" style="color:#d7deea">=</span><span class="token string" style="color:#8dc891">&quot;PATCH&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> url</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">url</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> data</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">json</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">dumps</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">payload</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">**</span><span class="token plain">request_kwargs</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">as</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            resp</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"> RestResponseContextManager</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            log_response_info</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">resp</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> resp</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">status_code </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> HTTPStatus</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">UNPROCESSABLE_ENTITY</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># Note that by default, locust would fail this request because its status code is &gt; 400 so</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># we need to explicitly mark it as a failure.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                resp</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">success</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># If we get any other status code, we didn&#x27;t get the expected request failure, so let&#x27;s mark</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999"># it as a load test failure.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                resp</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">failure</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Got an unexpected result for updating a shipment with an invalid status.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                log_response_failure</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">response</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain">resp</span><span class="token punctuation" style="color:#8dc891">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The main things to note are:</p><ul><li>Adding a tag for expected failures: <code>expectedFailure</code></li><li>Appending <code>— expected failure</code> to the <code>endpoint_name</code><ul><li>Note that if it&#x27;s an endpoint you would not normally have to specify the <code>endpoint_name</code> for,
e.g. <code>/moves</code>, you&#x27;ll need to specify <code>endpoint_name=/moves — expected failure</code>.</li></ul></li><li>Checking for the bad status code you expect, e.g. <code>HTTPStatus.UNPROCESSABLE_ENTITY</code>, a.k.a. <code>422</code><ul><li>Using <code>resp.success()</code> if you got the expected bad status code.</li><li>Using <code>resp.failure(&lt;reason&gt;)</code> and <code>log_response_failure(response=resp)</code> if you get any other
status code.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/tools/locust/taskset.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/tools/locust/locustfile"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Locustfile</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/tools/locust/adding-or-editing-load-tests"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Adding or Editing Load Tests</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#logging-in-as-a-customer-or-office-user" class="table-of-contents__link toc-highlight">Logging In As A Customer or Office User</a></li><li><a href="#expected-failures" class="table-of-contents__link toc-highlight">Expected Failures</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.cb78340e.js"></script>
<script src="/mymove-docs/assets/js/main.70764974.js"></script>
</body>
</html>