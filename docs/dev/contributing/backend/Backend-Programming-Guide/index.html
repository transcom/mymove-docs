<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Backend Programming Guide | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs//mymove-docs/docs/dev/contributing/backend/Backend-Programming-Guide"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Backend Programming Guide | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="Table of Contents"><meta data-react-helmet="true" property="og:description" content="Table of Contents"><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/dev/contributing/backend/Backend-Programming-Guide"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/dev/contributing/backend/Backend-Programming-Guide" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/dev/contributing/backend/Backend-Programming-Guide" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.e9cb1a24.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.6137c858.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.8ef640ee.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove.dev</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mymove-docs/api/prime">Prime</a></li><li><a class="dropdown__link" href="/mymove-docs/api/support">Support</a></li></ul></div><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/">MilMove Developer Docs</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#">Getting Started</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/getting-started/Designers-guide-to-setting-up-app-locally">Designers&#x27;s guide to setting up app locally</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/getting-started/How-to-Test-the-Prime-API">How-to-Test-the-Prime-API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/getting-started/How-to-view-a-move-or-payment-request-in-the-office-app-as-a-TOO-or-TIO">How-to-view-a-move-or-payment-request-in-the-office-app-as-a-TOO-or-TIO</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Contributing</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Frontend</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Backend</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/">Backend</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/API-Errors">API-Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/API-Programming-Guide">API-Programming-Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/API-Style-Guide">API-Style-Guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Backend-Programming-Guide">Backend Programming Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Backend-Structure">Backend Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Dockerfile-use,-purpose,-and-documentation">Dockerfile-use,-purpose,-and-documentation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Feature-Flags-in-the-App">Feature-Flags-in-the-App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Guide-to-Creating-an-Endpoint">Guide-to-Creating-an-Endpoint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/How-to-Add-an-Event-Trigger">How-to-Add-an-Event-Trigger</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/How-to-Set-Up-a-Feature-Flag">How to Set Up a Feature Flag</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Push-Notifications-to-Prime">Push-Notifications-to-Prime</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Session-Management">Session-Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Using-EagerPreload-in-Pop">Using-EagerPreload-in-Pop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/Using-loop-iterator-variables-in-go">Using-loop-iterator-variables-in-go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/WIP-Server-side-validation">WIP-Server-side-validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/access-global-variables">How to Access a Global Application Variable</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/add-application-logging">How to Add Application Logging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/handle-backend-errors">How to handle back-end errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/route-planner">Route Planner Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/service-objects">Backend Service Objects Development Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/soft-delete">How to Soft Delete</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/time">Time in Golang</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/dev/contributing/backend/use-optimistic-locking">What Is Optimistic Locking?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Database</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tools</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Versioning</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Backend Programming Guide</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="table-of-contents"></a>Table of Contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">#</a></h2><ul><li><a href="#go">Go</a><ul><li><a href="#acronyms">Acronyms</a></li><li><a href="#style-and-conventions">Style and Conventions</a></li><li><a href="#importing-dependencies">Importing Dependencies</a></li><li><a href="#querying-the-database-safely">Querying the Database Safely</a></li><li><a href="#modelsfetch-functions"><code>models.Fetch*</code> functions</a></li><li><a href="#logging">Logging</a><ul><li><a href="#logging-levels">Logging Levels</a></li><li><a href="#tip-use-json-friendly-names-for-zapobjects">Tip use JSON friendly names for Zap.Objects</a></li></ul></li><li><a href="#errors">Errors</a><ul><li><a href="#dont-bury-your-errors-in-underscores">Don&#x27;t bury your errors in underscores</a></li><li><a href="#log-at-the-top-level-create-and-pass-along-errors-below">Log at the top level; create and pass along errors below</a></li><li><a href="#use-fmterrorf-and-%25w-verb-when-using-external-libraries">Use <code>fmt.Errorf</code> and <code>%w</code> verb when using external libraries</a></li><li><a href="#dont-fmt-errors-log-instead">Don&#x27;t <code>fmt</code> errors; log instead</a></li><li><a href="#if-some-of-your-errors-are-predictable-pattern-match-on-them-to-provide-more-error-detail">If some of your errors are predictable, pattern match on them to provide more error detail</a></li></ul></li><li><a href="#libraries">Libraries</a><ul><li><a href="#pop">Pop</a></li></ul></li><li><a href="#learning">Learning</a></li><li><a href="#service-objects">Service Objects</a></li><li><a href="#testing">Testing</a><ul><li><a href="#general">General</a></li><li><a href="#coverage">Coverage</a></li><li><a href="#models">Models</a></li></ul></li><li><a href="#time">Time</a></li><li><a href="#miscellaneous-tips">Miscellaneous Tips</a></li></ul></li><li><a href="#environment-settings">Environment settings</a><ul><li><a href="#adding-ulimit">Adding <code>ulimit</code></a></li></ul></li></ul><p>Regenerate with &quot;pre-commit run -a markdown-toc&quot;</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="go"></a>Go<a class="hash-link" href="#go" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="acronyms"></a>Acronyms<a class="hash-link" href="#acronyms" title="Direct link to heading">#</a></h3><p>Domain concepts should be used without abbreviation when used alone.</p><p>Do:</p><ul><li><code>TransportationServiceProvider</code></li><li><code>TrafficDistributionList</code></li></ul><p>Avoid:</p><ul><li><code>TSP</code></li><li><code>TDL</code></li></ul><p>However, when used as a specifier or part of another name, names that have existing acronyms should use the acronym for brevity.</p><p>Do:</p><ul><li><code>TSPPerformance</code></li></ul><p>Avoid:</p><ul><li><code>TransportationServiceProviderPerformance</code></li></ul><p>Acronyms should always be either all caps or all lower-cased.</p><p>Do:</p><ul><li><code>TSPPerformance</code></li><li><code>tspPerformance</code></li></ul><p>Avoid:</p><ul><li><code>tSPPerformance</code></li><li><code>tspperformance</code></li><li><code>TspPerformance</code></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="style-and-conventions"></a>Style and Conventions<a class="hash-link" href="#style-and-conventions" title="Direct link to heading">#</a></h3><p>Generally speaking, we will follow the recommendations laid out in <a href="https://github.com/golang/go/wiki/CodeReviewComments" target="_blank" rel="noopener noreferrer">Go Code Review Comments</a>. By its own admission, this page:</p><blockquote><p><em>...collects common comments made during reviews of Go code, so that a single detailed explanation can be referred to by shorthands. This is a laundry list of common mistakes, not a style guide.</em></p></blockquote><p>Despite not being an official style guide, it covers a good amount of scope in a concise format, and should be able to keep our project code fairly consistent.</p><p>Beyond what is described above, the following contain additional insights into how to write better Go code.</p><ul><li><a href="https://talks.golang.org/2014/names.slide#1" target="_blank" rel="noopener noreferrer">What&#x27;s in a name?</a> (how to name things in Go)</li><li><a href="https://peter.bourgon.org/go-best-practices-2016/" target="_blank" rel="noopener noreferrer">Go best practices, six years in</a></li><li><a href="https://peter.bourgon.org/blog/2017/06/09/theory-of-modern-go.html" target="_blank" rel="noopener noreferrer">A theory of modern Go</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="importing-dependencies"></a>Importing Dependencies<a class="hash-link" href="#importing-dependencies" title="Direct link to heading">#</a></h3><p>Dependencies are managed by <a href="https://github.com/golang/dep" target="_blank" rel="noopener noreferrer">dep</a>. New dependencies are automatically detected in import statements. To add a new dependency to the project:</p><ol><li>Add the package to the import statement of a Go file.</li><li><code>make clean</code></li><li><code>make server_generate</code></li><li><code>dep check</code> (to verify what&#x27;s missing.) If it looks reasonable then...</li><li><code>dep ensure</code></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="querying-the-database-safely"></a>Querying the Database Safely<a class="hash-link" href="#querying-the-database-safely" title="Direct link to heading">#</a></h3><ul><li>SQL statements <em>must</em> use PostgreSQL-native parameter replacement format (e.g. <code>$1</code>, <code>$2</code>, etc.) and <em>never</em> interpolate values into SQL fragments in any other way.</li><li>SQL statements must only be defined in the <code>models</code> package.</li></ul><p>Here is an example of a safe query for a single <code>Shipment</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// db is a *pop.Connection</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">id := &quot;0186ad95-14ed-4c9b-9f62-d5bd124f62a1&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">query := db.Where(&quot;id = $1&quot;, id)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">shipment := &amp;models.Shipment{}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">if err = query.First(shipment); err == nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  pp.Println(shipment)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="modelsfetch-functions"></a><code>models.Fetch*</code> functions<a class="hash-link" href="#modelsfetch-functions" title="Direct link to heading">#</a></h3><p>Functions that return model structs should return pointers.</p><p>Do:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FetchShipment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Connection</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id uuid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UUID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Shipment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Avoid:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">FetchShipment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">db </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">pop</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Connection</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> id uuid</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">UUID</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Shipment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is for a few reasons:</p><ul><li>Many Pop methods that accept models need to use pointers in order to modify the struct being passed in. Using them everywhere
models are used makes the code more consistent and avoids needing to convert to and from pointers.</li><li>Any methods on struct model instances need to have pointer receivers in order to mutate the struct. This is a common point of confusion
and an easy way to introduce bugs into a codebase.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="logging"></a>Logging<a class="hash-link" href="#logging" title="Direct link to heading">#</a></h3><p>We use the <a href="https://github.com/uber-go/zap" target="_blank" rel="noopener noreferrer">Zap</a> logging framework from Uber to produce structured log records.
To this end, code should avoid using the <a href="https://godoc.org/go.uber.org/zap#Logger.Sugar" target="_blank" rel="noopener noreferrer">SugaredLogger</a>s without
a very explicit reason which should be record in an inline comment where the SugaredLogger is constructed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="logging-levels"></a>Logging Levels<a class="hash-link" href="#logging-levels" title="Direct link to heading">#</a></h4><p>Another reason to use the Zap logging package is that it provides more nuanced logging levels than the basic Go logging package.
That said, leveled logging is only meaningful if there is a common pattern in the usage of each logging level. To that end,
the following indicates when each level of Logging should be used.</p><ul><li><p><strong>Fatal</strong> This should never be used outside of the server startup code in main.go. Fatal log messages call <code>sys.exit(1)</code> which unceremoniously kills the server without running any clean up code. This is almost certainly never what you want in production.</p></li><li><p><strong>Error</strong> Reserved for system failures, e.g. cannot reach a database, a DB insert which was expected to work failed,
or an <code>&quot;enum&quot;</code> has an unexpected value. In production an Error logging message should alert the team that
all is not well with the server, so avoid being the &#x27;Boy Who Cried Wolf&#x27;. In particular, if there is an API which takes an object ID as part of the URL,
then passing a bad value in should NOT log an Error message. It should log Info and then return 404.</p></li><li><p><strong>Warn</strong> Don&#x27;t use Warn - it rarely, if ever, adds any meaningful signal to the logs.</p></li><li><p><strong>Info</strong> Use for recording &#x27;Normal&#x27; events at a granularity that may be helpful to tracing and debugging requests,
e.g. 404&#x27;s from requests with bad IDs, authentication events (user logs in/out), authorization failures etc.</p></li><li><p><strong>Debug</strong> Debug events are of questionable value and should be used during development, but probably best removed
before landing changes. The issue with them is, if they are left in the code, they quickly become so dense in the logs
as to obscure other debug log entries. This leads to people an arms race of folks adding &#x27;XXXXXXX&#x27; to comments
in order to identify their log items. If you must use them, I suggest adding an, e.g. zap.String(&quot;owner&quot;, &quot;nick&quot;)</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="tip-use-json-friendly-names-for-zapobjects"></a>Tip use JSON friendly names for Zap.Objects<a class="hash-link" href="#tip-use-json-friendly-names-for-zapobjects" title="Direct link to heading">#</a></h4><p>Use JSON friendly names for Zap.Objects since then you will be able to extract the values easily in CloudWatch Insights queries.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EDIs processed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;edisProcessed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ediProcessing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>vs</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EDIs processed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> zap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Object</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;EDIs Processed&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ediProcessing</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The latter was nearly impossible to filter on. But the following insights query works</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">fields @timestamp, edisProcessed, @message</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| sort @timestamp desc</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="errors"></a>Errors<a class="hash-link" href="#errors" title="Direct link to heading">#</a></h3><p>Some general guidelines for errors:</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="dont-bury-your-errors-in-underscores"></a>Don&#x27;t bury your errors in underscores<a class="hash-link" href="#dont-bury-your-errors-in-underscores" title="Direct link to heading">#</a></h4><p>If a function or other action generates an error, assign it to a variable and either return it as part of your function&#x27;s output or handle it in place (<code>if err != nil</code>, etc.). There will be the very occasional exception to this - one is within tests, depending on the test&#x27;s goal. If you find yourself typing that underscore, take a moment to ask yourself why you&#x27;re choosing that option. On those very rare occasions when it is the correct behavior, please add a comment explaining why.</p><p><em>Don&#x27;t:</em>
<code>myVal, _ := functionThatShouldReturnAnInt()</code></p><p><em>Do:</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    myVal, err := functionThatShouldReturnAnInt()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">         return myVal, fmt.Errorf(&quot;function didn&#x27;t return an int: %w&quot;, err)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="log-at-the-top-level-create-and-pass-along-errors-below"></a>Log at the top level; create and pass along errors below<a class="hash-link" href="#log-at-the-top-level-create-and-pass-along-errors-below" title="Direct link to heading">#</a></h4><p>If you&#x27;re creating a query (1) that is called by a function (2) that is in turned called by another function (3), create and return errors at levels 1 and 2 (and possibly handle them immediately after creation, if needed), and log them at level 3. Logs should be created at the top level and contain context about what created them. This is more difficult if logs are being created in every function and file that supports the operation you&#x27;re working on. Here&#x27;s an example of when to create errors and when to handle them:</p><p>In <code>pkg/models/blackout_dates.go</code>, an error is created and returned:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func FetchTSPBlackoutDates(tx *pop.Connection, tspID uuid.UUID, shipment Shipment) ([]BlackoutDate, error) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  err = query.All(&amp;blackoutDates)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return blackoutDates, fmt.Errorf(&quot;Blackout dates query failed: %w&quot;, err)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return blackoutDates, err</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In <code>pkg/awardqueue/awardqueue.go</code>, <code>FetchTSPBlackoutDates</code> is called, and any possible error is handled. This function also returns an error.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func ShipmentWithinBlackoutDates(tspID uuid.UUID, shipment models.Shipment) (bool, error) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  blackoutDates, err := models.FetchTSPBlackoutDates(aq.db, tspID, shipment)</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false, fmt.Errorf(&quot;Error retrieving blackout dates from database: %w&quot;, err)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return len(blackoutDates) != 0, nil</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Finally, at the top level in <code>attemptShipmentOffer</code> in the same file, any errors bubbled up from <code>ShipmentWithinBlackoutDates</code> or <code>FetchTSPBlackoutDates</code> are handled definitively, halting the progress of the longer function if the underlying processes and queries didn&#x27;t complete as expected in the functions being called:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">func (aq *AwardQueue) attemptShipmentOffer(shipment models.Shipment) (*models.ShipmentOffer, error) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  aq.logger.Info(&quot;Attempting to offer shipment&quot;, zap.Any(&quot;shipment_id&quot;, shipment.ID))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  isAdministrativeShipment, err := aq.ShipmentWithinBlackoutDates(tsp.ID, shipment)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    aq.logger.Error(&quot;Failed to determine if shipment is within TSP blackout dates&quot;, zap.Error(err))</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return err</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The error is created and passed along at the lowest level, logged and passed along at the middle level (along with other errors that can happen within that function), and logged again at the highest level before finally halting the progress of the process if an error is present.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="use-fmterrorf-and-w-verb-when-using-external-libraries"></a>Use <code>fmt.Errorf</code> and <code>%w</code> verb when using external libraries<a class="hash-link" href="#use-fmterrorf-and-w-verb-when-using-external-libraries" title="Direct link to heading">#</a></h4><p><a href="https://blog.golang.org/go1.13-errors" target="_blank" rel="noopener noreferrer"><code>fmt.Errorf() with %w</code></a> provides greater error context and a stack trace, making it especially useful when dealing with the opacity that sometimes comes with external libraries. As of go 1.13 <code>fmt.Errorf()</code> provides a new <code>%w</code> verb that replaces the need for <code>errors.Wrap()</code>. It takes a string with the <code>%w</code> in it and the error as parameters: the string and error to provide context and explanation. Keep the string brief and clear, assuming that the fuller cause will be provided by the context <code>%w</code> verb brings. It can also add useful context for errors related to internal code if there might otherwise be unhelpful opacity. <code>fmt.Errorf()</code> in combination with <code>%w</code> also capture stack traces with the additional function of string substitution/formatting for output.</p><p>Instead of just returning the error, offer greater context with something like this:</p><p><em>Current Recommendation:</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return fmt.Errorf(&quot;Pop validate failed: %w&quot;, err)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As this is a recent change in golang standards you will see many uses of the <code>errors.Wrap</code> still in the code, which had been the old recommendation. It is safe to change code that wraps errors as below to the new standard in the example above.</p><p><em>Old Recommendation:</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return errors.Wrap(err, &quot;Pop validate failed&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Using the new <code>%w</code> provides access to some new features such as the new <code>errors.Is</code> and <code>errors.As</code> functions. For more on the changes in go 1.13 see <a href="https://blog.golang.org/go1.13-errors" target="_blank" rel="noopener noreferrer">this official blog post</a> and <a href="https://medium.com/@felipedutratine/golang-how-to-handle-errors-in-v1-13-fda7f035d027" target="_blank" rel="noopener noreferrer">this article</a> that go into more depth.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="dont-fmt-errors-log-instead"></a>Don&#x27;t <code>fmt</code> errors; log instead<a class="hash-link" href="#dont-fmt-errors-log-instead" title="Direct link to heading">#</a></h4><p><code>fmt</code> can provide useful error handling during initial debugging, but we strongly suggest logging instead, from when you write the initial lines of a new function. Using logging creates structured logs instead of the unstructured, human-friendly-only output that <code>fmt</code> does. If an <code>fmt</code> statement offers usefulness beyond your initial troubleshooting while working, switch it to <code>fmt.Errorf(&quot;text: %w&quot;, err)</code> or <code>logger.Error()</code>, perhaps with <a href="https://github.com/uber-go/zap" target="_blank" rel="noopener noreferrer">Zap</a>.</p><p><em>Don&#x27;t:</em>
<code>fmt.Println(&quot;Blackout dates fetch failed: &quot;, err)</code></p><p><em>Do:</em>
<code>logger.Error(&quot;Blackout dates fetch failed: &quot;, err)</code></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="if-some-of-your-errors-are-predictable-pattern-match-on-them-to-provide-more-error-detail"></a>If some of your errors are predictable, pattern match on them to provide more error detail<a class="hash-link" href="#if-some-of-your-errors-are-predictable-pattern-match-on-them-to-provide-more-error-detail" title="Direct link to heading">#</a></h4><p>Some errors are predictable, such as those from the database that Pop returns to us. This gives you the option to use those predictable errors to give yourself and fellow maintainers of code more detail than you might get otherwise, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// FetchServiceMemberForUser returns a service member only if it is allowed for the given user to access that service member.</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> func FetchServiceMemberForUser(ctx context.Context, db *pop.Connection, user User, id uuid.UUID) (ServiceMember, error) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  var serviceMember ServiceMember</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  err := db.Eager().Find(&amp;serviceMember, id)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if err != nil {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    if errors.Cause(err).Error() == recordNotFoundErrorString {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      return ServiceMember{}, ErrFetchNotFound</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Otherwise, it&#x27;s an unexpected err so we return that.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ServiceMember{}, err</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  if serviceMember.UserID != user.ID {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ServiceMember{}, ErrFetchForbidden</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  return serviceMember, nil</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can also use <code>fmt.Errorf(&quot;text: %w&quot;, err)</code> in this situation to provide access to even more information, beyond the breadcrumbs left here.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="libraries"></a>Libraries<a class="hash-link" href="#libraries" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pop"></a>Pop<a class="hash-link" href="#pop" title="Direct link to heading">#</a></h4><p>We use Pop as the ORM(-ish) to mediate access to the database. <a href="https://andrew-sledge.gitbooks.io/the-unofficial-pop-book/content/" target="_blank" rel="noopener noreferrer">The Unofficial Pop Book</a> is a valuable companion to Pop‚Äôs <a href="https://github.com/gobuffalo/pop" target="_blank" rel="noopener noreferrer">GitHub documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="learning"></a>Learning<a class="hash-link" href="#learning" title="Direct link to heading">#</a></h3><p>If you are new to Go, you should work your way through all of these resources (in this order, ideally):</p><ol><li><a href="https://tour.golang.org" target="_blank" rel="noopener noreferrer">A Tour of Go</a> (in-browser interactive language tutorial)</li><li><a href="https://golang.org/doc/code.html" target="_blank" rel="noopener noreferrer">How to Write Go Code</a> (info about the Go environment, testing, etc.)</li><li><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener noreferrer">Effective Go</a> (how to do things ‚Äúthe Go way‚Äù)</li><li><a href="https://golang.github.io/dep/docs/daily-dep.html" target="_blank" rel="noopener noreferrer">Daily Dep documentation</a> (common tasks you‚Äôll encounter with our dependency manager)</li><li><a href="http://exercism.io/languages/go/about" target="_blank" rel="noopener noreferrer">Exercism</a> offers a series of exercises with gradually increasing complexity</li></ol><p>Additional resources:</p><ul><li><a href="https://godoc.org/" target="_blank" rel="noopener noreferrer">GoDoc</a> (where you can read the docs for nearly any Go package)</li><li>Check out the <a href="https://github.com/golang/go/wiki/Learn" target="_blank" rel="noopener noreferrer">Go wiki</a></li><li>Advanced Testing with Go <a href="https://www.youtube.com/watch?v=yszygk1cpEc" target="_blank" rel="noopener noreferrer">Video</a> and <a href="https://about.sourcegraph.com/go/advanced-testing-in-go" target="_blank" rel="noopener noreferrer">Article</a> (great overview of useful techniques, useful for all Go programmers)</li><li><em>Book</em>: <a href="http://www.gopl.io/" target="_blank" rel="noopener noreferrer">The Go Programming Language</a></li><li><em>Article</em>: <a href="https://medium.com/@venks.sa/copying-data-from-s3-to-ebs-30x-faster-using-go-e2cdb1093284" target="_blank" rel="noopener noreferrer">Copying data from S3 to EBS 30x faster using Golang</a></li><li><a href="http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html" target="_blank" rel="noopener noreferrer">50 Shades of Go: Traps, Gotchas, and Common Mistakes for New Golang Devs</a></li><li><a href="https://docs.google.com/document/d/1QQq8Yf90ar59OUQM6qRDS6Bwk5hfOCpcqw_WUX43YOg/edit" target="_blank" rel="noopener noreferrer">Ultimate Go Notebook</a> by Bill Kennedy</li><li><a href="https://www.practical-go-lessons.com" target="_blank" rel="noopener noreferrer">Practical Go Lessons</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="service-objects"></a>Service Objects<a class="hash-link" href="#service-objects" title="Direct link to heading">#</a></h3><p>Service Objects are an architectural design pattern we use to encapsulate business logic. Service objects allow for better unit testing, re-usability, and organization of code in the MilMove project. For more information on service objects, including how we use them and how to write them, please see the <a href="/mymove-docs/docs/dev/contributing/backend/service-objects">documentation</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h3><p>Knowing what deserves a test and what doesn‚Äôt can be tricky, especially early on when a project‚Äôs testing conventions haven‚Äôt been established. Use the following guidelines to determine if and how some code should be tested.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="general"></a>General<a class="hash-link" href="#general" title="Direct link to heading">#</a></h4><ul><li>Use table-driven tests where appropriate.</li><li>Make judicious use of helper functions so that the intent of a test is not lost in a sea of error checking and boilerplate. Use <a href="https://golang.org/pkg/testing/#T.Helper" target="_blank" rel="noopener noreferrer"><code>t.Helper()</code></a> in your test helper functions to keep stack traces clean.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="coverage"></a>Coverage<a class="hash-link" href="#coverage" title="Direct link to heading">#</a></h4><ul><li>Always test exported functions.
Exported functions should be treated as an API layer for other packages.
Cover the expected behavior and error scenarios as a user of that API.</li><li>Try not to test unexported functions.
Unexported functions are implementation details of exported ones
and should not change the intended usage.
If you find that an unexported function is complex and needs testing,
it might mean it needs to be refactored as it&#x27;s exported function elsewhere.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="models"></a>Models<a class="hash-link" href="#models" title="Direct link to heading">#</a></h4><p>In general, focus on testing non-trivial behavior.</p><ul><li>Structs do not need to be tested as they have no behavior of their own.</li><li>Struct methods warrant a unit test if they contain important behavior, e.g. validations.</li><li>Avoid testing functionality of libraries, e.g. model saving and loading (which is provided by Pop)</li><li>Try to leverage the type system to ensure that components are ‚Äúhooked up correctly‚Äù instead of writing integration tests.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="time"></a>Time<a class="hash-link" href="#time" title="Direct link to heading">#</a></h3><p>Some helpful tips on dealing with time
in the MilMove Go codebase
can be found in <a href="/mymove-docs/docs/dev/contributing/backend/time">this doc</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="miscellaneous-tips"></a>Miscellaneous Tips<a class="hash-link" href="#miscellaneous-tips" title="Direct link to heading">#</a></h3><ul><li>Use <code>golang</code> instead of <code>go</code> in Google searches.</li><li>Try to use the standard lib as much as possible, especially when learning.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="environment-settings"></a>Environment settings<a class="hash-link" href="#environment-settings" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="adding-ulimit"></a>Adding <code>ulimit</code><a class="hash-link" href="#adding-ulimit" title="Direct link to heading">#</a></h3><p>Dep appears to open many files simultaneously, particularly as the project matures and depends on more and more third-party repositories. You may encounter a message like this as a <code>dep-status</code> hook error when trying to commit locally: <code>remote repository does not exist, or is inaccessible: : pipe: too many open files</code>.</p><p>To fix this, run <code>ulimit -n 5000</code> in your terminal. This increases the number of file handles (the details on files that a process holds open) on your system. You can run <code>ulimit -n</code> to see how many are currently allowed; you may see a number like 128 or 256. (Run <code>ulimit -a</code> to see all current limits on your system, including pipe size, stack size, and user processes.) If running this in your terminal window allows you to complete your commit, you may wish to add it to <code>/.bash_profile</code> or whichever system file you use for your terminal settings.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/dev/contributing/backend/Backend-Programming-Guide.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/dev/contributing/backend/API-Style-Guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ API-Style-Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/dev/contributing/backend/Backend-Structure"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Backend Structure ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link">Table of Contents</a></li><li><a href="#go" class="table-of-contents__link">Go</a><ul><li><a href="#acronyms" class="table-of-contents__link">Acronyms</a></li><li><a href="#style-and-conventions" class="table-of-contents__link">Style and Conventions</a></li><li><a href="#importing-dependencies" class="table-of-contents__link">Importing Dependencies</a></li><li><a href="#querying-the-database-safely" class="table-of-contents__link">Querying the Database Safely</a></li><li><a href="#modelsfetch-functions" class="table-of-contents__link"><code>models.Fetch*</code> functions</a></li><li><a href="#logging" class="table-of-contents__link">Logging</a></li><li><a href="#errors" class="table-of-contents__link">Errors</a></li><li><a href="#libraries" class="table-of-contents__link">Libraries</a></li><li><a href="#learning" class="table-of-contents__link">Learning</a></li><li><a href="#service-objects" class="table-of-contents__link">Service Objects</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li><li><a href="#time" class="table-of-contents__link">Time</a></li><li><a href="#miscellaneous-tips" class="table-of-contents__link">Miscellaneous Tips</a></li></ul></li><li><a href="#environment-settings" class="table-of-contents__link">Environment settings</a><ul><li><a href="#adding-ulimit" class="table-of-contents__link">Adding <code>ulimit</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/help">Help</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/vault">Vault</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/database">Database</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/testing">Testing</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.6137c858.js"></script>
<script src="/mymove-docs/assets/js/main.8ef640ee.js"></script>
</body>
</html>