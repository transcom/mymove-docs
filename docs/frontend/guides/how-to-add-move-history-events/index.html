<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-frontend/guides/how-to-add-move-history-events">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">How to Track New Events in Move History | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/frontend/guides/how-to-add-move-history-events"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="How to Track New Events in Move History | MilMove Developer Portal"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/frontend/guides/how-to-add-move-history-events"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/frontend/guides/how-to-add-move-history-events" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/frontend/guides/how-to-add-move-history-events" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.4df1b425.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.efac40f6.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.d352c015.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/getting-started/">Getting Started</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/frontend">MilMove Frontend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/frontend/setup/designers-guide-to-setting-up-app-locally">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/frontend/guides/guide-to-implementing-ui">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/guide-to-implementing-ui">Guide to Implementing UI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/access-swagger-endpoints-from-react">How To Call Swagger Endpoints from React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/create-a-form-using-formik">How to Create a Form using Formik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/display-dates-and-times">How to display dates and times</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/how-we-use-react-query">How we use React Query</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/how-to-store-api-data-on-the-front-end">How To Store Data in Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/store-ui-state-in-redux">How To Store UI State in Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/icons">Icons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/react-forms-using-formik">React forms using Formik</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/how-we-use-react-router">How we use react-router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/frontend/guides/how-to-add-move-history-events">How to Track New Events in Move History</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/guides/using-modals">Using Modals</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/frontend/testing/frontend">Testing</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How to Track New Events in Move History</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How to Track New Events in Move History</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>Our Move history component is a useful tool for our office users; when a move is created, changed, or edited, our move history component displays the who, what, and when of those changes. We achieve this through the use of database triggers monitoring certain tables; whenever data in those tables is inserted, deleted, or updated, a record is inserted into our audit_history table to capture that event. This record contains information relevant to the transaction: when it happened, who did it, what table was changed, what was the old data, what is the new data, etc. Because the audit_history table holds the history of all moves, to pull the associated records for a move we use move_history_fetcher.sql to pull only the records that are associated with the currently viewed move.</p><p>In the front end, our MoveHistory component passes the move locator (such as &#x27;AB6PPM&#x27;) to getMoveHistory, receives the relevant data back, and passes that to our TemplateManager. The TemplateManager looks at each row, specifically the action (UPDATE, DELETE, or INSERT), eventName (the operationId), and the tableName, and determines which template to use to display that data (templates are housed in the <a href="https://github.com/transcom/mymove/tree/main/src/constants/MoveHistory/EventTemplates" target="_blank" rel="noopener noreferrer">EventTemplates</a> directory). The template then takes the data and formats it for each particular combination of action, event, and table.</p><p>At its most basic level, here are the changes needed to track a new event in our Move history component:</p><ol><li>Ensure the action is currently being tracked in our audit_history table (and add a trigger if not)</li><li>Check if the action is currently being tracked by our query (and add it if not)</li><li>Create a new event template for it in the EventTemplates directory</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="detailed-workflow">Detailed Workflow<a href="#detailed-workflow" class="hash-link" aria-label="Direct link to Detailed Workflow" title="Direct link to Detailed Workflow">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-ensure-the-action-is-currently-being-tracked-in-our-audit_history-table">1. Ensure the action is currently being tracked in our audit_history table<a href="#1-ensure-the-action-is-currently-being-tracked-in-our-audit_history-table" class="hash-link" aria-label="Direct link to 1. Ensure the action is currently being tracked in our audit_history table" title="Direct link to 1. Ensure the action is currently being tracked in our audit_history table">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="files-create-a-migration">files: create a migration<a href="#files-create-a-migration" class="hash-link" aria-label="Direct link to files: create a migration" title="Direct link to files: create a migration">​</a></h4><p>To accomplish this, trigger the action in the UI, then use the command line or dbeaver to view the audit_history table, sorted by timestamp.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"> audit_history </span><span class="token keyword" style="color:#c5a5c5">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">BY</span><span class="token plain"> action_tstamp_tx </span><span class="token keyword" style="color:#c5a5c5">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the action triggered an entry, you can probably move to the next step. If not, you&#x27;ll need to create a database trigger in a migration (<a href="https://transcom.github.io/mymove-docs/docs/backend/setup/database-migrations/#creating-migrations" target="_blank" rel="noopener noreferrer">documentation for creating a migration</a>):</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">milmove gen migration -n &lt;migration_name&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The migration itself should look something like this:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"> add_audit_history_table</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">target_table :</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;table_name&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> audit_rows :</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">BOOLEAN</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;t&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> audit_query_text :</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">BOOLEAN</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;t&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> ignored_cols :</span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> ARRAY</span><span class="token punctuation" style="color:#8dc891">[</span><span class="token string" style="color:#8dc891">&#x27;created_at&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;updated_at&#x27;</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you&#x27;ve created the migration for a database trigger, run make db_dev_fresh to migrate the changes and reset your db. Use the UI to trigger the action again, check the audit_history table and confirm that a record now exists for the transaction.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-check-if-the-action-is-currently-being-tracked-by-our-query">2. Check if the action is currently being tracked by our query<a href="#2-check-if-the-action-is-currently-being-tracked-by-our-query" class="hash-link" aria-label="Direct link to 2. Check if the action is currently being tracked by our query" title="Direct link to 2. Check if the action is currently being tracked by our query">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="files-move_history_fetchersql">files: <a href="https://github.com/transcom/mymove/blob/main/pkg/assets/sql_scripts/move_history_fetcher.sql" target="_blank" rel="noopener noreferrer">move_history_fetcher.sql</a><a href="#files-move_history_fetchersql" class="hash-link" aria-label="Direct link to files-move_history_fetchersql" title="Direct link to files-move_history_fetchersql">​</a></h4><p>The easiest way to do this is to open a new SQL script in dbeaver, copy the existing move_history_fetcher.sql file over from vscode, and hardcode the locator in single quotes.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">WITH</span><span class="token plain"> move </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        moves</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        moves</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        moves</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">locator </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;AB6PPM&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you execute this, and see an entry for your action (they&#x27;re ordered so the most recent actions will be at the top), you can move on to the next step. Otherwise, you will need to add some sql to this file. There is a chance you can simply build on existing temp tables in this query. For example, if the action you&#x27;re trying to track is address related, it may fit into the existing move_addresses portion of the query. If not, you will have to create a new temp table in this query.</p><p>The design pattern for that is as follows:</p><ol><li>Create a new temp table, using audit_history.object_id to join the existing temp tables to have access to the data you need</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">ppms </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ppm_id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment_type</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment_id</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">object_id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        move_shipments</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_type</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        move_shipments</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        audit_history</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">JOIN</span><span class="token plain"> ppm_shipments </span><span class="token keyword" style="color:#c5a5c5">ON</span><span class="token plain"> audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">object_id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> ppm_shipments</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">JOIN</span><span class="token plain"> move_shipments </span><span class="token keyword" style="color:#c5a5c5">ON</span><span class="token plain"> move_shipments</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> ppm_shipments</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Create another temp table (by convention, the name should end with <code>_logs</code>) to return audit_history rows and context (JSON with whatever extra data you may need thats not included in the audit_history entry)</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">ppm_logs </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token operator" style="color:#d7deea">*</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            jsonb_agg</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                jsonb_strip_nulls</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    jsonb_build_object</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token string" style="color:#8dc891">&#x27;shipment_type&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_type</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                        </span><span class="token string" style="color:#8dc891">&#x27;shipment_id_abbr&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">CASE</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">WHEN</span><span class="token plain"> ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_id </span><span class="token operator" style="color:#d7deea">IS</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">THEN</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">LEFT</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_id::</span><span class="token keyword" style="color:#c5a5c5">TEXT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token number" style="color:#5a9bcf">5</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">ELSE</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">END</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                    </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">::</span><span class="token keyword" style="color:#c5a5c5">TEXT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> context</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">COALESCE</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_id::</span><span class="token keyword" style="color:#c5a5c5">TEXT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">NULL</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain">::</span><span class="token keyword" style="color:#c5a5c5">TEXT</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> context_id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        audit_history</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">JOIN</span><span class="token plain"> ppms </span><span class="token keyword" style="color:#c5a5c5">ON</span><span class="token plain"> ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ppm_id </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">object_id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">WHERE</span><span class="token plain"> audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">table_name </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;ppm_shipments&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        ppms</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">shipment_id</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> audit_history</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Add the <code>_logs</code> temp table to the union chain towards the end of the query</li></ol><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">combined_logs </span><span class="token keyword" style="color:#c5a5c5">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        address_logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">UNION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        sit_logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">UNION</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        ppm_logs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Execute your script in dbeaver to test your script. If it is working, copy the script back over to vscode and replace your hardcoded locator string on line 7 with the original variable.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-a-new-event-template-in-the-eventtemplates-directory-following-the-design-pattern-you-see-in-other-eventtemplates">3. Create a new event template in the EventTemplates directory, following the design pattern you see in other eventTemplates<a href="#3-create-a-new-event-template-in-the-eventtemplates-directory-following-the-design-pattern-you-see-in-other-eventtemplates" class="hash-link" aria-label="Direct link to 3. Create a new event template in the EventTemplates directory, following the design pattern you see in other eventTemplates" title="Direct link to 3. Create a new event template in the EventTemplates directory, following the design pattern you see in other eventTemplates">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="files-tablesjs-operationsjs-fieldmappingsjs">files: <a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/Database/Tables.js" target="_blank" rel="noopener noreferrer">Tables.js</a>, <a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/UIDisplay/Operations.js" target="_blank" rel="noopener noreferrer">Operations.js</a>, <a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/Database/FieldMappings.js" target="_blank" rel="noopener noreferrer">FieldMappings.js</a><a href="#files-tablesjs-operationsjs-fieldmappingsjs" class="hash-link" aria-label="Direct link to files-tablesjs-operationsjs-fieldmappingsjs" title="Direct link to files-tablesjs-operationsjs-fieldmappingsjs">​</a></h4><p>At this point, we know the backend is recording the transaction in question, and our getMoveHistory query is retrieving it. If we go to our Move history on the move, we should see entries for our new history records, with empty details. These are some of the default event templates, which are displayed if there is not a template specific to our combination of action/eventName/tableName. At this point, stub out a new event template (you pick the filename and where it is housed) with something like this:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;react&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports">a</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;constants/MoveHistory/Database/Actions&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports">o</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;constants/MoveHistory/UIDisplay/Operations&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports">t</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;constants/MoveHistory/Database/Tables&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">LabeledDetails</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;pages/Office/MoveHistory/LabeledDetails&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#8dc891">{</span><span class="token imports"> getMtoShipmentLabel </span><span class="token imports punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">from</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;utils/formatMtoShipment&#x27;</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#79b6f2">formatChangedValues</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">historyRecord</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> changedValues </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> historyRecord</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">const</span><span class="token plain"> newChangedValues </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token spread operator" style="color:#d7deea">...</span><span class="token plain">changedValues</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token spread operator" style="color:#d7deea">...</span><span class="token method function property-access" style="color:#79b6f2">getMtoShipmentLabel</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">historyRecord</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#d7deea">...</span><span class="token plain">historyRecord</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#5a9bcf">changedValues</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> newChangedValues </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword module" style="color:#c5a5c5">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#c5a5c5">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">action</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> a</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token constant" style="color:#5a9bcf">INSERT</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// action column in audit_history</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">eventName</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> o</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">createMTOShipment</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// event_name column in audit_history</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token literal-property property" style="color:#5a9bcf">tableName</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> t</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token property-access">mto_shipments</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// table_name column in audit_history</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function-variable function" style="color:#79b6f2">getEventNameDisplay</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&#x27;Created shipment&#x27;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// what you want the Event column to read on the UI</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function-variable function" style="color:#79b6f2">getDetails</span><span class="token operator" style="color:#d7deea">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token parameter">historyRecord</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#d7deea">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token maybe-class-name">LabeledDetails</span><span class="token plain"> historyRecord</span><span class="token operator" style="color:#d7deea">=</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token function" style="color:#79b6f2">formatChangedValues</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">historyRecord</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">/</span><span class="token operator" style="color:#d7deea">&gt;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token comment" style="color:#999999">// LabeledDetails will handle most formatting</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again the key points here are action, eventName, and tableName -- make sure they all align with the row. The formatChangedValues function and LabeledDetails component should do most of the heavy lifting, formatting the changedValues key-value pairs into something that can display on the MoveHistory. You may have to update some of the front end constant files:</p><p><a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/Database/Tables.js" target="_blank" rel="noopener noreferrer">Tables.js</a> for table_name</p><p><a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/UIDisplay/Operations.js" target="_blank" rel="noopener noreferrer">Operations.js</a> for event_name</p><p><a href="https://github.com/transcom/mymove/blob/main/src/constants/MoveHistory/Database/FieldMappings.js" target="_blank" rel="noopener noreferrer">FieldMappings.js</a> for values in changed_values that don&#x27;t yet appear in the UI</p><p>Reach out on slack if you have any questions.</p><p>For reference:</p><ul><li><a href="https://github.com/transcom/mymove/pull/11628" target="_blank" rel="noopener noreferrer">PR 11628</a> follows a semi happy path of implementation</li><li><a href="https://github.com/transcom/mymove/pull/11585" target="_blank" rel="noopener noreferrer">PR 11585</a> has to jump through some hoops to provide requested data via context</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/frontend/guides/how-to-add-move-history-events.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/frontend/guides/how-we-use-react-router"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How we use react-router</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/frontend/guides/using-modals"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Modals</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#detailed-workflow" class="table-of-contents__link toc-highlight">Detailed Workflow</a><ul><li><a href="#1-ensure-the-action-is-currently-being-tracked-in-our-audit_history-table" class="table-of-contents__link toc-highlight">1. Ensure the action is currently being tracked in our audit_history table</a></li><li><a href="#2-check-if-the-action-is-currently-being-tracked-by-our-query" class="table-of-contents__link toc-highlight">2. Check if the action is currently being tracked by our query</a></li><li><a href="#3-create-a-new-event-template-in-the-eventtemplates-directory-following-the-design-pattern-you-see-in-other-eventtemplates" class="table-of-contents__link toc-highlight">3. Create a new event template in the EventTemplates directory, following the design pattern you see in other eventTemplates</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.efac40f6.js"></script>
<script src="/mymove-docs/assets/js/main.d352c015.js"></script>
</body>
</html>