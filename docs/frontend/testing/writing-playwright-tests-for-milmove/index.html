<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-frontend/testing/writing-playwright-tests-for-milmove">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Writing Playwright Tests for MilMove | MilMove Developer Portal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/frontend/testing/writing-playwright-tests-for-milmove"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Writing Playwright Tests for MilMove | MilMove Developer Portal"><meta data-rh="true" name="description" content="This guide covers how MilMove writes tests for Playwright. You should"><meta data-rh="true" property="og:description" content="This guide covers how MilMove writes tests for Playwright. You should"><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/frontend/testing/writing-playwright-tests-for-milmove"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/frontend/testing/writing-playwright-tests-for-milmove" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/frontend/testing/writing-playwright-tests-for-milmove" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.65849403.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.cb78340e.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.70764974.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/integrations">Integrations</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/frontend">MilMove Frontend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/frontend/setup/designers-guide-to-setting-up-app-locally">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/frontend/guides/guide-to-implementing-ui">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/frontend/testing/frontend">Testing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/frontend">Front-end / React Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/how-to-run-frontend-test-coverage-reports">[WIP] How to run Frontend test coverage reports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/unit-test-react-components">How To Unit Test React Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/how-to-view-a-move-or-payment-request-in-the-office-app-as-a-too-or-tio">How to view a move or payment request in the office app as a TOO or TIO</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/writing-frontend-tests-for-milmove">Writing Frontend Tests for MilMove</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/writing-frontend-tests-enzyme-and-react-testing-library">Writing Frontend Tests: Enzyme and React Testing Library</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/writing-tests-using-react-testing-library-and-jest">Writing Tests using React Testing Library and Jest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/frontend/testing/using-factories-to-generate-data-for-frontend-tests">Using factories to generate data for front-end tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/frontend/testing/writing-playwright-tests-for-milmove">Writing Playwright Tests for MilMove</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Testing</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Writing Playwright Tests for MilMove</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Writing Playwright Tests for MilMove</h1><p>This guide covers how MilMove writes tests for Playwright. You should
probably familarize yourself with the <a href="https://playwright.dev/docs/writing-tests" target="_blank" rel="noopener noreferrer">Playwright docs on writing
tests</a>. Some of the best
practices below merely reinforces information from that doc.</p><p>You can almost certainly use some of the knowledge from <a href="/mymove-docs/docs/frontend/testing/writing-tests-using-react-testing-library-and-jest">Writing Tests using React Testing Library and Jest</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices--things-to-know">Best Practices / Things to Know<a href="#best-practices--things-to-know" class="hash-link" aria-label="Direct link to Best Practices / Things to Know" title="Direct link to Best Practices / Things to Know">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-seed-data">No seed data<a href="#no-seed-data" class="hash-link" aria-label="Direct link to No seed data" title="Direct link to No seed data">​</a></h3><p>Unlike our old cypress testing strategy of running a command to load
seed data with hard coded ids that tests can reference, with
Playwright, if a test needs test data in the database, it should create
it using the testharness in the support api. See below for more
details.</p><p>You should be able to run any Playwright test after a <code>make
db_dev_reset db_dev_migrate</code> or after <code>make db_dev_truncate</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="always-always-ensure-your-test-runs-independently">Always (always!) ensure your test runs independently<a href="#always-always-ensure-your-test-runs-independently" class="hash-link" aria-label="Direct link to Always (always!) ensure your test runs independently" title="Direct link to Always (always!) ensure your test runs independently">​</a></h3><p>When adding a test, you should ensure it can run on its own without
any other test. Never have one test depend on another test having run.
That&#x27;s how we get flaky tests!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test-data-growth-can-eventually-cause-test-failures">Test data growth can (eventually) cause test failures<a href="#test-data-growth-can-eventually-cause-test-failures" class="hash-link" aria-label="Direct link to Test data growth can (eventually) cause test failures" title="Direct link to Test data growth can (eventually) cause test failures">​</a></h3><p>The majority of the time, Playwright tests will be run on an empty
database. If you are developing locally and run the tests many times,
each test run will create its own data, causing more and more entries
(e.g. moves) in the database. Having many moves in the database may
cause some tests to fail because they are expecting their newly
created data to show up on the first page of a paginated result, but
the data the test is looking for may instead be on the second or third
page of results.</p><p>While it&#x27;s not ideal for tests to depend on that behavior, sometimes
the effort to make the test more robust is not worth the gain.</p><p>If you start getting failures for tests that used to pass, try <code>make
db_dev_truncate</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-playwright-fixtures">Use Playwright fixtures<a href="#use-playwright-fixtures" class="hash-link" aria-label="Direct link to Use Playwright fixtures" title="Direct link to Use Playwright fixtures">​</a></h3><p>To quote from the <a href="https://playwright.dev/docs/test-fixtures" target="_blank" rel="noopener noreferrer">Playwright documentation on
fixtures</a></p><blockquote><p>Playwright Test is based on the concept of test fixtures. Test
fixtures are used to establish environment for each test, giving the
test everything it needs and nothing else. Test fixtures are
isolated between tests.</p></blockquote><p>We put all of our fixtures in <code>playwright/tests/utils</code>. If you find
you have a common helper function that you want to reuse, please
consider adding it to a fixture in that directory. That allows others
to more easily discover and reuse your helper.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="wait-for-the-page-to-load">Wait for the page to load<a href="#wait-for-the-page-to-load" class="hash-link" aria-label="Direct link to Wait for the page to load" title="Direct link to Wait for the page to load">​</a></h3><p>After performing an action which results in data on the page changing,
use async assertions (see below) to wait for the page to be in the
appropriate state. As much as possible, avoid tying your test to
implementation details about the <a href="https://playwright.dev/docs/network#network-events" target="_blank" rel="noopener noreferrer">network
events</a> and
instead use async assertions (see below) to wait until the data you
need is visible on the page before proceeding.</p><p>See more at the <a href="https://playwright.dev/docs/navigations" target="_blank" rel="noopener noreferrer">Playwright docs for navigation</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prefer-user-facing-attributes-instead-of-css-selectors">Prefer user-facing attributes instead of css selectors<a href="#prefer-user-facing-attributes-instead-of-css-selectors" class="hash-link" aria-label="Direct link to Prefer user-facing attributes instead of css selectors" title="Direct link to Prefer user-facing attributes instead of css selectors">​</a></h3><p>Quoting from the <a href="https://playwright.dev/docs/locators#locating-elements" target="_blank" rel="noopener noreferrer">Playwright docs on
locators</a></p><blockquote><p>Playwright comes with multiple built-in locators. To make tests
resilient, we recommend prioritizing user-facing attributes and
explicit contracts such as page.getByRole().</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoid-force-clicking-at-almost-all-costs">Avoid force clicking at (almost) all costs<a href="#avoid-force-clicking-at-almost-all-costs" class="hash-link" aria-label="Direct link to Avoid force clicking at (almost) all costs" title="Direct link to Avoid force clicking at (almost) all costs">​</a></h3><p>Force clicking bypasses the
<a href="https://playwright.dev/docs/actionability" target="_blank" rel="noopener noreferrer">actionability</a> checks and
increases the chances of flaky tests.</p><p>Instead of using a locator for the <code>input</code>, try clicking on the
associated text or parent element. The experience with Playwright so
far on MilMove is that if you need to force click, it&#x27;s probably a
smell that there&#x27;s something wrong with how the page is working (e.g.
a component with a label of the empty string instead of
<code>&amp;nbsp;</code> ).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-async-assertions">Use async assertions<a href="#use-async-assertions" class="hash-link" aria-label="Direct link to Use async assertions" title="Direct link to Use async assertions">​</a></h3><p>This is referenced in the <a href="https://playwright.dev/docs/writing-tests#assertions" target="_blank" rel="noopener noreferrer">Playwright assertions
docs</a> and will
be expounded upon here.</p><p>Instead of doing</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword" style="color:#c5a5c5">const</span><span class="token plain"> editCount </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#c5a5c5">await</span><span class="token plain"> page</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">getByText</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Edit&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">count</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">editCount</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">toEqual</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Use the async assertions which will wait until the condition is met,
which makes tests much less flaky!</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#c5a5c5">await</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">expect</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">page</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">getByText</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&#x27;Edit&#x27;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token method function property-access" style="color:#79b6f2">toHaveCount</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token number" style="color:#5a9bcf">2</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-traces-in-circleci">Accessing Traces in CircleCI<a href="#accessing-traces-in-circleci" class="hash-link" aria-label="Direct link to Accessing Traces in CircleCI" title="Direct link to Accessing Traces in CircleCI">​</a></h3><p>We run Playwright in <a href="https://circleci.com/docs/parallelism-faster-jobs/" target="_blank" rel="noopener noreferrer">CircleCI using parallelism so the job completes
faster</a>. This
means that if there is a test failure, you need to figure out which
parallel run failed. That run will be red in CircleCI. You can then go
to the <code>Artifacts</code> tab and then find the artifacts for that run.</p><p>Unfortunately, <a href="https://github.com/microsoft/playwright/issues/18108" target="_blank" rel="noopener noreferrer">Playwright traces do not load in
CircleCI</a>. We
have two workarounds.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="complete-archive">Complete Archive<a href="#complete-archive" class="hash-link" aria-label="Direct link to Complete Archive" title="Direct link to Complete Archive">​</a></h4><p>The first is that we zip up the entire playwright run (for that
particular parallel run) in <code>complete-playwright-report.zip</code>. Download
that zip file and unzip it (unless you are using Safari, which will unzip
it for you automatically). Then you can <a href="https://playwright.dev/docs/ci-intro#viewing-the-html-report" target="_blank" rel="noopener noreferrer">view the report</a>.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">yarn</span><span class="token plain"> playwright show-report path/to/report-folder</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="individual-trace">Individual Trace<a href="#individual-trace" class="hash-link" aria-label="Direct link to Individual Trace" title="Direct link to Individual Trace">​</a></h4><p>The complete report is a bit large, so you could also download the
trace for just a failing run and view that.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token function" style="color:#79b6f2">yarn</span><span class="token plain"> playwright show-trace path/to/trace.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Please note that if you use Safari to download the trace file, it will
automatically unzip it for you, which then confuses Playwright.
Download it with another browser like Chrome or zip it back up</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">cd ~/Downloads </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">zip</span><span class="token plain"> -r trace.zip randomhextracegoeshere</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> playwright show-trace ~/Downloads/trace.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="playwright-workers">Playwright Workers<a href="#playwright-workers" class="hash-link" aria-label="Direct link to Playwright Workers" title="Direct link to Playwright Workers">​</a></h3><p>By default <a href="https://playwright.dev/docs/test-parallel#worker-processes" target="_blank" rel="noopener noreferrer">Playwright runs tests in
parallel</a>.
On you local dev machine, it guesses how many workers to use based on
your CPU. It shows that at the beginning of the run, with something
like <code>Running 16 tests using 5 workers</code>.</p><p>If you find you are having test failures locally, try <a href="https://playwright.dev/docs/test-parallel#limit-workers" target="_blank" rel="noopener noreferrer">limiting
workers</a> by
using the <code>--workers</code> flag.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testharness-in-the-support-api">Testharness in the Support API<a href="#testharness-in-the-support-api" class="hash-link" aria-label="Direct link to Testharness in the Support API" title="Direct link to Testharness in the Support API">​</a></h2><p>To make it easy for a test to create the data it needs on demand, a
testharness in the support API has been created on the backend. The
<code>utils/testharness.js</code> has all of the methods.</p><p>If you need to create a new method, make sure you do not hard code
object IDs so that the same test can be run in the same database
multiple times in a row without error.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-new-testharness-endpoint">Adding a new testharness endpoint<a href="#adding-a-new-testharness-endpoint" class="hash-link" aria-label="Direct link to Adding a new testharness endpoint" title="Direct link to Adding a new testharness endpoint">​</a></h3><p>Ideally you would be re-using/creating a function like we have in
<a href="https://github.com/transcom/mymove/blob/main/pkg/testdatagen/scenario/shared.go" target="_blank" rel="noopener noreferrer">testdatagen/scenario/shared.go</a>.
Again, make sure any objects you build do not have hardcoded IDs so
that multiple instances can be created.</p><ol><li>Add a new function in the <a href="https://github.com/transcom/mymove/tree/cf5ad992f2f3a833651d79efc49d92dc6b018d8d/pkg/testdatagen/testharness" target="_blank" rel="noopener noreferrer">testdatagen/testharness
package</a></li><li>Add a new entry to the <a href="https://github.com/transcom/mymove/blob/cf5ad992f2f3a833651d79efc49d92dc6b018d8d/pkg/testdatagen/testharness/dispatch.go#L15" target="_blank" rel="noopener noreferrer">actionDispatcher
map</a>
calling your new function</li><li>Add a new function to <a href="https://github.com/transcom/mymove/blob/cf5ad992f2f3a833651d79efc49d92dc6b018d8d/playwright/tests/utils/testharness.js" target="_blank" rel="noopener noreferrer">testharness.js</a></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-the-testharness-works-in-the-backend">How the testharness works in the backend<a href="#how-the-testharness-works-in-the-backend" class="hash-link" aria-label="Direct link to How the testharness works in the backend" title="Direct link to How the testharness works in the backend">​</a></h3><p>If devlocal auth is enabled (<code>DEVLOCAL_AUTH=true</code>), the <a href="https://github.com/transcom/mymove/blob/8fd35682409c0b4fc8ab14b9a8b6db957e1efb2d/pkg/handlers/routing/routing_init.go#L403-L408" target="_blank" rel="noopener noreferrer">testharness
handler is added under path
<code>/testharness</code></a>.
Note that the testharness is unauthenticated so that e.g. users can be
created. </p><p>The <a href="https://github.com/transcom/mymove/blob/cf5ad992f2f3a833651d79efc49d92dc6b018d8d/pkg/handlers/testharnessapi/api.go#L32" target="_blank" rel="noopener noreferrer">testharness handler calls
testharness.Dispatch</a></p><p>Then the dispatcher uses the <code>actionDispatcher</code> map as described
above.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/frontend/testing/writing-playwright-tests-for-milmove.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/frontend/testing/using-factories-to-generate-data-for-frontend-tests"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Using factories to generate data for front-end tests</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#best-practices--things-to-know" class="table-of-contents__link toc-highlight">Best Practices / Things to Know</a><ul><li><a href="#no-seed-data" class="table-of-contents__link toc-highlight">No seed data</a></li><li><a href="#always-always-ensure-your-test-runs-independently" class="table-of-contents__link toc-highlight">Always (always!) ensure your test runs independently</a></li><li><a href="#test-data-growth-can-eventually-cause-test-failures" class="table-of-contents__link toc-highlight">Test data growth can (eventually) cause test failures</a></li><li><a href="#use-playwright-fixtures" class="table-of-contents__link toc-highlight">Use Playwright fixtures</a></li><li><a href="#wait-for-the-page-to-load" class="table-of-contents__link toc-highlight">Wait for the page to load</a></li><li><a href="#prefer-user-facing-attributes-instead-of-css-selectors" class="table-of-contents__link toc-highlight">Prefer user-facing attributes instead of css selectors</a></li><li><a href="#avoid-force-clicking-at-almost-all-costs" class="table-of-contents__link toc-highlight">Avoid force clicking at (almost) all costs</a></li><li><a href="#use-async-assertions" class="table-of-contents__link toc-highlight">Use async assertions</a></li><li><a href="#accessing-traces-in-circleci" class="table-of-contents__link toc-highlight">Accessing Traces in CircleCI</a></li><li><a href="#playwright-workers" class="table-of-contents__link toc-highlight">Playwright Workers</a></li></ul></li><li><a href="#testharness-in-the-support-api" class="table-of-contents__link toc-highlight">Testharness in the Support API</a><ul><li><a href="#adding-a-new-testharness-endpoint" class="table-of-contents__link toc-highlight">Adding a new testharness endpoint</a></li><li><a href="#how-the-testharness-works-in-the-backend" class="table-of-contents__link toc-highlight">How the testharness works in the backend</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.cb78340e.js"></script>
<script src="/mymove-docs/assets/js/main.70764974.js"></script>
</body>
</html>