"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[8557],{61619:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>k,frontMatter:()=>a,metadata:()=>s,toc:()=>m});var i=n(87462),o=(n(67294),n(3905));n(8209);const a={title:"0034 Working With Mocks: Generation and Assertion\n",description:"Decision outcome: Use Mockery and Testify\n"},r="*Working With Mocks: Generation and Assertion*",s={unversionedId:"adrs/working-with-mocks-generation-and-assertion",id:"adrs/working-with-mocks-generation-and-assertion",title:"0034 Working With Mocks: Generation and Assertion\n",description:"Decision outcome: Use Mockery and Testify\n",source:"@site/docs/adrs/0034-working-with-mocks-generation-and-assertion.md",sourceDirName:"adrs",slug:"/adrs/working-with-mocks-generation-and-assertion",permalink:"/mymove-docs/docs/adrs/working-with-mocks-generation-and-assertion",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0034-working-with-mocks-generation-and-assertion.md",tags:[],version:"current",sidebarPosition:34,frontMatter:{title:"0034 Working With Mocks: Generation and Assertion\n",description:"Decision outcome: Use Mockery and Testify\n"},sidebar:"adrsSidebar",previous:{title:"0033 Service Object Layer",permalink:"/mymove-docs/docs/adrs/service-object-layer"},next:{title:"0035 Use Query Builder for Admin Interface",permalink:"/mymove-docs/docs/adrs/use-query-builder"}},l={},m=[{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Pros and Cons of the Alternatives",id:"pros-and-cons-of-the-alternatives",level:2},{value:"<em>Use Mockery for mock generation and Testify for mock assertion testing</em>",id:"use-mockery-for-mock-generation-and-testify-for-mock-assertion-testing",level:3},{value:"<em>Write mock implementation methods in development without Mockery and only use Testify for mock assertion testing</em>",id:"write-mock-implementation-methods-in-development-without-mockery-and-only-use-testify-for-mock-assertion-testing",level:3},{value:"<em>Test Specific Struct Implementation</em>",id:"test-specific-struct-implementation",level:3}],c={toc:m},d="wrapper";function k(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"working-with-mocks-generation-and-assertion"},(0,o.kt)("em",{parentName:"h1"},"Working With Mocks: Generation and Assertion")),(0,o.kt)("p",null,"Currently, there is no way to approach mocking the behavior of dependencies in the backend API. Mocking allows you to simulate the behavior of an interface, in Golang, in a controlled way. Mock objects are helpful within the realm of unit testing. Oftentimes while testing, the piece of functionality that is being tested calls other dependencies - external services or methods within it. In order to exert full control over the test, mocking these dependencies allows one to define how they should behave. In the MilMove project, there are several instances that we integrate with services that we do not control, for example, the login and GEX services. Having the ability to mock these dependencies and others like it enables better testing. It would be helpful to have some way to work with mocks, such that they can be integrated easily with minimal developer overhead."),(0,o.kt)("h2",{id:"decision-drivers"},"Decision Drivers"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Allows easy control and testing of mock methods by allowing full control over parameter and return values"),(0,o.kt)("li",{parentName:"ul"},"Allows easy generation of mock methods"),(0,o.kt)("li",{parentName:"ul"},"Minimal intrusion on integrating into codebase"),(0,o.kt)("li",{parentName:"ul"},"Ease of implementation"),(0,o.kt)("li",{parentName:"ul"},"High usage and support"),(0,o.kt)("li",{parentName:"ul"},"Quick learning curve")),(0,o.kt)("h2",{id:"considered-options"},"Considered Options"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Use Mockery for mock generation and Testify for mock assertion testing"),(0,o.kt)("li",{parentName:"ul"},"Write mock implementation methods in development without Mockery and only use Testify for mock assertion testing"),(0,o.kt)("li",{parentName:"ul"},"Use a test-specific struct implementation")),(0,o.kt)("h2",{id:"decision-outcome"},"Decision Outcome"),(0,o.kt)("p",null,"Using Mockery for mock generation and Testify for mock assertion testing is the chosen solution. Both ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/vektra/mockery"},"Mockery")," and ",(0,o.kt)("a",{parentName:"p",href:"https://godoc.org/github.com/stretchr/testify"},"Testify/Mock")," are both actively maintained and are relatively easy to install and integrate. Using these two tools also will remove much of the complexity around creating and working with mocks. Using a code generation tool means that we don't have to write those mocked methods, increasing development speed. Integrating Testify's Mock assertion library allows us to do further complex mock assertion testing, such as being able to assert how many times the method was called, with what parameters and parameter types it was called with, along with denoting the return value and type."),(0,o.kt)("p",null,"Resources:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/vektra/mockery"},"Mockery Mock Generation Library")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://godoc.org/github.com/stretchr/testify"},"Testify/Mock Assertion Library")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/transcom/mymove/docs/how-to/generate-mocks-with-mockery.md"},"How To Generate Mocks with Mockery in MilMove Project")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://medium.com/agrea-technogies/mocking-dependencies-in-go-bb9739fef008"},"Mocking Dependencies in Go")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://tutorialedge.net/golang/improving-your-tests-with-testify-go/"},"Improving Your Go Tests and Mocks with Testify"))),(0,o.kt)("h2",{id:"pros-and-cons-of-the-alternatives"},"Pros and Cons of the Alternatives"),(0,o.kt)("h3",{id:"use-mockery-for-mock-generation-and-testify-for-mock-assertion-testing"},(0,o.kt)("em",{parentName:"h3"},"Use Mockery for mock generation and Testify for mock assertion testing")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Implementation mock methods generated for use"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Exerts full control allowing complex testing and assertion of mocked methods"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Mockery and Testify/Mock Libraries actively maintained"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Allows us to move quicker in development with code generation tools"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Relatively simple API for mock generation and assertion"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Testify is already apart of our testing suite and present in our codebase"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Steeper learning curve given that these are new libraries that the team has not yet worked with"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Mocks must be generated"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Limited to what we can do by the mocking API or we have to contribute to it.")),(0,o.kt)("h3",{id:"write-mock-implementation-methods-in-development-without-mockery-and-only-use-testify-for-mock-assertion-testing"},(0,o.kt)("em",{parentName:"h3"},"Write mock implementation methods in development without Mockery and only use Testify for mock assertion testing")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Exerts full control allowing complex testing and assertion of mocked methods"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Testify/Mock Library actively maintained"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Does not scale well as number of structs increases"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Mocks cannot be generated"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Minor learning curve for working with new mock assertion testing library")),(0,o.kt)("h3",{id:"test-specific-struct-implementation"},(0,o.kt)("em",{parentName:"h3"},"Test Specific Struct Implementation")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Lightweight and succinct"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"+")," Low learning curve"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Slower development"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Does not scale well"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Mocks cannot be generated"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," Must write test struct implementation and mock methods for everything that needs to be tested with mocking"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," No complex mocking assertion testing"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"-")," No easy to use library API for checking things like if mocked method was called, how many times it was called, or what parameter and return values and types are")))}k.isMDXComponent=!0}}]);