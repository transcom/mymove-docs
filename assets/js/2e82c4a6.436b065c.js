"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[9210],{23495:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>v,frontMatter:()=>s,metadata:()=>n,toc:()=>l});var o=r(87462),a=(r(67294),r(3905));r(8209);const s={},i="Test Coverage Reports",n={unversionedId:"about/development/test-coverage-reports",id:"about/development/test-coverage-reports",title:"Test Coverage Reports",description:"What are test coverage reports?",source:"@site/docs/about/development/test-coverage-reports.md",sourceDirName:"about/development",slug:"/about/development/test-coverage-reports",permalink:"/mymove-docs/docs/about/development/test-coverage-reports",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/about/development/test-coverage-reports.md",tags:[],version:"current",frontMatter:{},sidebar:"aboutSidebar",previous:{title:"Storybook",permalink:"/mymove-docs/docs/about/development/storybook"},next:{title:"Test Data Generator",permalink:"/mymove-docs/docs/about/development/test-data-generator"}},c={},l=[{value:"What are test coverage reports?",id:"what-are-test-coverage-reports",level:2},{value:"Running test coverage reports",id:"running-test-coverage-reports",level:2},{value:"CircleCI",id:"circleci",level:3},{value:"Client locally",id:"client-locally",level:3},{value:"Server locally",id:"server-locally",level:3},{value:"Accessing and reviewing coverage reports",id:"accessing-and-reviewing-coverage-reports",level:2},{value:"Client reports",id:"client-reports",level:3},{value:"Overview:",id:"overview",level:4},{value:"Details:",id:"details",level:4},{value:"Server reports",id:"server-reports",level:3},{value:"Report",id:"report",level:4},{value:"What to do if test coverage checks fail",id:"what-to-do-if-test-coverage-checks-fail",level:2},{value:"Merge or rebase from main",id:"merge-or-rebase-from-main",level:3},{value:"Write tests",id:"write-tests",level:3},{value:"&quot;The Happo Approach&quot;",id:"the-happo-approach",level:3}],d={toc:l},p="wrapper";function v(e){let{components:t,...s}=e;return(0,a.kt)(p,(0,o.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"test-coverage-reports"},"Test Coverage Reports"),(0,a.kt)("h2",{id:"what-are-test-coverage-reports"},"What are test coverage reports?"),(0,a.kt)("p",null,"Test coverage reports indicate the percentage of segments of code in the codebase that have tests written about them."),(0,a.kt)("p",null,"On MilMove, test coverage is calculated for both the client and the server."),(0,a.kt)("p",null,"On the client, testable code in the ",(0,a.kt)("inlineCode",{parentName:"p"},"src/")," directory is checked against all tests present there. End-to-end tests using Playwright are not considered in calculating client test coverage."),(0,a.kt)("p",null,"On the server, test coverage is calculated using the tests in the main Go package, in ",(0,a.kt)("inlineCode",{parentName:"p"},"pkg/"),"."),(0,a.kt)("h2",{id:"running-test-coverage-reports"},"Running test coverage reports"),(0,a.kt)("h3",{id:"circleci"},"CircleCI"),(0,a.kt)("p",null,"Coverage tests are run automatically on CircleCI as part of the CI pipeline. This occurs whenever pull requests are created and on any subsequent commit to the given branch."),(0,a.kt)("p",null,"Since the test coverage commands have dependencies on ",(0,a.kt)("inlineCode",{parentName:"p"},"client_test")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"server_test")," respectively, the results of the coverage tests do not appear as GitHub checks until those checks have completed. Once they do, CircleCI will report the result back to GitHub checks."),(0,a.kt)("h3",{id:"client-locally"},"Client locally"),(0,a.kt)("p",null,"To run client test coverage locally,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"make client_test_coverage\n")),(0,a.kt)("h3",{id:"server-locally"},"Server locally"),(0,a.kt)("p",null,"To run server test coverage locally,"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"make server_test_coverage\n")),(0,a.kt)("h2",{id:"accessing-and-reviewing-coverage-reports"},"Accessing and reviewing coverage reports"),(0,a.kt)("p",null,"Both client and server test coverage checks generate coverage reports. If checks fail due to coverage dropping from the baseline, accessing the respective reports can provide context and help improve coverage where needed."),(0,a.kt)("p",null,"A comment will be added to the GitHub PR with a link to the coverage report."),(0,a.kt)("p",null,"Locally, reports are available in the ",(0,a.kt)("inlineCode",{parentName:"p"},"mymove")," directory at their respective paths."),(0,a.kt)("h3",{id:"client-reports"},"Client reports"),(0,a.kt)("p",null,"Client coverage reports provide an overview of coverage per directory, and provide a means to drill down to details of individual files and view coverage per expression."),(0,a.kt)("p",null,"An HTML version of the client coverage report is stored at ",(0,a.kt)("inlineCode",{parentName:"p"},"coverage/lcov-report/index.html"),"."),(0,a.kt)("h4",{id:"overview"},"Overview:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Client coverage overview",src:r(23072).Z,width:"1097",height:"356"})),(0,a.kt)("h4",{id:"details"},"Details:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Client coverage details",src:r(74718).Z,width:"648",height:"534"})),(0,a.kt)("h3",{id:"server-reports"},"Server reports"),(0,a.kt)("p",null,"Server coverage reports provide details of coverage on a per file basis, and analyze coverage per block."),(0,a.kt)("p",null,"An HTML version of the server coverage report is stored at ",(0,a.kt)("inlineCode",{parentName:"p"},"tmp/test-results/gotests/app/go-coverage.html"),"."),(0,a.kt)("h4",{id:"report"},"Report"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Server coverage report",src:r(50422).Z,width:"864",height:"619"})),(0,a.kt)("h2",{id:"what-to-do-if-test-coverage-checks-fail"},"What to do if test coverage checks fail"),(0,a.kt)("p",null,"There are several reasons that code coverage might decrease, as documented in ",(0,a.kt)("a",{parentName:"p",href:"https://transcom.github.io/mymove-docs/docs/adrs/develop-strategy-for-ensuring-code-test-coverage/#scenarios-that-result-in-a-test-coverage-decrease"},"ADR 0079"),". What to do about them depends on the scenario(s) that are causing loss of coverage. Below are approaches to coverage check failures."),(0,a.kt)("h3",{id:"merge-or-rebase-from-main"},"Merge or rebase from main"),(0,a.kt)("p",null,"A common cause of failure is simply that the branch is out of date. Rebase or merge from main and try again."),(0,a.kt)("h3",{id:"write-tests"},"Write tests"),(0,a.kt)("p",null,"Often, changes to the codebase should be tested. If coverage checks are failing and there is no good reason for coverage to decrease, write tests for your code."),(0,a.kt)("h3",{id:"the-happo-approach"},'"The Happo Approach"'),(0,a.kt)("p",null,'If your changes include scenario(s) where code coverage does not need to increase -- deleting better-covered code than the baseline, or adding code that may not need to be tested -- coverage checks can be ignored, at the PR reviewer\'s discretion. This is referred to as "the Happo approach," since the check is optional and a reviewer can decide to approve the PR even with the check failing, like the Happo checks.'))}v.isMDXComponent=!0},74718:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r.p+"assets/images/client_coverage_details-2ea907a9b41017f001a01f2976266623.png"},23072:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r.p+"assets/images/client_coverage_overview-86b4377ce8a26756624923ff257eb9ec.png"},50422:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r.p+"assets/images/server_coverage_report-30aab2c20bbe19695ea8ac0d0d8777d3.png"}}]);