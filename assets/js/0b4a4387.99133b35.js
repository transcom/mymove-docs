"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[4412],{65292:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=t(87462),i=(t(67294),t(3905));t(8209);const r={title:"0008 Use go-swagger To Route, Parse, And Validate API Endpoints"},o="Use go-swagger To Route, Parse, And Validate API Endpoints",l={unversionedId:"adrs/go-swagger",id:"adrs/go-swagger",title:"0008 Use go-swagger To Route, Parse, And Validate API Endpoints",description:"Considered Alternatives",source:"@site/docs/adrs/0008-go-swagger.md",sourceDirName:"adrs",slug:"/adrs/go-swagger",permalink:"/mymove-docs/docs/adrs/go-swagger",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0008-go-swagger.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"0008 Use go-swagger To Route, Parse, And Validate API Endpoints"},sidebar:"adrsSidebar",previous:{title:"0007 Use swagger-client to make calls to API from client",permalink:"/mymove-docs/docs/adrs/swagger-client"},next:{title:"0009 Generate forms from swagger definitions of payload",permalink:"/mymove-docs/docs/adrs/form-creation-from-swagger"}},s={},d=[{value:"Considered Alternatives",id:"considered-alternatives",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Notes",id:"notes",level:3},{value:"Pros and Cons of the Alternatives",id:"pros-and-cons-of-the-alternatives",level:2},{value:"go-swagger",id:"go-swagger",level:3},{value:"Buffalo",id:"buffalo",level:3},{value:"Roll Our Own",id:"roll-our-own",level:3},{value:"Official Swagger Go Generation",id:"official-swagger-go-generation",level:3}],g={toc:d},u="wrapper";function p(e){let{components:a,...t}=e;return(0,i.kt)(u,(0,n.Z)({},g,t,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"use-go-swagger-to-route-parse-and-validate-api-endpoints"},"Use go-swagger To Route, Parse, And Validate API Endpoints"),(0,i.kt)("h2",{id:"considered-alternatives"},"Considered Alternatives"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Buffalo"),(0,i.kt)("li",{parentName:"ul"},"Roll Our Own"),(0,i.kt)("li",{parentName:"ul"},"Swagger Go generation")),(0,i.kt)("h2",{id:"decision-outcome"},"Decision Outcome"),(0,i.kt)("p",null,"We use go-swagger to generate code for API request handling. The API will be defined in ",(0,i.kt)("inlineCode",{parentName:"p"},"swagger.yaml")," and go-swagger will provide routing, JSON parsing, and whatever validation is expressed in ",(0,i.kt)("inlineCode",{parentName:"p"},"swagger.yaml"),". While go-swagger can generate our ",(0,i.kt)("inlineCode",{parentName:"p"},"main.go")," file, we disable that and take care of hooking up the generated API server to the rest of our routing ourselves. This means that we run our own server, we are not using the generated server file. Swagger code generation is taken care of by ",(0,i.kt)("inlineCode",{parentName:"p"},"./bin/gen_server.sh")," and is invoked by Make anytime the ",(0,i.kt)("inlineCode",{parentName:"p"},"swagger.yaml")," file changes."),(0,i.kt)("h3",{id:"notes"},"Notes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Optional parameters should be marked with ",(0,i.kt)("inlineCode",{parentName:"li"},"x-nullable: true")," so that go-swagger will represent them with pointers in structs. That way the handler will know if they have been provided or not"),(0,i.kt)("li",{parentName:"ul"},"Generated files all live under the ",(0,i.kt)("inlineCode",{parentName:"li"},"./pkg/gen")," path and should never be checked into git"),(0,i.kt)("li",{parentName:"ul"},'All definitions that represent bodies of requests or responses should be named "Payloads" and should be described in the ',(0,i.kt)("inlineCode",{parentName:"li"},"definitions")," section of ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml"),'. This causes them to be named correctly in the generated code. "Payloads" is also what go-swagger calls the body "parameter" in the parameters struct passed that is generated for an API'),(0,i.kt)("li",{parentName:"ul"},"Use correct HTTP status codes for responding to success and errors. This is what expected by downstream tooling and is required by ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml"),", which is unable to represent multiple different 2XX responses."),(0,i.kt)("li",{parentName:"ul"},"The generated payload objects should be used ",(0,i.kt)("em",{parentName:"li"},"exclusively")," in the handler package. Everywhere else in our app, we should be using our model structs to represent data. The generated swagger code only exists to give us typed and validated structs for representing requests and responses. We do ",(0,i.kt)("em",{parentName:"li"},"not")," want to rely on these structs for actual business logic.")),(0,i.kt)("h2",{id:"pros-and-cons-of-the-alternatives"},"Pros and Cons of the Alternatives"),(0,i.kt)("h3",{id:"go-swagger"},"go-swagger"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Translates ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml")," into go structs, giving us a single source of truth for our API definition"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Runs validations before calling handlers, giving the handler some guarantees about what data it is given"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Handles parsing of requests"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," It is maintained by responsive developers"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," Is a complex dependency we will be very dependent on"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," Some of its handling of ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml")," appears to be fragile, I managed to make it error with some valid ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml")," files, but I was able to get it to do what I wanted by re-organizing")),(0,i.kt)("h3",{id:"buffalo"},"Buffalo"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," It is fairly mature"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," It integrates request handling with database model saving"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," It is ignorant of swagger"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," It integrates request handling with database model saving")),(0,i.kt)("h3",{id:"roll-our-own"},"Roll Our Own"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," It would be more flexible, we could define requests and responses however we like"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," We would not have to learn the ins and outs of go-swagger which is a fairly complex bit of code"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," We would have to do our own routing, parsing, and validating"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," Our API could easily diverge from what we documented in ",(0,i.kt)("inlineCode",{parentName:"li"},"swagger.yaml"))),(0,i.kt)("h3",{id:"official-swagger-go-generation"},"Official Swagger Go Generation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," It appeared to generate garbage code"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," It didn't appear to do any validation"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," According to go-swagger, it didn't really work"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," I could never really get it to work")))}p.isMDXComponent=!0}}]);