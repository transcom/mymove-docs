"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[4374],{98332:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var t=o(58168),i=(o(96540),o(15680));o(41873);const r={},a="Known Limitations",s={unversionedId:"tools/cicd/circleci/known-local-limitations",id:"tools/cicd/circleci/known-local-limitations",title:"Known Limitations",description:"CircleCI has known local limitations that can be found detailed within their docs. This article is hoped to intercept",source:"@site/docs/tools/cicd/circleci/known-local-limitations.md",sourceDirName:"tools/cicd/circleci",slug:"/tools/cicd/circleci/known-local-limitations",permalink:"/mymove-docs/docs/tools/cicd/circleci/known-local-limitations",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/tools/cicd/circleci/known-local-limitations.md",tags:[],version:"current",frontMatter:{},sidebar:"toolsSidebar",previous:{title:"Deploy App Client TLS",permalink:"/mymove-docs/docs/tools/cicd/circleci/deploy-app-client-tls"},next:{title:"GitHub Actions",permalink:"/mymove-docs/docs/tools/cicd/github_actions"}},c={},l=[{value:"Local limitations",id:"local-limitations",level:2},{value:"Using an executor with more than one image",id:"using-an-executor-with-more-than-one-image",level:3},{value:"Running workflows locally",id:"running-workflows-locally",level:3},{value:"Additional details",id:"additional-details",level:2}],d={toc:l},m="wrapper";function u(e){let{components:n,...o}=e;return(0,i.yg)(m,(0,t.A)({},d,o,{components:n,mdxType:"MDXLayout"}),(0,i.yg)("h1",{id:"known-limitations"},"Known Limitations"),(0,i.yg)("p",null,"CircleCI has ",(0,i.yg)("a",{parentName:"p",href:"https://circleci.com/docs/how-to-use-the-circleci-local-cli/#limitations-of-running-jobs-locally"},"known local limitations that can be found detailed within their docs"),". This article is hoped to intercept\ndevelopers searching for their issues within the docs and present possible workarounds and links to third-party documentation that can hopefully assist more."),(0,i.yg)("h2",{id:"local-limitations"},"Local limitations"),(0,i.yg)("h3",{id:"using-an-executor-with-more-than-one-image"},"Using an executor with more than one image"),(0,i.yg)("p",null,"CircleCI CLI ",(0,i.yg)("a",{parentName:"p",href:"https://circleci.com/docs/how-to-use-the-circleci-local-cli/#executors"},"cannot handle local executors with more than one image"),". Doing so will present you with the following error:"),(0,i.yg)("p",null,(0,i.yg)("inlineCode",{parentName:"p"},"Error: Unhandled prepare executor error: Error response from daemon: invalid UTS mode: containera4e4804657980605d031801469af669e540d8629ec7a0f4d108ab5434145ff58")),(0,i.yg)("p",null,"There is a known workaround to utilize a docker-in-docker setup with the deprecated Docker version 20, keeping executors with only a single image and instead nesting additional containers inside of them when needed. A docker network can be utilized to ensure these containers can communicate properly."),(0,i.yg)("p",null,"For example, if you wanted an executor with 2 images such as ",(0,i.yg)("inlineCode",{parentName:"p"},"cimg/ruby")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"cimg/postgres"),', the workaround is to have one image be the "host" of a docker-in-docker network, and instead of the host container running both images in parallel, it would instead ',(0,i.yg)("em",{parentName:"p"},"create")," the second image as a docker container inside of itself. The following is a code sample"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre"},"version: 2.1\n\nreferences:\n  ruby-docker: &ruby-docker cimg/ruby:3.2\n  # cimg/postgres would've gone here and placed within the executor\n  # but instead we'll create it within a job step\n\nexecutors:\n  ruby_executor:\n    docker:\n      - image: *ruby-docker\njobs:\n  test:\n    executor: ruby_executor\n  steps:\n      - setup_remote_docker:\n          version: 20.10.24\n      - run:\n          name: Start new docker network\n          command: sudo docker network create my_docker_network\n      - run:\n          name: Join the host container on the network\n          command: sudo docker network connect my_docker_network $(hostname)\n      - run:\n          name: Start PostgreSQL remote container\n          command: sudo docker run --network my_docker_network --network-alias postgres_db_container --rm -d --name setup_tests_postgres_container -e POSTGRES_PASSWORD=mysecretpassword -e POSTGRES_DB=test_db -v /dev/shm/pgdata:/var/lib/postgresql/data cimg/postgres:12.11 -c 'listen_addresses=*'\n      - run:\n          name: Get PostgreSQL container IP address\n          command: |\n            export DB_HOST=$(sudo docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' setup_tests_postgres_container)\n      - run:\n          name: Wait for PostgreSQL to be ready on remote test container\n          command: |\n            until sudo docker exec setup_tests_postgres_container pg_isready -h ${DB_HOST} -p 5432 -U postgres; do\n              echo \"Waiting for PostgreSQL on ${DB_HOST}:5432...\"\n              sleep 2\n              # Heads up there's no timeout here in this sample\n            done\n      - run:\n          name: Stop PostgreSQL remote container\n          command: sudo docker stop setup_tests_postgres_container\n          when: always\n      - run:\n          name: Disconnect host from docker network\n          command: sudo docker network disconnect my_docker_network $(hostname)\n          when: always\n      - run:\n          name: Stop docker network\n          command: sudo docker network rm my_docker_network\n          when: always\n")),(0,i.yg)("p",null,"If Docker volume mounting and local CircleCI workspace issues are encountered, you can bypass the need for storing files for shared access by sending the files from container to container.\nThis can be achieved by feeding files between the docker containers through input streams with ",(0,i.yg)("inlineCode",{parentName:"p"},"docker run -i")," allowing the use of standard input for file transfers."),(0,i.yg)("h3",{id:"running-workflows-locally"},"Running workflows locally"),(0,i.yg)("p",null,"CircleCI CLI ",(0,i.yg)("a",{parentName:"p",href:"https://circleci.com/docs/how-to-use-the-circleci-local-cli/#limitations-of-running-jobs-locally"},"is limited by being unable to run workflows locally"),". It can only run individual jobs."),(0,i.yg)("h2",{id:"additional-details"},"Additional details"),(0,i.yg)("p",null,"Please see ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/transcom/trdm-lambda/pull/18"},"this pull request")," where the issue was first encountered by our organization."))}u.isMDXComponent=!0}}]);