"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[5355],{34110:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var a=o(87462),t=(o(67294),o(3905));o(8209);const l={title:"How to manage Golang with asdf",sidebar_position:5},i="How to manage Golang with asdf",s={unversionedId:"backend/guides/how-to/manage-golang-with-asdf",id:"backend/guides/how-to/manage-golang-with-asdf",title:"How to manage Golang with asdf",description:"This document describes how we are using asdf and some troubleshooting steps",source:"@site/docs/backend/guides/how-to/manage-golang-with-asdf.md",sourceDirName:"backend/guides/how-to",slug:"/backend/guides/how-to/manage-golang-with-asdf",permalink:"/mymove-docs/docs/backend/guides/how-to/manage-golang-with-asdf",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/how-to/manage-golang-with-asdf.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"How to manage Golang with asdf",sidebar_position:5},sidebar:"backendSidebar",previous:{title:"How To Manage Docker Locally",permalink:"/mymove-docs/docs/backend/guides/how-to/manage-docker-locally"},next:{title:"How to Set Up a Feature Flag",permalink:"/mymove-docs/docs/backend/guides/how-to/set-up-a-feature-flag"}},r={},d=[{value:"What is ASDF?",id:"what-is-asdf",level:2},{value:"Why ASDF?",id:"why-asdf",level:2},{value:"Why <code>asdf global golang &lt;version&gt;</code>?",id:"why-asdf-global-golang-version",level:2},{value:"How to get up and running",id:"how-to-get-up-and-running",level:2},{value:"Install asdf",id:"install-asdf",level:3},{value:"Install golang plugin",id:"install-golang-plugin",level:3},{value:"Install the version of golang MilMove is using",id:"install-the-version-of-golang-milmove-is-using",level:3},{value:"Configure global use of golang version",id:"configure-global-use-of-golang-version",level:3},{value:"Reload your shell",id:"reload-your-shell",level:3},{value:"Verify install",id:"verify-install",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"GOROOT is showing a different version or not working with GoLand",id:"goroot-is-showing-a-different-version-or-not-working-with-goland",level:3},{value:"Missing <code>asdf.sh</code> executable",id:"missing-asdfsh-executable",level:3},{value:"Compile errors because wrong version of go after upgrading",id:"compile-errors-because-wrong-version-of-go-after-upgrading",level:3}],g={toc:d},h="wrapper";function u(e){let{components:n,...o}=e;return(0,t.kt)(h,(0,a.Z)({},g,o,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"how-to-manage-golang-with-asdf"},"How to manage Golang with ",(0,t.kt)("inlineCode",{parentName:"h1"},"asdf")),(0,t.kt)("p",null,"This document describes how we are using asdf and some troubleshooting steps"),(0,t.kt)("h2",{id:"what-is-asdf"},"What is ASDF?"),(0,t.kt)("p",null,"Besides being the home row of the left hand in the qwerty layout it is also a tool to manage runtime versions of multiple different tools. The home page for asdf is at ",(0,t.kt)("a",{parentName:"p",href:"https://asdf-vm.com/"},"https://asdf-vm.com/"),". While they support more than one type of tool we are only using it for golang."),(0,t.kt)("h2",{id:"why-asdf"},"Why ASDF?"),(0,t.kt)("p",null,"To find out more on why asdf was chosen please read ",(0,t.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/use-asdf-to-manage-golang-versions-in-development"},"ADR 0056 - Use asdf to manage golang versions in development")),(0,t.kt)("h2",{id:"why-asdf-global-golang-version"},"Why ",(0,t.kt)("inlineCode",{parentName:"h2"},"asdf global golang <version>"),"?"),(0,t.kt)("p",null,"We ran into an issue with asdf and pre-commit hooks. During the installation process of the pre-commit hooks ",(0,t.kt)("inlineCode",{parentName:"p"},"golanglint-ci")," requires use of go. Basically the install of ",(0,t.kt)("inlineCode",{parentName:"p"},"golanglint-ci")," happens outside of the milmove directory, which doesn't have ",(0,t.kt)("inlineCode",{parentName:"p"},".tool-versions"),". So it depends on the global version of golang installed. Since this could be via brew, which has a newer version of golang than currently used on MilMove, or any number of other ways we are recommending using ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf global")," config to configure the default for outside the project as well. This is not different than before the ADR 56 because we had been using ",(0,t.kt)("inlineCode",{parentName:"p"},"brew")," to install and pin golang globally on our laptops."),(0,t.kt)("h2",{id:"how-to-get-up-and-running"},"How to get up and running"),(0,t.kt)("h3",{id:"install-asdf"},"Install asdf"),(0,t.kt)("p",null,"Run ",(0,t.kt)("inlineCode",{parentName:"p"},"brew install asdf")," to install asdf, then add it to your shell's rc file. See ",(0,t.kt)("a",{parentName:"p",href:"https://asdf-vm.com/#/core-manage-asdf?id=add-to-your-shell"},"Adding to your Shell")," from the asdf documentation."),(0,t.kt)("h3",{id:"install-golang-plugin"},"Install golang plugin"),(0,t.kt)("p",null,"Run ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf plugin add golang")," to add the golang plugin. There are other plugins for asdf if you'd like to use it for other projects as well. Also has support for ",(0,t.kt)("inlineCode",{parentName:"p"},"legacy_version_file")," to look for things like ",(0,t.kt)("inlineCode",{parentName:"p"},".node-version")," instead of just ",(0,t.kt)("inlineCode",{parentName:"p"},".tool-versions"),"."),(0,t.kt)("h3",{id:"install-the-version-of-golang-milmove-is-using"},"Install the version of golang MilMove is using"),(0,t.kt)("p",null,"Run ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf install")," to install the binary for the currently required version of golang."),(0,t.kt)("h3",{id:"configure-global-use-of-golang-version"},"Configure global use of golang version"),(0,t.kt)("p",null,"Run ",(0,t.kt)("inlineCode",{parentName:"p"},"cat .tool-versions")," to output what version of go we should be using"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-sh"},"\u276f cat .tool-versions\ngolang 1.15.10\n")),(0,t.kt)("p",null,"Then run ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf global golang 1.15.10")),(0,t.kt)("h3",{id:"reload-your-shell"},"Reload your shell"),(0,t.kt)("p",null,"Reload your shell, open a new shell or source your rc file."),(0,t.kt)("h3",{id:"verify-install"},"Verify install"),(0,t.kt)("p",null,"Run ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf current")," and ",(0,t.kt)("inlineCode",{parentName:"p"},"which go")," to verify they point to the right versions. This is also checked by the ",(0,t.kt)("inlineCode",{parentName:"p"},"script/prereqs")," script"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-sh"},"\u276f asdf current\ngolang          1.15.10          /Users/john/projects/dod/mymove/.tool-versions\n\n\u276f which go\n/Users/john/.asdf/shims/go\n\n\u276f rm .prereqs.stamp\n\u276f make prereqs\nscripts/prereqs\n/usr/local/bin/aws installed.\nbash installed.\n/usr/local/bin/chamber installed.\ndocker installed.\njq installed.\nasdf installed.\n.asdf/shims was found in path\ngo installed.\nyarn installed.\npre-commit installed.\nshellcheck installed.\npsql installed.\nnodenv installed.\n.nodenv/shims was found in path\nnode installed.\npkcs11-tool installed.\npkcs15-tool installed.\ncircleci installed.\ndirenv installed.\nentr installed.\naws-vault installed.\nwatchman installed.\nOK: all prereqs found\n")),(0,t.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,t.kt)("h3",{id:"goroot-is-showing-a-different-version-or-not-working-with-goland"},"GOROOT is showing a different version or not working with GoLand"),(0,t.kt)("p",null,"Another issue GoLand users and others can run into with asdf is with GOROOT. Goland expects GOROOT to be set but it may be unclear what it should be set to. You can easily find the value by running ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf where golang"),". Not upgrading versions will require this to change unless you can set GOROOT to the output directory of ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf where golang"),". For example, you can set this in your ",(0,t.kt)("inlineCode",{parentName:"p"},"~/.zshrc")," (or similar) shell:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-sh"},'export GOROOT="$(asdf where golang)/go/"\n')),(0,t.kt)("h3",{id:"missing-asdfsh-executable"},"Missing ",(0,t.kt)("inlineCode",{parentName:"h3"},"asdf.sh")," executable"),(0,t.kt)("p",null,"Some users have run into an issue with not being able run ",(0,t.kt)("inlineCode",{parentName:"p"},"asdf"),". This is fixed by adding the following line to the ",(0,t.kt)("inlineCode",{parentName:"p"},".bash_profile")," file:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-sh"},"source $(brew --prefix asdf)/libexec/asdf.sh\n")),(0,t.kt)("p",null,"then run ",(0,t.kt)("inlineCode",{parentName:"p"},"source ~/.bash_profile")," in the terminal to reload."),(0,t.kt)("h3",{id:"compile-errors-because-wrong-version-of-go-after-upgrading"},"Compile errors because wrong version of go after upgrading"),(0,t.kt)("p",null,"If you are getting can't compile because library was compiled for ",(0,t.kt)("inlineCode",{parentName:"p"},"old version of go")," vs ",(0,t.kt)("inlineCode",{parentName:"p"},"current version of go"),". You probably should exit your shell and open a new one. Also ensure the below are in your shell's rc file."),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-sh"},'# Ensure that the `asdf.sh` file is run first before envoking any `go *`\n# commands.\nsource $(brew --prefix asdf)/libexec/asdf.sh\n\nexport GOPATH=$(go env GOPATH)\nexport PATH="$PATH:$(go env GOPATH)/bin"\n')))}u.isMDXComponent=!0}}]);