"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[6789],{92313:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>m,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var o=n(87462),i=(n(67294),n(3905));n(8209);const a={},s="How to Test a SSH and SFTP Connection Locally",l={unversionedId:"integrations/gex/testing-ssh-and-sftp-connections-locally",id:"integrations/gex/testing-ssh-and-sftp-connections-locally",title:"How to Test a SSH and SFTP Connection Locally",description:"SSH and SFTP is one of the ways that GEX connects to MilMove. The GEX servers can be connected to manually via SSH and SFTP, but that requires setting up a Bastion inside of the staging and production environment.",source:"@site/docs/integrations/gex/testing-ssh-and-sftp-connections-locally.md",sourceDirName:"integrations/gex",slug:"/integrations/gex/testing-ssh-and-sftp-connections-locally",permalink:"/mymove-docs/docs/integrations/gex/testing-ssh-and-sftp-connections-locally",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/integrations/gex/testing-ssh-and-sftp-connections-locally.md",tags:[],version:"current",frontMatter:{},sidebar:"integrationsSidebar",previous:{title:"GEX",permalink:"/mymove-docs/docs/backend/guides/gex"},next:{title:"Troubleshooting the GEX Connection",permalink:"/mymove-docs/docs/integrations/gex/troubleshooting-the-gex-connection"}},r={},c=[{value:"Setting Up a SSH Server",id:"setting-up-a-ssh-server",level:2},{value:"Testing the Connection",id:"testing-the-connection",level:2},{value:"Using the Build Tools",id:"using-the-build-tools",level:3},{value:"Testing the SSH Connection Manually",id:"testing-the-ssh-connection-manually",level:3},{value:"Testing the SFTP Connection Manually",id:"testing-the-sftp-connection-manually",level:3}],p={toc:c},d="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-test-a-ssh-and-sftp-connection-locally"},"How to Test a SSH and SFTP Connection Locally"),(0,i.kt)("p",null,"SSH and SFTP is one of the ways that GEX connects to MilMove. The GEX servers can be connected to manually via SSH and SFTP, but that requires setting up a Bastion inside of the staging and production environment."),(0,i.kt)("p",null,"When doing development on an SSH or SFTP connection, it is much more convenient to be able to test locally. If you are looking to update the SSH or SFTP connection to GEX, testing locally provides an addtional assurance that the code for the connection is written correctly."),(0,i.kt)("p",null,"The following sets of steps are best done with a terminal window open in the MilMove project repository."),(0,i.kt)("h2",{id:"setting-up-a-ssh-server"},"Setting Up a SSH Server"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Generate a key pair with ",(0,i.kt)("inlineCode",{parentName:"li"},"ssh-keygen -f ./tmp/test_key_pair -t ecdsa -b 521"),(0,i.kt)("admonition",{parentName:"li",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You may want to do this inside of the MilMove tmp folder since that gets gitignored. This helps avoid accidental commits of private keys."))),(0,i.kt)("li",{parentName:"ol"},"Inside of the project's ",(0,i.kt)("inlineCode",{parentName:"li"},".envrc.local"),"; set the following environment variables.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"export GEX_SFTP_USER_ID=testu\nexport GEX_SFTP_PASSWORD=testp\nexport GEX_SFTP_IP_ADDRESS=localhost\nexport GEX_SFTP_PORT=2222\nexport SEND_TO_SYNCADA=true\nexport GEX_PRIVATE_KEY=$(<./tmp/test_key_pair)\nexport TEST_GEX_PUBLIC_KEY=$(<./tmp/test_key_pair.pub)\n# export GEX_SFTP_HOST_KEY=$(docker exec sshd cat /etc/ssh/ssh_host_ecdsa_key.pub)\n")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Run ",(0,i.kt)("inlineCode",{parentName:"p"},"direnv allow"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Run ",(0,i.kt)("inlineCode",{parentName:"p"},"make docker_local_ssh_server_with_key")),(0,i.kt)("admonition",{parentName:"li",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You can also use ",(0,i.kt)("inlineCode",{parentName:"p"},"make docker_local_ssh_server_with_password"),", depending on if you want to test the SSH connection with a key or a password"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Uncomment the ",(0,i.kt)("inlineCode",{parentName:"p"},"export GEX_SFTP_HOST_KEY...")," line inside of the ",(0,i.kt)("inlineCode",{parentName:"p"},".envrc.local")))),(0,i.kt)("h2",{id:"testing-the-connection"},"Testing the Connection"),(0,i.kt)("h3",{id:"using-the-build-tools"},"Using the Build Tools"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"direnv allow")),(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"make bin/milmove-tasks")),(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"milmove-tasks connect-to-gex-via-sftp"))),(0,i.kt)("h3",{id:"testing-the-ssh-connection-manually"},"Testing the SSH Connection Manually"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"To exit from either the SFTP or SSH session, you can type and enter ",(0,i.kt)("inlineCode",{parentName:"p"},"exit")," and you will be taken back to your original terminal session.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"direnv allow")),(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"ssh -v -i ./tmp/test_key_pair -p 2222 testu@localhost"))),(0,i.kt)("h3",{id:"testing-the-sftp-connection-manually"},"Testing the SFTP Connection Manually"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"To exit from either the SFTP or SSH session, you can type and enter ",(0,i.kt)("inlineCode",{parentName:"p"},"exit")," and you will be taken back to your original terminal session.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"direnv allow")),(0,i.kt)("li",{parentName:"ol"},"Run ",(0,i.kt)("inlineCode",{parentName:"li"},"sftp -v -P 2222 testu@localhost"))))}m.isMDXComponent=!0}}]);