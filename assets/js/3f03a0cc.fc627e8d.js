"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[5359],{29312:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var i=a(87462),n=(a(67294),a(3905));a(8209);const o={title:"0069 Use orchestrator service objects"},s="Use orchestrator service objects",r={unversionedId:"adrs/use-orchestrator-service-objects",id:"adrs/use-orchestrator-service-objects",title:"0069 Use orchestrator service objects",description:"NOTE: ADR 0033 Service Object Layer is the one that started us on using service",source:"@site/docs/adrs/0069-use-orchestrator-service-objects.md",sourceDirName:"adrs",slug:"/adrs/use-orchestrator-service-objects",permalink:"/mymove-docs/docs/adrs/use-orchestrator-service-objects",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0069-use-orchestrator-service-objects.md",tags:[],version:"current",sidebarPosition:69,frontMatter:{title:"0069 Use orchestrator service objects"},sidebar:"adrsSidebar",previous:{title:"0068 Use fake data factories with fake data generators to create test data",permalink:"/mymove-docs/docs/adrs/use-fake-data-factories-with-fake-data-generators-to-create-test-data"},next:{title:"0070 Use a consistent file structure for cypress tests",permalink:"/mymove-docs/docs/adrs/cypress-tests-file-layout"}},l={},c=[{value:"Problem statement",id:"problem-statement",level:2},{value:"Service Object Background",id:"service-object-background",level:3},{value:"Summary",id:"summary",level:3},{value:"Story Time",id:"story-time",level:3},{value:"Measuring success",id:"measuring-success",level:2},{value:"Observability",id:"observability",level:3},{value:"Implementation Plan",id:"implementation-plan",level:3},{value:"Ownership",id:"ownership",level:3},{value:"Considered Alternatives",id:"considered-alternatives",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Pros and Cons of the Alternatives",id:"pros-and-cons-of-the-alternatives",level:2},{value:"Option 1: Use separate service objects and the handler decides which to call",id:"option-1-use-separate-service-objects-and-the-handler-decides-which-to-call",level:3},{value:"Option 2: Use separate service objects and the handler orchestrates the calls",id:"option-2-use-separate-service-objects-and-the-handler-orchestrates-the-calls",level:3},{value:"Option 3: Update existing service objects to contain the new logic",id:"option-3-update-existing-service-objects-to-contain-the-new-logic",level:3},{value:"Option 4: Have separate service objects, but the handler just calls the existing service objects. Then we update the existing service objects to call the new service objects as needed",id:"option-4-have-separate-service-objects-but-the-handler-just-calls-the-existing-service-objects-then-we-update-the-existing-service-objects-to-call-the-new-service-objects-as-needed",level:3},{value:"Option 5: Have composable service objects and create orchestrator service objects that then call the appropriate service objects",id:"option-5-have-composable-service-objects-and-create-orchestrator-service-objects-that-then-call-the-appropriate-service-objects",level:3},{value:"Option 6: Leave things as they are",id:"option-6-leave-things-as-they-are",level:3},{value:"Resources",id:"resources",level:2}],h={toc:c},d="wrapper";function p(e){let{components:t,...a}=e;return(0,n.kt)(d,(0,i.Z)({},h,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"use-orchestrator-service-objects"},"Use orchestrator service objects"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"NOTE:")," ",(0,n.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/service-object-layer"},"ADR 0033 Service Object Layer")," is the one that started us on using service\nobjects. This ADR doesn't supersede it, but it may be helpful to read the other one if you want more background on\nwhy we use service objects."),(0,n.kt)("h2",{id:"problem-statement"},"Problem statement"),(0,n.kt)("h3",{id:"service-object-background"},"Service Object Background"),(0,n.kt)("p",null,"We introduced service objects in ",(0,n.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/service-object-layer"},"ADR 0033 Service Object Layer"),". We use them to leave\nbusiness logic and database details/transactions out of the handlers. Ideally handlers should only focus on translating\ndata from the protocol layer to the service layer and vice-versa. Service objects also allow us to more easily re-use\nbusiness logic across the codebase as needed, including re-using service objects across handlers to keep things\nconsistent across our endpoints and APIs as a whole."),(0,n.kt)("h3",{id:"summary"},"Summary"),(0,n.kt)("p",null,"There are actions that require several things to happen across related models, e.g. creating an ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," may also\nneed ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOAgents")," and/or ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOServiceItems")," to be created. The question is then, should we have a single service object\nthat knows how to do all the things, or break things down and orchestrate service objects somehow?"),(0,n.kt)("p",null,"There are also actions, like routing a shipment, that have their own service objects, but then how should those be\nhandled when it comes to the existing ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," service objects?"),(0,n.kt)("h3",{id:"story-time"},"Story Time"),(0,n.kt)("p",null,"When we started working on implementing the logic to handle PPMs, we decided to start a pattern of having shipment types\nhave their own model that will be a child of the ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," model (see\n",(0,n.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/ppm-db-design"},"ADR-0067 Add a child table to mto_shipments for PPMs")," for more details)."),(0,n.kt)("p",null,"This meant we needed to add logic for creating and updating ",(0,n.kt)("inlineCode",{parentName:"p"},"PPMShipments"),", but we weren't sure where to add it because\nwe don't have a set standard for this. The ADR that started us using service objects (see note at top) is more focused\non the fact that we should use service objects, but doesn't really get into when a new service object should be created\nvs expanding an existing one, or how to handle the times that you need multiple service objects in order to perform a\nfull action. If we look at the existing code base, we have implemented a variety of different patterns, which makes it\nharder to maintain, and more confusing for folks adding new logic."),(0,n.kt)("p",null,"For ",(0,n.kt)("inlineCode",{parentName:"p"},"PPMShipments"),", we opted to create separate service objects from the existing ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," service objects, but due\nto still being in the middle of discussing this ADR, we ended up with two different implementations for how they\ninteract with the ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," service objects. The ",(0,n.kt)("inlineCode",{parentName:"p"},"PPMShipment")," creator internally calls the ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," creator,\nwhile the ",(0,n.kt)("inlineCode",{parentName:"p"},"PPMShipment")," updater expects the ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," updater to be called separately (currently being done in the\nhandler). The ",(0,n.kt)("a",{parentName:"p",href:"#considered-alternatives"},"Considered Alternatives")," section will use these as examples."),(0,n.kt)("h2",{id:"measuring-success"},"Measuring success"),(0,n.kt)("p",null,"Initial success would be:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Have our first orchestration service objects set up for managing shipment-related service objects.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"At first this would primarily be focused on coordinating existing ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects."))),(0,n.kt)("li",{parentName:"ul"},"Team members know about this ADR and have a good example to work from (the first orchestration object mentioned above)."),(0,n.kt)("li",{parentName:"ul"},"Have documentation around these service objects to help people when they need to work on them.")),(0,n.kt)("p",null,"Long-term, we would ideally:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Expand documentation to have helpful information to help people decide when to use orchestration service objects vs\nhaving service objects take other service objects as dependencies or some other method."),(0,n.kt)("li",{parentName:"ul"},"Evaluate how the existing ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects handle ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOAgents"),", ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOServiceItems"),", and shipment routing\nand see if they could/should move to using the orchestration service objects."),(0,n.kt)("li",{parentName:"ul"},"Evaluate other service objects to see if the can benefit from having a higher level orchestration service object.")),(0,n.kt)("h3",{id:"observability"},"Observability"),(0,n.kt)("p",null,(0,n.kt)("em",{parentName:"p"},"How will this change be observed by other team members?")),(0,n.kt)("p",null,"This ADR will be announced in meetings where most of the MilMove team is present. If approved, as orchestration service\nobjects are added or updated, they could be announced at internal demos and/or BE check in meetings."),(0,n.kt)("h3",{id:"implementation-plan"},"Implementation Plan"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Create new orchestration service objects for managing existing ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects."),(0,n.kt)("li",{parentName:"ol"},"Update existing usages of the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects to use the orchestration service\nobjects instead."),(0,n.kt)("li",{parentName:"ol"},"Update documentation around service objects to include info about this new kind of service object, with examples as\nappropriate."),(0,n.kt)("li",{parentName:"ol"},"Announce new service objects at demo and BE check in.")),(0,n.kt)("h3",{id:"ownership"},"Ownership"),(0,n.kt)("p",null,"AppEng would own this since it's related to the way we work with the business logic of our application code."),(0,n.kt)("p",null,"As the need for orchestration service objects arises, it would be up to the person writing code and reviewers to ensure\norchestration service objects are used, added, or update as needed."),(0,n.kt)("h2",{id:"considered-alternatives"},"Considered Alternatives"),(0,n.kt)("p",null,"For these alternatives, we'll keep talking about ",(0,n.kt)("inlineCode",{parentName:"p"},"MTOShipment")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"PPMShipment")," service objects to give concrete\nexamples, but the idea for this ADR is for the decision to be applicable in to any situation where we have multiple\nservice objects that are needed for an action."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Use separate service objects and the handler decides which to call.",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"In this one, the ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects will internally call the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects to do\nwhatever needs to be done to the parent MTO object."),(0,n.kt)("li",{parentName:"ol"},"This is how ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipmentCreator")," works now."))),(0,n.kt)("li",{parentName:"ol"},"Use separate service objects and the handler orchestrates the calls.",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"So for example, we need an ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," to exist before we create a PPMShipment, so the handler would call one,\nthen the other."),(0,n.kt)("li",{parentName:"ol"},"This is how ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipmentUpdater")," works now."))),(0,n.kt)("li",{parentName:"ol"},"Update existing service objects to contain the new logic.",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"An example of this is how the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects handle ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOAgents")," and ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOServiceItems")," internally\nrather than calling other service objects."))),(0,n.kt)("li",{parentName:"ol"},"Have separate service objects, but the handler just calls the existing service objects. Then we update the existing\nservice objects to call the new service objects as needed.",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"This is how routing works currently. The ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects will call the shipment router service\nobject as needed."))),(0,n.kt)("li",{parentName:"ol"},"Have composable service objects and create orchestrator service objects that then call the appropriate service\nobjects.",(0,n.kt)("ol",{parentName:"li"},(0,n.kt)("li",{parentName:"ol"},"Not sure if we have examples of this."))),(0,n.kt)("li",{parentName:"ol"},"Leave things as they are.")),(0,n.kt)("h2",{id:"decision-outcome"},"Decision Outcome"),(0,n.kt)("p",null,"Chosen Alternative -> Option 5: Have composable service objects and create orchestrator service objects that then call\nthe appropriate service objects."),(0,n.kt)("p",null,"While it would take some work up-front, and might add work as new service objects are created, this seems to be the\ncleanest path for what we need. It keeps business logic out of our handlers, while at the same time still keeping our\nservice objects from getting too large, since each can focus on just what ",(0,n.kt)("em",{parentName:"p"},"it")," needs to do. This also leaves us with a\ncodebase that's easier to test since each service object can be isolated as needed in tests."),(0,n.kt)("h2",{id:"pros-and-cons-of-the-alternatives"},"Pros and Cons of the Alternatives"),(0,n.kt)("h3",{id:"option-1-use-separate-service-objects-and-the-handler-decides-which-to-call"},"Option 1: Use separate service objects and the handler decides which to call"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Keeps some service objects from getting too large since they only have to worry about their own thing,\ncalling other service objects as needed."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," This makes service objects work as standalone objects. E.g. the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects can do their thing\nwithout worrying about other things, while the ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects would know to call the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment"),"\nservice objects as needed so they wouldn't need something else to coordinate the calls."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," It is easier to mock out service objects if they are separate objects than if they are all lumped into a single one."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," This puts business logic and database details/transactions in the handlers. Ideally handlers should only focus on\ntranslating data from the protocol layer to the service layer and vice-versa.")),(0,n.kt)("h3",{id:"option-2-use-separate-service-objects-and-the-handler-orchestrates-the-calls"},"Option 2: Use separate service objects and the handler orchestrates the calls"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Keeps service objects from getting too large since each will encapsulate the logic they need for their own work."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," It is easier to mock out service objects if they are separate objects than if they are all lumped into a single one."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," This puts business logic and database details/transactions in the handlers. Ideally handlers should only focus on\ntranslating data from the protocol layer to the service layer and vice-versa."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Testing at the handler level takes more setup than testing at a service object level so testing the orchestration\nof service objects would take more work this way.")),(0,n.kt)("h3",{id:"option-3-update-existing-service-objects-to-contain-the-new-logic"},"Option 3: Update existing service objects to contain the new logic"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Leaves business logic and database details/transactions out of the handlers. Ideally handlers should only focus on\ntranslating data from the protocol layer to the service layer and vice-versa."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," This makes our service objects become incredibly large and hard to maintain. As it is, we already have some\nservice objects, like the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," ones, that contain a large amount of logic and can be hard to parse through."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Related to the point above, but finding the logic for a specific type of change, e.g. tracking how PPMs change,\nwould be harder to do if it's all in one service object."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Testing large service objects is hard because you need to account for many branches of code.")),(0,n.kt)("h3",{id:"option-4-have-separate-service-objects-but-the-handler-just-calls-the-existing-service-objects-then-we-update-the-existing-service-objects-to-call-the-new-service-objects-as-needed"},"Option 4: Have separate service objects, but the handler just calls the existing service objects. Then we update the existing service objects to call the new service objects as needed"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Leaves business logic and database details/transactions out of the handlers. Ideally handlers should only focus on\ntranslating data from the protocol layer to the service layer and vice-versa."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," This makes service objects work as standalone objects. E.g. the ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment")," service objects can do their thing\nwithout worrying about other things, while the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects would know to call the ",(0,n.kt)("inlineCode",{parentName:"li"},"PPMShipment"),"\nservice objects as needed so they wouldn't need something else to coordinate the calls."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Might keep some service objects from getting too large since they only have to worry about their own thing,\ncalling other service objects as needed."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," It is easier to mock out service objects if they are separate objects than if they are all lumped into a single one."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Related to the point above, there is the potential for service objects to still get large though as more\nconnections arise. E.g. if every shipment type had its own service objects, the ",(0,n.kt)("inlineCode",{parentName:"li"},"MTOShipment")," service objects would\nneed to have their own base logic, plus the logic for calling each of the related service objects correctly, which\ncould expand to be too large.")),(0,n.kt)("h3",{id:"option-5-have-composable-service-objects-and-create-orchestrator-service-objects-that-then-call-the-appropriate-service-objects"},"Option 5: Have composable service objects and create orchestrator service objects that then call the appropriate service objects"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Leaves business logic and database details/transactions out of the handlers. Ideally handlers should only focus on\ntranslating data from the protocol layer to the service layer and vice-versa."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," Keeps service objects from getting too large since each can focus on doing their own thing."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," The orchestration service objects could serve as a nice way of viewing all the steps needed for an action at a\nhigh level."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," It is easier to mock out service objects if they are separate objects than if they are all lumped into a single one."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Requires work to create the orchestration service objects that we need now."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," Potentially adds more work when creating new service objects if you need to create both the main service objects\nyou're focusing on, plus orchestration service objects if needed and they don't already exist.")),(0,n.kt)("h3",{id:"option-6-leave-things-as-they-are"},"Option 6: Leave things as they are"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"+")," No extra work is needed right now."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," We are left with code that implements most of the options and is inconsistent even within the same service objects."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," This leaves some cases of business logic and database details/transactions in the handlers. Ideally handlers\nshould only focus on translating data from the protocol layer to the service layer and vice-versa."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"-")," We are left without a standard that would help guide future folks.")),(0,n.kt)("h2",{id:"resources"},"Resources"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://ustcdp3.slack.com/archives/C022R8A9FC4/p1645221666532619"},"Slack thread where we discussed options for handling related service objects")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://dp3.atlassian.net/wiki/spaces/MT/pages/1661665292/2022-02-24+Meeting+notes"},"Back-end check-in notes where we discussed the options")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://transcom.github.io/mymove-docs/docs/backend/guides/service-objects"},"Existing documentation on service objects"))))}p.isMDXComponent=!0}}]);